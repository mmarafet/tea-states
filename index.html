<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è</title>

  <style>
    :root{
      /* Light theme */
      --bg: #f6f7fb;
      --card: #ffffff;
      --card2:#fbfcff;
      --text:#0f172a;
      --muted:#5b6578;
      --border: rgba(15,23,42,.12);
      --shadow: 0 10px 28px rgba(15,23,42,.10);

      --btnBg: rgba(15,23,42,.04);
      --btnBgHover: rgba(15,23,42,.07);

      --accent: rgba(13,148,136,.18);
      --accentBorder: rgba(13,148,136,.35);

      --selectBg: #ffffff;
      --selectText: #0f172a;

      --modalBg: rgba(255,255,255,.92);
      --modalBg2: rgba(255,255,255,.86);

      /* Selection colors */
      --selBadBg: rgba(2,132,199,.14);
      --selBadBorder: rgba(2,132,199,.55);
      --selGoodBg: rgba(13,148,136,.14);
      --selGoodBorder: rgba(13,148,136,.55);

      --chipBadBg: rgba(2,132,199,.10);
      --chipGoodBg: rgba(13,148,136,.10);

      /* Right card persistent ‚Äúgreenish‚Äù mode */
      --keepGreenBg1: rgba(13,148,136,.10);
      --keepGreenBg2: rgba(13,148,136,.06);
      --keepGreenBorder: rgba(13,148,136,.45);
      --keepGreenShadow: 0 0 0 6px rgba(13,148,136,.10), 0 14px 30px rgba(15,23,42,.12);

      /* Tooltip */
      --tipBg: rgba(15,23,42,.92);
      --tipText: #ffffff;
      --tipBorder: rgba(255,255,255,.10);
    }

    html[data-theme="dark"]{
      /* Dark theme */
      --bg:#0b0f14;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --text:#e8eef5;
      --muted:#9aaabb;
      --border: rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);

      --btnBg: rgba(255,255,255,.08);
      --btnBgHover: rgba(255,255,255,.12);

      --accent: rgba(125, 211, 252, .14);
      --accentBorder: rgba(125, 211, 252, .28);

      --selectBg: rgba(12,16,22,.95);
      --selectText: #e8eef5;

      --modalBg: rgba(12,16,22,.92);
      --modalBg2: rgba(12,16,22,.86);

      /* CONTRAST selection colors for dark theme (request #1) */
      --selBadBg: rgba(56,189,248,.22);
      --selBadBorder: rgba(56,189,248,.72);
      --selGoodBg: rgba(52,211,153,.22);
      --selGoodBorder: rgba(52,211,153,.72);

      --chipBadBg: rgba(56,189,248,.14);
      --chipGoodBg: rgba(52,211,153,.14);

      --keepGreenBg1: rgba(167, 243, 208, .12);
      --keepGreenBg2: rgba(167, 243, 208, .08);
      --keepGreenBorder: rgba(167, 243, 208, .35);
      --keepGreenShadow: 0 0 0 6px rgba(167,243,208,.10), 0 14px 30px rgba(0,0,0,.35);

      --tipBg: rgba(12,16,22,.96);
      --tipText: #e8eef5;
      --tipBorder: rgba(255,255,255,.10);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 10% 10%, rgba(2,132,199,.10), transparent 55%),
        radial-gradient(900px 650px at 90% 20%, rgba(13,148,136,.08), transparent 50%),
        var(--bg);
    }

    header{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 18px 10px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    h1{ margin: 0 0 6px; font-size: 20px; letter-spacing:.2px; }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
      max-width: 900px;
    }

    .topRight{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .langWrap{ display:flex; align-items:center; gap: 8px; }
    .langLabel{ color: var(--muted); font-size: 12px; white-space: nowrap; user-select:none; }
    .langSelect{
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid var(--border);
      background: var(--selectBg);
      color: var(--selectText);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.10);
      outline: none;
    }
    .langSelect:hover{ filter: brightness(1.02); }

    .themeBtn{
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.10);
      outline: none;
    }
    .themeBtn:hover{ background: var(--btnBgHover); }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 18px 18px;
      display: grid;
      grid-template-columns: 1fr 440px;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 980px){
      header{ flex-direction: column; align-items: stretch; }
      .topRight{ justify-content: flex-start; }
      .wrap{ grid-template-columns: 1fr; }
    }

    .left{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .left{ grid-template-columns: 1fr; }
    }

    .panel, .card, .controls, .footerCard, .nlpCard{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* Right card persistent ‚Äúgreenish‚Äù mode */
    .card.keepGreen{
      border-color: var(--keepGreenBorder);
      box-shadow: var(--keepGreenShadow);
      background: linear-gradient(180deg, var(--keepGreenBg1), var(--keepGreenBg2));
    }

    /* Flash animation on NLP pick */
    @keyframes greenFlash {
      0%   { box-shadow: 0 0 0 0 rgba(13,148,136,0.0), var(--shadow); }
      40%  { box-shadow: 0 0 0 10px rgba(13,148,136,0.20), var(--shadow); }
      100% { box-shadow: var(--keepGreenShadow); }
    }
    html[data-theme="dark"] .card.flashGreen{
      animation: greenFlash 900ms ease-out forwards;
    }
    .card.flashGreen{
      animation: greenFlash 900ms ease-out forwards;
    }

    .head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    html[data-theme="light"] .head{ background: rgba(15,23,42,.02); }
    .title{ font-weight: 800; font-size: 14px; letter-spacing:.2px; }
    .hint{ color: var(--muted); font-size: 12px; white-space: nowrap; }
    .body{ padding: 12px; }

    .legend{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 0 0 10px;
    }
    .pill{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .pill{ background: rgba(15,23,42,.03); }

    .cloud{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 2px;
    }
    .node{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      line-height: 1;
      user-select: none;
      position: relative;
      white-space: nowrap;
      transition: transform .06s ease, border-color .15s ease, background .15s ease;
    }
    html[data-theme="light"] .node{ background: rgba(15,23,42,.03); }
    .node:hover{ border-color: rgba(15,23,42,.20); }
    html[data-theme="dark"] .node:hover{ border-color: rgba(255,255,255,.20); }
    .node:active{ transform: translateY(1px); }

    /* Single-mode active */
    .node[data-active="true"]{
      border-color: rgba(15,23,42,.35);
      background: rgba(15,23,42,.06);
    }
    html[data-theme="dark"] .node[data-active="true"]{
      border-color: rgba(255,255,255,.35);
      background: rgba(255,255,255,.07);
    }

    /* PRO-mode selected (request #1) */
    .node.bad[data-selected="true"]{
      border-color: var(--selBadBorder);
      background: var(--selBadBg);
    }
    .node.good[data-selected="true"]{
      border-color: var(--selGoodBorder);
      background: var(--selGoodBg);
    }

    /* Make dark theme selection more contrasty by bumping text a bit */
    html[data-theme="dark"] .node.bad[data-selected="true"],
    html[data-theme="dark"] .node.good[data-selected="true"]{
      filter: saturate(1.05);
    }

    .checkdot{
      display:none;
      position:absolute;
      right:6px;
      top:50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(15,23,42,.55);
      box-shadow: 0 0 0 2px rgba(255,255,255,.25);
    }
    html[data-theme="dark"] .checkdot{
      background: rgba(255,255,255,.75);
      box-shadow: 0 0 0 2px rgba(0,0,0,.25);
    }
    .node[data-selected="true"] .checkdot{ display:block; }

    /* Right card */
    .cardTop{
      padding: 14px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    html[data-theme="light"] .cardTop{ background: rgba(15,23,42,.02); }
    .cardTop h2{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .chip{
      font-size: 12px;
      border-radius: 999px;
      padding: 5px 9px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
      white-space: nowrap;
    }
    html[data-theme="light"] .chip{ background: rgba(15,23,42,.03); }

    .cardBody{ padding: 14px; }
    .muted{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .divider{ height:1px; background: var(--border); margin: 12px 0; }

    .sectionTitle{
      font-weight: 900;
      font-size: 13px;
      margin: 10px 0 8px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .miniBtn{
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 10px;
      padding: 6px 8px;
      cursor:pointer;
      font-size: 12px;
      white-space: nowrap;
    }
    .miniBtn:hover{ background: var(--btnBgHover); }

    .primaryBtn{
      border: 1px solid var(--accentBorder);
      background: rgba(13,148,136,.14);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 800;
      white-space: nowrap;
    }
    html[data-theme="dark"] .primaryBtn{
      background: rgba(125,211,252,.14);
      border-color: rgba(125,211,252,.28);
    }
    .primaryBtn:hover{ filter: brightness(1.05); }

    .dangerBtn{
      border: 1px solid rgba(244,63,94,.28);
      background: rgba(244,63,94,.10);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 12px;
      white-space: nowrap;
    }
    .dangerBtn:hover{ filter: brightness(1.05); }

    /* Selected state chips in right block (request #2) */
    .stateChips{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0 0 8px;
    }
    .stateChip{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--text);
      background: rgba(255,255,255,.03);
      user-select:none;
    }
    html[data-theme="light"] .stateChip{ background: rgba(15,23,42,.03); }
    .stateChip.bad{
      border-color: var(--selBadBorder);
      background: var(--chipBadBg);
    }
    .stateChip.good{
      border-color: var(--selGoodBorder);
      background: var(--chipGoodBg);
    }

    /* Tea list */
    .list{ margin: 10px 0 0; padding: 0; list-style: none; }
    .list li{
      padding: 10px 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 8px;
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .list li{ background: rgba(15,23,42,.02); }

    .list li .k{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap:10px;
      margin-bottom: 4px;
      font-weight: 850;
      font-size: 13px;
    }

    /* tea name opens modal */
    .teaBtn{
      all: unset;
      cursor: pointer;
      color: var(--text);
      border-bottom: 1px dashed rgba(15,23,42,.25);
      line-height: 1.2;
    }
    html[data-theme="dark"] .teaBtn{
      border-bottom: 1px dashed rgba(255,255,255,.22);
    }
    .teaBtn:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .teaBtn:hover{ border-bottom-color: rgba(255,255,255,.55); }

    .tag{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(0,0,0,.02);
      white-space: nowrap;
    }
    html[data-theme="dark"] .tag{ background: rgba(0,0,0,.12); }

    .buyLine{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .buyLink{
      color: var(--text);
      text-decoration: none;
      border-bottom: 1px dashed rgba(15,23,42,.22);
      cursor: pointer;
    }
    html[data-theme="dark"] .buyLink{ border-bottom: 1px dashed rgba(255,255,255,.22); }
    .buyLink:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .buyLink:hover{ border-bottom-color: rgba(255,255,255,.55); }

    .teaPills{
      display:flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }
    .pillRow{
      display:flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }
    .pillLabel{
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
    }
    .pillState{
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      user-select:none;
      cursor: default;
    }
    html[data-theme="light"] .pillState{ background: rgba(15,23,42,.03); }
    .pillState.bad{
      border-color: var(--selBadBorder);
      background: var(--chipBadBg);
    }
    .pillState.good{
      border-color: var(--selGoodBorder);
      background: var(--chipGoodBg);
    }

    /* AI panel now becomes a normal panel (request #8: not after the 3rd block) */
    .nlpCard{ grid-column: 1 / -1; }
    .nlpInner{
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .nlpLeft{ flex: 1 1 560px; min-width: 260px; }
    .nlpTitle{ font-weight: 900; font-size: 13px; margin: 0 0 8px; }
    .nlpRow{ display:flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .nlpInput{
      flex: 1 1 420px;
      min-width: 240px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.70);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
      font-size: 13px;
    }
    html[data-theme="dark"] .nlpInput{ background: rgba(255,255,255,.06); }
    .nlpInput:focus{
      border-color: var(--accentBorder);
      box-shadow: 0 0 0 4px var(--accent);
    }
    .nlpNote{ margin: 8px 0 0; color: var(--muted); font-size: 12px; line-height: 1.4; }

    /* Bottom area */
    .below{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 18px 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .controls{
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .controlsLeft{ display:flex; align-items:center; gap: 12px; flex-wrap: wrap; }
    .toggleWrap{ display:flex; align-items:center; gap: 10px; }
    .toggle{
      width: 44px;
      height: 26px;
      border-radius: 999px;
      background: rgba(15,23,42,.10);
      border: 1px solid var(--border);
      position: relative;
      cursor: pointer;
      flex: 0 0 auto;
    }
    html[data-theme="dark"] .toggle{ background: rgba(255,255,255,.12); }
    .toggleKnob{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: rgba(15,23,42,.55);
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 2px;
      transition: left .18s ease, background .18s ease;
    }
    html[data-theme="dark"] .toggleKnob{ background: rgba(255,255,255,.75); }
    .toggle[data-on="true"]{
      background: var(--accent);
      border-color: var(--accentBorder);
    }
    .toggle[data-on="true"] .toggleKnob{
      left: 20px;
      background: rgba(13,148,136,.85);
    }
    html[data-theme="dark"] .toggle[data-on="true"] .toggleKnob{
      background: rgba(167, 243, 208, .85);
    }
    .counter{ color: var(--muted); font-size: 12px; white-space: nowrap; }

    /* Fineprint + (request #7) About moved into PRO block */
    .footerCard{ padding: 12px 14px; }
    .fineprint{ color: var(--muted); font-size: 12px; line-height: 1.45; }

    .aboutLink{
      font-size: 12px;
      color: var(--text);
      cursor: pointer;
      border-bottom: 1px dashed rgba(15,23,42,.25);
      text-decoration: none;
      user-select:none;
      white-space: nowrap;
      display:inline-block;
      margin-top: 6px;
    }
    html[data-theme="dark"] .aboutLink{ border-bottom-color: rgba(255,255,255,.22); }
    .aboutLink:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .aboutLink:hover{ border-bottom-color: rgba(255,255,255,.55); }

    /* Modals */
    .modalOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 100;
      padding: 16px;
    }
    .modal{
      width: min(820px, 100%);
      border-radius: 16px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--modalBg), var(--modalBg2));
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .modalTop{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      background: rgba(255,255,255,.02);
    }
    .modalTop strong{ font-size: 14px; letter-spacing:.2px; }
    .modalBody{
      padding: 14px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.6;
    }
    .modalGrid{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    .modalBlockTitle{ font-weight: 900; margin: 0 0 6px; font-size: 13px; }

    .modalActions{
      display:flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      flex-wrap: wrap;
    }

    /* Tea modal extras (request #9) */
    .teaHero{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap: 12px;
      align-items: start;
    }
    @media (max-width: 560px){
      .teaHero{ grid-template-columns: 1fr; }
    }
    .teaImg{
      width: 160px;
      height: 160px;
      border-radius: 14px;
      border: 1px solid var(--border);
      object-fit: cover;
      background: rgba(255,255,255,.03);
    }
    @media (max-width: 560px){
      .teaImg{ width: 100%; height: 200px; }
    }

    .classTable{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .classTable{ background: rgba(15,23,42,.02); }
    .classTable td{
      padding: 10px 10px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-size: 12px;
      line-height: 1.45;
    }
    .classTable tr:last-child td{ border-bottom: none; }
    .classK{
      width: 36%;
      color: var(--muted);
      font-weight: 800;
    }

    /* Tooltip bubble (request #4) */
    .tooltip{
      position: fixed;
      z-index: 999;
      display:none;
      max-width: min(360px, calc(100vw - 24px));
      padding: 10px 10px;
      border-radius: 12px;
      background: var(--tipBg);
      color: var(--tipText);
      border: 1px solid var(--tipBorder);
      box-shadow: 0 16px 36px rgba(0,0,0,.35);
      font-size: 12px;
      line-height: 1.35;
      pointer-events: none;
      transform: translate(10px, 10px);
    }
    .tooltip b{ font-weight: 900; }

    /* ================
       Mobile wizard (request #3)
       ================ */
    .desktopOnly{ display: block; }
    .mobileOnly{ display: none; }

    @media (max-width: 760px){
      .desktopOnly{ display:none; }
      .mobileOnly{ display:block; }

      .mobileWrap{
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 18px 18px;
        display: grid;
        gap: 12px;
      }

      .stepTop{
        display:flex;
        justify-content: space-between;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .steps{
        display:flex;
        gap: 6px;
        flex-wrap: wrap;
        align-items: center;
      }
      .stepDot{
        font-size: 12px;
        padding: 6px 9px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,.03);
        color: var(--muted);
      }
      html[data-theme="light"] .stepDot{ background: rgba(15,23,42,.03); }
      .stepDot[data-on="true"]{
        color: var(--text);
        border-color: var(--accentBorder);
        background: var(--accent);
      }
      .stepNav{
        display:flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .node.nodeBig{
        font-size: 14px;
        padding: 10px 12px;
      }
    }
  </style>
</head>

<body>
<header>
  <div>
    <h1 id="uiTitle">–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è</h1>
    <p class="sub" id="uiSubtitle">
      –í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è. –í ‚ÄúPRO‚Äù ‚Äî –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä.
    </p>
  </div>

  <div class="topRight">
    <div class="langWrap">
      <span class="langLabel" id="uiLangLabel">–Ø–∑—ã–∫</span>
      <select class="langSelect" id="langSelect" aria-label="Language selector"></select>
    </div>
    <button class="themeBtn" id="themeBtn" type="button">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
  </div>
</header>

<!-- DESKTOP LAYOUT -->
<div class="wrap desktopOnly">
  <div class="left">
    <!-- AI block moved into left column (NOT after recommendations) (request #8) -->
    <section class="nlpCard">
      <div class="head">
        <div class="title" id="uiNlpTitle">–ë—ã—Å—Ç—Ä—ã–π –ø–æ–¥–±–æ—Ä –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</div>
        <div class="hint" id="uiNlpHint">–ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</div>
      </div>
      <div class="nlpInner">
        <div class="nlpLeft">
          <div class="nlpRow">
            <input class="nlpInput" id="nlpInput" type="text"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ—Å–ª–µ –æ–±–µ–¥–∞ –∫–ª–æ–Ω–∏—Ç –≤ —Å–æ–Ω, –≥–æ–ª–æ–≤–∞ –≤–∞—Ç–Ω–∞—è, —Ö–æ—á–µ—Ç—Å—è —Å–æ–±—Ä–∞—Ç—å—Å—è –±–µ–∑ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è¬ª" />
            <button class="primaryBtn" id="nlpBtn" type="button">–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
          </div>
          <div class="nlpNote" id="uiNlpNote">
            –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ—Ç—Å—è PRO –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚Äú–ø–æ—á–µ–º—É —Ç–∞–∫‚Äù.
          </div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="head">
        <div class="title" id="uiBadTitle">–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)</div>
        <div class="hint" id="uiBadHint">20 —à—Ç.</div>
      </div>
      <div class="body">
        <div class="legend">
          <span class="pill" id="uiBadPill">–í PRO: –∫–ª–∏–∫–∞–π –ø–æ ‚Äú–ø–∏–ª—é–ª—è–º‚Äù –¥–æ 5</span>
        </div>
        <div class="cloud" id="badCloud"></div>
      </div>
    </section>

    <section class="panel">
      <div class="head">
        <div class="title" id="uiGoodTitle">–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)</div>
        <div class="hint" id="uiGoodHint">20 —à—Ç.</div>
      </div>
      <div class="body">
        <div class="legend">
          <span class="pill" id="uiGoodPill1">–£—Ç—Ä–æ ‚Äî ‚Äú–∑–µ–ª–µ–Ω–µ–µ/—Å–≤–µ—Ç–ª–µ–µ‚Äù</span>
          <span class="pill" id="uiGoodPill2">–í–µ—á–µ—Ä ‚Äî ‚Äú—Ç–µ–º–Ω–µ–µ/—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ‚Äù</span>
        </div>
        <div class="cloud" id="goodCloud"></div>
      </div>
    </section>
  </div>

  <aside>
    <section class="card" id="rightCard">
      <div class="cardTop">
        <h2 id="cardTitle">–í—ã–±–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
        <span class="chip" id="cardChip">–û–¥–∏–Ω –≤—ã–±–æ—Ä</span>
      </div>
      <div class="cardBody">
        <p class="muted" id="cardDesc">
          –í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è. –í ‚ÄúPRO‚Äù ‚Äî —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
        </p>

        <div id="reasoningBox" style="display:none;">
          <div class="divider"></div>
          <div class="sectionTitle">
            <span id="uiWhy">–ü–æ—á–µ–º—É —Ç–∞–∫</span>
            <button class="miniBtn" id="hideWhyBtn" type="button">—Å–∫—Ä—ã—Ç—å</button>
          </div>
          <div class="muted" id="reasoningText"></div>
        </div>

        <div id="multiBlocks" style="display:none;">
          <div class="divider"></div>

          <div class="sectionTitle">
            <span id="uiAddedRemove">–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú—É–±—Ä–∞—Ç—å‚Äù</span>
            <button class="miniBtn" id="clearBadBtn" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
          <div class="stateChips" id="selectedBadChips"></div>

          <div class="sectionTitle">
            <span id="uiAddedGet">–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù</span>
            <button class="miniBtn" id="clearGoodBtn" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
          <div class="stateChips" id="selectedGoodChips"></div>

          <div class="divider"></div>
          <p class="muted" id="uiMultiLine">
            –í—ã—à–µ ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é.
          </p>

          <div class="sectionTitle">
            <span id="uiTeaPick">–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</span>
            <button class="miniBtn" id="clearAllBtn" type="button">—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
          </div>
        </div>

        <ul class="list" id="teaList"></ul>

        <div class="divider"></div>
        <p class="muted" id="uiBrewQuick">
          <b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–ª–∏–≤–∞:</b><br/>
          120‚Äì150 –º–ª –≥–∞–π–≤–∞–Ω—å/—á–∞–π–Ω–∏–∫ ‚Ä¢ 4‚Äì6 –≥ (–≤–µ—á–µ—Ä–æ–º 3‚Äì5 –≥) ‚Ä¢ –ø—Ä–æ–ª–∏–≤—ã 5‚Äì15 —Å–µ–∫, –¥–∞–ª–µ–µ –ø–æ –≤–∫—É—Å—É.
        </p>
      </div>
    </section>
  </aside>
</div>

<!-- MOBILE WIZARD -->
<div class="mobileOnly">
  <div class="mobileWrap">
    <section class="controls">
      <div class="controlsLeft">
        <div class="toggleWrap">
          <div class="toggle" id="multiToggleMobile" data-on="false" role="switch" aria-checked="false" tabindex="0">
            <div class="toggleKnob"></div>
          </div>
          <div>
            <div style="font-weight:900;" id="uiProTitleMobile">–í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π PRO</div>
            <div class="counter" id="counterTextMobile">–£–±—Ä–∞—Ç—å: 0/5 ‚Ä¢ –í—ã–∑–≤–∞—Ç—å: 0/5</div>
            <a class="aboutLink" id="aboutLinkMobile" href="javascript:void(0)">–û —Å–∞–π—Ç–µ</a>
          </div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="body">
        <div class="stepTop">
          <div class="steps" aria-label="steps">
            <span class="stepDot" id="stepDot0" data-on="true">0 ¬∑ –û–ø–∏—Å–∞–Ω–∏–µ</span>
            <span class="stepDot" id="stepDot1" data-on="false">1 ¬∑ –£–±—Ä–∞—Ç—å</span>
            <span class="stepDot" id="stepDot2" data-on="false">2 ¬∑ –í—ã–∑–≤–∞—Ç—å</span>
            <span class="stepDot" id="stepDot3" data-on="false">3 ¬∑ –ü–æ–¥–±–æ—Ä</span>
          </div>
          <div class="stepNav">
            <button class="miniBtn" id="prevStepBtn" type="button">–Ω–∞–∑–∞–¥</button>
            <button class="primaryBtn" id="nextStepBtn" type="button">–¥–∞–ª—å—à–µ</button>
          </div>
        </div>
      </div>
    </section>

    <section class="nlpCard" id="mobileStep0">
      <div class="head">
        <div class="title">–ë—ã—Å—Ç—Ä—ã–π –ø–æ–¥–±–æ—Ä –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</div>
        <div class="hint">—à–∞–≥ 0</div>
      </div>
      <div class="nlpInner">
        <div class="nlpLeft">
          <div class="nlpRow">
            <input class="nlpInput" id="nlpInputMobile" type="text"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ—Å–ª–µ –æ–±–µ–¥–∞ –∫–ª–æ–Ω–∏—Ç –≤ —Å–æ–Ω, –≥–æ–ª–æ–≤–∞ –≤–∞—Ç–Ω–∞—è‚Ä¶¬ª" />
            <button class="primaryBtn" id="nlpBtnMobile" type="button">–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
          </div>
          <div class="nlpNote">
            –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏ –≤—ã–±—Ä–∞—Ç—å —Ä—É–∫–∞–º–∏.
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="mobileStep1" style="display:none;">
      <div class="head">
        <div class="title">–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)</div>
        <div class="hint">—à–∞–≥ 1</div>
      </div>
      <div class="body">
        <div class="legend"><span class="pill">–í PRO: –¥–æ 5</span></div>
        <div class="cloud" id="badCloudMobile"></div>
      </div>
    </section>

    <section class="panel" id="mobileStep2" style="display:none;">
      <div class="head">
        <div class="title">–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)</div>
        <div class="hint">—à–∞–≥ 2</div>
      </div>
      <div class="body">
        <div class="legend">
          <span class="pill">–í PRO: –¥–æ 5</span>
        </div>
        <div class="cloud" id="goodCloudMobile"></div>
      </div>
    </section>

    <section class="card" id="mobileStep3" style="display:none;">
      <div class="cardTop">
        <h2>–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</h2>
        <span class="chip" id="cardChipMobile">PRO</span>
      </div>
      <div class="cardBody">
        <div class="sectionTitle">
          <span>–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú—É–±—Ä–∞—Ç—å‚Äù</span>
          <button class="miniBtn" id="clearBadBtnMobile" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div class="stateChips" id="selectedBadChipsMobile"></div>

        <div class="sectionTitle">
          <span>–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù</span>
          <button class="miniBtn" id="clearGoodBtnMobile" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div class="stateChips" id="selectedGoodChipsMobile"></div>

        <div id="reasoningBoxMobile" style="display:none;">
          <div class="divider"></div>
          <div class="sectionTitle">
            <span>–ü–æ—á–µ–º—É —Ç–∞–∫</span>
            <button class="miniBtn" id="hideWhyBtnMobile" type="button">—Å–∫—Ä—ã—Ç—å</button>
          </div>
          <div class="muted" id="reasoningTextMobile"></div>
        </div>

        <div class="divider"></div>
        <div class="sectionTitle">
          <span>–ß–∞–π–Ω—ã–π –ø–æ–¥–±–æ—Ä</span>
          <button class="miniBtn" id="clearAllBtnMobile" type="button">—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        </div>
        <ul class="list" id="teaListMobile"></ul>
      </div>
    </section>

    <section class="footerCard">
      <div class="fineprint" id="uiFineprintMobile">
        ‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ñ–µ–∏–Ω, –∫—Ä–µ–ø–æ—Å—Ç—å, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è.
      </div>
    </section>
  </div>
</div>

<div class="below desktopOnly">
  <section class="footerCard">
    <div class="fineprint" id="uiFineprint">
      ‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ñ–µ–∏–Ω, –∫—Ä–µ–ø–æ—Å—Ç—å, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è.
      –ü—Ä–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.
    </div>
  </section>

  <section class="controls" id="controlsPanel">
    <div class="controlsLeft">
      <div class="toggleWrap">
        <div class="toggle" id="multiToggle" data-on="false" role="switch" aria-checked="false" tabindex="0">
          <div class="toggleKnob"></div>
        </div>
        <div>
          <div style="font-weight:900;" id="uiProTitle">–í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π PRO</div>
          <div class="counter" id="counterText">–£–±—Ä–∞—Ç—å: 0/5 ‚Ä¢ –í—ã–∑–≤–∞—Ç—å: 0/5</div>
          <!-- request #7 -->
          <a class="aboutLink" id="aboutLink" href="javascript:void(0)">–û —Å–∞–π—Ç–µ</a>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Tooltip -->
<div class="tooltip" id="tooltip"></div>

<!-- Modal: selection limit -->
<div class="modalOverlay" id="limitModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiLimitTitle">–õ–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞</strong>
      <button class="miniBtn" id="closeLimitBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="uiLimitBody">
      –î–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10 —à—Ç).
    </div>
  </div>
</div>

<!-- Modal: PRO (request #6: restore old ‚Äúpurchase PRO‚Äù dialog) -->
<div class="modalOverlay" id="proModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiProModalTitle">–†–µ–∂–∏–º PRO</strong>
      <button class="miniBtn" id="proModalCloseX" type="button">‚úï</button>
    </div>
    <div class="modalBody" id="uiProModalBody">
      –í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –≤–µ—Ä—Å–∏—é PRO?
    </div>
    <div class="modalActions" id="proModalActions">
      <button class="miniBtn" id="proModalNo" type="button">–Ω–µ—Ç</button>
      <button class="primaryBtn" id="proModalYes" type="button">–¥–∞</button>
    </div>
  </div>
</div>

<!-- Modal: About -->
<div class="modalOverlay" id="aboutModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiAboutTitle">–û —Å–∞–π—Ç–µ</strong>
      <button class="miniBtn" id="aboutCloseBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="uiAboutBody">
      –î–∞–Ω–Ω—ã–π —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ GPT-5.2.
      –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–∞—è,
      –∞ —Ç–∞–∫–∂–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø–æ—Å–≤—è—â—ë–Ω–Ω—ã–µ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É —á–∞—è (–∫–æ—Ñ–µ–∏–Ω, L-—Ç–µ–∞–Ω–∏–Ω, –ø–æ–ª–∏—Ñ–µ–Ω–æ–ª—ã) –∏ –∏—Ö
      –≤–æ–∑–º–æ–∂–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –∏ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.
      <br/><br/>
      –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–æ–∑–∏—Ä–æ–≤–∫–∏, –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è.
    </div>
  </div>
</div>

<!-- Modal: tea details -->
<div class="modalOverlay" id="teaModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="teaModalTitle">–ß–∞–π</strong>
      <button class="miniBtn" id="teaModalCloseBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody">
      <div class="modalGrid">
        <div class="teaHero">
          <img class="teaImg" id="teaModalImg" alt="tea" />
          <div>
            <div class="muted" id="teaModalDesc"></div>
          </div>
        </div>

        <div>
          <div class="modalBlockTitle">–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
          <table class="classTable" id="teaModalClass"></table>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalOriginTitle">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ</div>
          <div class="muted" id="teaModalOrigin"></div>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalFactsTitle">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã</div>
          <div class="muted" id="teaModalFacts"></div>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalGivesTitle">–ß—Ç–æ –æ–±—ã—á–Ω–æ –¥–∞—ë—Ç</div>
          <div class="pillRow" id="teaModalGives"></div>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalWhenTitle">–ö–æ–≥–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç</div>
          <div class="pillRow" id="teaModalWhen"></div>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalBrewTitle">–ó–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</div>
          <div class="muted" id="teaModalBrew"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // i18n: RU + EN (kept, minimal updates)
  // =========================
  const LANGS = [
    { id:"ru", label:"–†—É—Å—Å–∫–∏–π" },
    { id:"en", label:"English" },
  ];

  const UI = {
    ru: {
      title:"–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è",
      subtitle:"–í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è. –í ‚ÄúPRO‚Äù ‚Äî –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä.",
      langLabel:"–Ø–∑—ã–∫",
      themeLight:"‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞",
      themeDark:"üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞",

      badTitle:"–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)", badHint:"20 —à—Ç.", badPill:"–í PRO: –∫–ª–∏–∫–∞–π –ø–æ ‚Äú–ø–∏–ª—é–ª—è–º‚Äù –¥–æ 5",
      goodTitle:"–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)", goodHint:"20 —à—Ç.",
      goodPill1:"–£—Ç—Ä–æ ‚Äî ‚Äú–∑–µ–ª–µ–Ω–µ–µ/—Å–≤–µ—Ç–ª–µ–µ‚Äù", goodPill2:"–í–µ—á–µ—Ä ‚Äî ‚Äú—Ç–µ–º–Ω–µ–µ/—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ‚Äù",

      cardIdleTitle:"–í—ã–±–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",
      cardModeSingle:"–û–¥–∏–Ω –≤—ã–±–æ—Ä",
      cardModePro:"PRO",
      cardDesc:"–í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è. –í ‚ÄúPRO‚Äù ‚Äî —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.",

      why:"–ü–æ—á–µ–º—É —Ç–∞–∫",
      hide:"—Å–∫—Ä—ã—Ç—å",

      addedRemove:"–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú—É–±—Ä–∞—Ç—å‚Äù", addedGet:"–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù", teaPick:"–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
      clear:"–æ—á–∏—Å—Ç–∏—Ç—å", resetAll:"—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë",
      multiLine:"–í—ã—à–µ ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é.",

      quickBrew:"<b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–ª–∏–≤–∞:</b><br/>120‚Äì150 –º–ª –≥–∞–π–≤–∞–Ω—å/—á–∞–π–Ω–∏–∫ ‚Ä¢ 4‚Äì6 –≥ (–≤–µ—á–µ—Ä–æ–º 3‚Äì5 –≥) ‚Ä¢ –ø—Ä–æ–ª–∏–≤—ã 5‚Äì15 —Å–µ–∫, –¥–∞–ª–µ–µ –ø–æ –≤–∫—É—Å—É.",

      proTitle:"–í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π PRO",
      counter:(a,b)=>`–£–±—Ä–∞—Ç—å: ${a}/5 ‚Ä¢ –í—ã–∑–≤–∞—Ç—å: ${b}/5`,

      nlpTitle:"–ë—ã—Å—Ç—Ä—ã–π –ø–æ–¥–±–æ—Ä –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é",
      nlpHint:"–ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ",
      nlpPlaceholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ—Å–ª–µ –æ–±–µ–¥–∞ –∫–ª–æ–Ω–∏—Ç –≤ —Å–æ–Ω, –≥–æ–ª–æ–≤–∞ –≤–∞—Ç–Ω–∞—è, —Ö–æ—á–µ—Ç—Å—è —Å–æ–±—Ä–∞—Ç—å—Å—è –±–µ–∑ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è¬ª",
      nlpBtn:"–ü–æ–¥–æ–±—Ä–∞—Ç—å",
      nlpNote:"–ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ—Ç—Å—è PRO –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚Äú–ø–æ—á–µ–º—É —Ç–∞–∫‚Äù.",

      prompts:{
        bad:"–ü–æ–¥ —ç—Ç–∏ –æ—â—É—â–µ–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç:",
        good:"–ß—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–ø—Ä–æ–±—É–π:",
        proTitle:"–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
        proDesc:"–ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é."
      },

      fineprint:"‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ñ–µ–∏–Ω, –∫—Ä–µ–ø–æ—Å—Ç—å, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è. –ü—Ä–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.",
      about:"–û —Å–∞–π—Ç–µ",

      aboutTitle:"–û —Å–∞–π—Ç–µ",
      aboutBody:`–î–∞–Ω–Ω—ã–π —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ GPT-5.2. –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–∞—è, –∞ —Ç–∞–∫–∂–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø–æ—Å–≤—è—â—ë–Ω–Ω—ã–µ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É —á–∞—è (–∫–æ—Ñ–µ–∏–Ω, L-—Ç–µ–∞–Ω–∏–Ω, –ø–æ–ª–∏—Ñ–µ–Ω–æ–ª—ã) –∏ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –∏ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–æ–∑–∏—Ä–æ–≤–∫–∏, –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è.`,

      limitTitle:"–õ–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞",
      limitBody:"–î–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10 —à—Ç).",
      ok:"–æ–∫",

      buy:"–∫—É–ø–∏—Ç—å",

      proModalTitle:"–†–µ–∂–∏–º PRO",
      proModalQuestion:"–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –≤–µ—Ä—Å–∏—é PRO?",
      proNo:"–Ω–µ—Ç",
      proYes:"–¥–∞",
      proNoText:"–ü—Ä–æ–¥—É–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è, —Ç–æ –º–æ–∂–µ—Ç–µ –∑–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É —Å–±–µ—Ä–±–∞–Ω–∫–∞: 2202206736083473",
      proYesText:"–ü–æ—Ö–≤–∞–ª—å–Ω–æ –∫–æ–Ω–µ—á–Ω–æ, –Ω–æ –ø—Ä–æ–¥—É–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –ï—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è, —Ç–æ –º–æ–∂–µ—Ç–µ –∑–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É —Å–±–µ—Ä–±–∞–Ω–∫–∞: 2202206736083473",

      teaModal:{
        originTitle:"–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ",
        factsTitle:"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã",
        givesTitle:"–ß—Ç–æ –æ–±—ã—á–Ω–æ –¥–∞—ë—Ç",
        whenTitle:"–ö–æ–≥–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç",
        brewTitle:"–ó–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ",
        classTitle:"–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è"
      }
    },

    en: {
      title:"Tea ‚Üí States",
      subtitle:"Single mode: click a state to see 3‚Äì4 teas. PRO mode: pick up to 5 ‚Äúreduce‚Äù and 5 ‚Äúevoke‚Äù and get an aggregated list.",
      langLabel:"Language",
      themeLight:"‚òÄÔ∏è Light theme",
      themeDark:"üåô Dark theme",

      badTitle:"Current states (reduce)", badHint:"20", badPill:"In PRO: pick up to 5",
      goodTitle:"Desired states (evoke)", goodHint:"20",
      goodPill1:"Morning ‚Äî ‚Äúgreener/lighter‚Äù", goodPill2:"Evening ‚Äî ‚Äúdarker/more fermented‚Äù",

      cardIdleTitle:"Pick a state",
      cardModeSingle:"Single",
      cardModePro:"PRO",
      cardDesc:"Single: click a state to see 3‚Äì4 teas. PRO aggregates recommendations for your selection.",

      why:"Why",
      hide:"hide",

      addedRemove:"Selected: ‚Äúreduce‚Äù", addedGet:"Selected: ‚Äúevoke‚Äù", teaPick:"Recommendations for selected states",
      clear:"clear", resetAll:"reset all",
      multiLine:"Above ‚Äî selected states. Below ‚Äî teas that most often fit this combination.",

      quickBrew:"<b>Quick gongfu setup:</b><br/>120‚Äì150 ml gaiwan/pot ‚Ä¢ 4‚Äì6 g (evening 3‚Äì5 g) ‚Ä¢ 5‚Äì15 s infusions, then adjust.",

      proTitle:"Select multiple states PRO",
      counter:(a,b)=>`Reduce: ${a}/5 ‚Ä¢ Evoke: ${b}/5`,

      nlpTitle:"Quick pick by description",
      nlpHint:"runs locally",
      nlpPlaceholder:"E.g. ‚Äúafter lunch I get sleepy, brain fog, want calm focus without stress‚Äù",
      nlpBtn:"Pick",
      nlpNote:"Keyword matcher selects up to 5 reduce + 5 evoke, then turns PRO on and shows reasoning.",

      prompts:{
        bad:"These teas often fit this feeling:",
        good:"To amplify this state, try:",
        proTitle:"Recommendations for selected states",
        proDesc:"Below are teas that most often fit this combination."
      },

      fineprint:"‚ÑπÔ∏è Not medical advice. Tea effects are individual; consider caffeine, strength, timing, and contraindications.",
      about:"About",

      aboutTitle:"About",
      aboutBody:`This site uses AI-generated recommendations (GPT-5.2). The mapping is based on open sources, traditional tea classification and modern tea chemistry research. It is not medical advice.`,

      limitTitle:"Selection limit",
      limitBody:"Up to 5 states from each list (10 total).",
      ok:"OK",

      buy:"buy",

      proModalTitle:"PRO mode",
      proModalQuestion:"Do you want to purchase PRO?",
      proNo:"no",
      proYes:"yes",
      proNoText:"This product is free, but if you really want, you can donate to: 2202206736083473",
      proYesText:"Nice, but the product is free. If you really want, you can donate to: 2202206736083473",

      teaModal:{
        originTitle:"Origin",
        factsTitle:"Fun facts",
        givesTitle:"Typically gives",
        whenTitle:"Often recommended when",
        brewTitle:"Brewing",
        classTitle:"Classification"
      }
    }
  };

  // =========================
  // Tea dictionary + metadata
  // =========================
  function commonsFileUrl(fileName){
    return `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(fileName).replaceAll("%2F","/")}`;
  }

  const TEA = {
    shu:        {key:"shu",        q:"—à—É –ø—É—ç—Ä —á–∞–π",        name:{ru:"–®—É –ø—É—ç—Ä", en:"Shu pu-erh"}, tag:{ru:"‚Üì –∑–∞–∑–µ–º–ª—è–µ—Ç", en:"‚Üì grounding"}, brew:{ru:"4‚Äì5 –≥ / 120‚Äì150 –º–ª ‚Ä¢ 6‚Äì8 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –≤–µ—á–µ—Ä–æ–º –Ω–µ –∫—Ä–µ–ø–∫–æ", en:"4‚Äì5 g / 120‚Äì150 ml ‚Ä¢ 6‚Äì8 infusions ‚Ä¢ keep light in the evening"} },
    chaTou:     {key:"chaTou",     q:"–ª–∞–æ —á–∞ —Ç–æ—É –ø—É—ç—Ä",    name:{ru:"–õ–∞–æ –ß–∞ –¢–æ—É (–ø—É—ç—Ä–Ω—ã–µ ‚Äú–∫–∞–º—É—à–∫–∏‚Äù)", en:"Lao Cha Tou (pu-erh nuggets)"}, tag:{ru:"‚Üì –º—è–≥–∫–æ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç", en:"‚Üì gentle calm"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ –¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –ø–æ–∑–¥–Ω–∏–º –≤–µ—á–µ—Ä–æ–º ‚Äî —Ç–æ–ø", en:"5‚Äì6 g ‚Ä¢ many infusions ‚Ä¢ great late evening (light)"} },
    liuBao:     {key:"liuBao",     q:"–ª—é –±–∞–æ —Ö—ç–π —á–∞",      name:{ru:"–õ—é –ë–∞–æ (—Ö—ç–π —á–∞)", en:"Liu Bao (hei cha)"}, tag:{ru:"‚Üì —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç", en:"‚Üì stabilizes"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ —Ö–æ—Ä–æ—à–æ –ø–æ—Å–ª–µ –µ–¥—ã", en:"4‚Äì6 g ‚Ä¢ 6‚Äì10 infusions ‚Ä¢ great after food"} },
    fuZhuan:    {key:"fuZhuan",    q:"—Ñ—É —á–∂—É–∞–Ω—å —á–∞–π",      name:{ru:"–§—É –ß–∂—É–∞–Ω—å (—Ö—ç–π —á–∞)", en:"Fu Zhuan (hei cha)"}, tag:{ru:"‚Üì —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω", en:"‚Üì steady baseline"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –º—è–≥–∫–æ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ", en:"4‚Äì6 g ‚Ä¢ 6‚Äì10 infusions ‚Ä¢ smooth and long"} },
    agedWhite:  {key:"agedWhite",  q:"–≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π —á–∞–π –ª–∞–æ –±–∞–π —á–∞", name:{ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π (–õ–∞–æ –ë–∞–π –ß–∞)", en:"Aged white tea"}, tag:{ru:"~ —Ç–∏—Ö–∏–π", en:"~ gentle"}, brew:{ru:"4‚Äì5 –≥ ‚Ä¢ 5‚Äì8 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –º—è–≥–∫–æ, —á–∏—Å—Ç–æ", en:"4‚Äì5 g ‚Ä¢ 5‚Äì8 infusions ‚Ä¢ soft & clean"} },
    white:      {key:"white",      q:"–±–µ–ª—ã–π —á–∞–π –∏–Ω—å —á–∂—ç–Ω—å",  name:{ru:"–ë–µ–ª—ã–π —á–∞–π (–ò–Ω—å –ß–∂—ç–Ω—å)", en:"White tea (Silver Needle)"}, tag:{ru:"‚Üë –º—è–≥–∫–æ", en:"‚Üë soft lift"}, brew:{ru:"4‚Äì5 –≥ ‚Ä¢ 80‚Äì90¬∞C ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã", en:"4‚Äì5 g ‚Ä¢ 80‚Äì90¬∞C ‚Ä¢ short infusions"} },
    hongCha:    {key:"hongCha",    q:"–∫—Ä–∞—Å–Ω—ã–π —á–∞–π —Ö—É–Ω —á–∞", name:{ru:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π (–î—è–Ω—å –•—É–Ω –∏ –¥—Ä.)", en:"Black tea (hong cha)"}, tag:{ru:"‚Üí —Ç—ë–ø–ª—ã–π —Ñ–æ–∫—É—Å", en:"‚Üí warm focus"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 4‚Äì7 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –±–æ–¥—Ä–∏—Ç –º—è–≥–∫–æ", en:"4‚Äì6 g ‚Ä¢ 4‚Äì7 infusions ‚Ä¢ gentle energy"} },
    green:      {key:"green",      q:"–∑–µ–ª—ë–Ω—ã–π —á–∞–π –ª—É–Ω—Ü–∑–∏–Ω", name:{ru:"–ó–µ–ª—ë–Ω—ã–π (–õ—É–Ω—Ü–∑–∏–Ω –∏ –¥—Ä.)", en:"Green tea (Longjing etc.)"}, tag:{ru:"‚Üë‚Üë —è—Å–Ω–æ—Å—Ç—å", en:"‚Üë‚Üë clarity"}, brew:{ru:"3‚Äì4 –≥ ‚Ä¢ 70‚Äì85¬∞C ‚Ä¢ –Ω–µ –ø–µ—Ä–µ–¥–µ—Ä–∂–∏–≤–∞—Ç—å", en:"3‚Äì4 g ‚Ä¢ 70‚Äì85¬∞C ‚Ä¢ don‚Äôt oversteep"} },
    lightOolong:{key:"lightOolong",q:"—Ç–µ –≥—É–∞–Ω—å –∏–Ω—å —É–ª—É–Ω",  name:{ru:"–°–≤–µ—Ç–ª—ã–π —É–ª—É–Ω (–¢–µ –ì—É–∞–Ω—å –ò–Ω—å)", en:"Light oolong (Tie Guan Yin)"}, tag:{ru:"‚Üë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", en:"‚Üë mood"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ 85‚Äì95¬∞C ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤", en:"5‚Äì6 g ‚Ä¢ 85‚Äì95¬∞C ‚Ä¢ 6‚Äì10 infusions"} },
    darkOolong: {key:"darkOolong", q:"–¥–∞ —Ö—É–Ω –ø–∞–æ —É–ª—É–Ω",    name:{ru:"–¢—ë–º–Ω—ã–π —É–ª—É–Ω (–î–∞ –•—É–Ω –ü–∞–æ)", en:"Dark oolong (Da Hong Pao)"}, tag:{ru:"‚Üí/‚Üì –≥–ª—É–±–∏–Ω–∞", en:"‚Üí/‚Üì depth"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ 95‚Äì100¬∞C ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤", en:"5‚Äì6 g ‚Ä¢ 95‚Äì100¬∞C ‚Ä¢ 6‚Äì10 infusions"} },
    sheng:      {key:"sheng",      q:"—à–µ–Ω –ø—É—ç—Ä —á–∞–π",       name:{ru:"–®—ç–Ω –ø—É—ç—Ä (—Å—ã—Ä–æ–π)", en:"Sheng pu-erh"}, tag:{ru:"‚Üë‚Üë –±–æ–¥—Ä–∏—Ç", en:"‚Üë‚Üë energizing"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã ‚Ä¢ –ª—É—á—à–µ –¥–æ 14:00", en:"4‚Äì6 g ‚Ä¢ short infusions ‚Ä¢ best before 2pm"} },
    yancha:     {key:"yancha",     q:"—è–Ω—å—á–∞ —É–∏—à–∞–Ω—å —É–ª—É–Ω",  name:{ru:"–Ø–Ω—å—á–∞ (—É—Ç—ë—Å–Ω—ã–µ —É–ª—É–Ω—ã –£–∏)", en:"Yancha (Wuyi rock oolong)"}, tag:{ru:"‚Üí –≥–ª—É–±–æ–∫–∏–π —Ñ–æ–∫—É—Å", en:"‚Üí deep focus"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ –∫–∏–ø—è—Ç–æ–∫ ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã", en:"5‚Äì6 g ‚Ä¢ boiling water ‚Ä¢ short infusions"} }
  };

  // request #9: images from open sources + classification fields
  const TEA_ASSETS = {
    shu:        { img: commonsFileUrl("Da_Yi_Gong_Tuo_Pu-erh_shou_cha,_2010.jpg"), credit: "Wikimedia Commons" },
    chaTou:     { img: commonsFileUrl("110601_204646.jpg"), credit: "Wikimedia Commons" },
    liuBao:     { img: commonsFileUrl("Liu_Bao_tea_20141011.jpg"), credit: "Wikimedia Commons" },
    fuZhuan:    { img: commonsFileUrl("Brick_tea_(Old_Fort_Erie).jpg"), credit: "Wikimedia Commons" },
    agedWhite:  { img: commonsFileUrl("Shou_Mei_tea.JPG"), credit: "Wikimedia Commons" },
    white:      { img: commonsFileUrl("Silver_needle_white_tea.jpg"), credit: "Wikimedia Commons" },
    hongCha:    { img: commonsFileUrl("Dianhong_Yunnan_black_tea.JPG"), credit: "Wikimedia Commons" },
    green:      { img: commonsFileUrl("Longjing_tea.jpg"), credit: "Wikimedia Commons" },
    lightOolong:{ img: commonsFileUrl("Tieguanyin2.jpg"), credit: "Wikimedia Commons" },
    darkOolong: { img: commonsFileUrl("Da_Hong_Pao_Tea.JPG"), credit: "Wikimedia Commons" },
    sheng:      { img: commonsFileUrl("Pu-erh_tea_from_Yunnan_Sourcing.jpg"), credit: "Wikimedia Commons" },
    yancha:     { img: commonsFileUrl("Wuyi_cliff_tea.jpg"), credit: "Wikimedia Commons" }
  };

  // ‚ÄúSafe‚Äù origin+facts (kept from your version, shortened where possible)
  const TEA_META = {
    shu: {
      origin:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π. ¬´–®—É¬ª ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–π —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏–∏ (–≤–æ–¥—É–π).", en:"Yunnan, China. ‚ÄúShu‚Äù uses accelerated fermentation (wo dui)." },
      facts:{ ru:["–ö—Ä–µ–ø–∫–∞—è –∑–∞–≤–∞—Ä–∫–∞ –º–æ–∂–µ—Ç –±–æ–¥—Ä–∏—Ç—å, —Ö–æ—Ç—è –ø—Ä–æ—Ñ–∏–ª—å —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–∑–µ–º–ª—è—é—â–∏–π.","–ê—Ä–æ–º–∞—Ç–∏–∫–∞ —á–∞—Å—Ç–æ –¥—Ä–µ–≤–µ—Å–Ω–æ-–æ—Ä–µ—Ö–æ–≤–∞—è/—à–æ–∫–æ–ª–∞–¥–Ω–∞—è/–∑–µ–º–ª–∏—Å—Ç–∞—è."],
             en:["Brewed strong it can be energizing, even if it feels grounding.","Often woody/nutty/cocoa/earthy aromas."] }
    },
    chaTou:{
      origin:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π. –ü–ª–æ—Ç–Ω—ã–µ ¬´–∫–∞–º—É—à–∫–∏¬ª –∏–∑ –ø—É—ç—Ä–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞.", en:"Yunnan, China. Dense nuggets from pu-erh processing." },
      facts:{ ru:["–î–æ–ª–≥–æ –¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–ª–∏–≤—ã –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.","–£–¥–æ–±–µ–Ω –≤ –¥–æ—Ä–æ–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ."],
             en:["Handles many infusions and opens gradually.","Travel-friendly."] }
    },
    liuBao:{
      origin:{ ru:"–ì—É–∞–Ω—Å–∏, –ö–∏—Ç–∞–π (–¶–∞–Ω—ä—É / –£—á–∂–æ—É). –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —Ö—ç–π —á–∞.", en:"Guangxi, China (Cangwu/Wuzhou). Traditional hei cha." },
      facts:{ ru:["–ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –ø–æ—Å–ª–µ –µ–¥—ã.","–í—ã–¥–µ—Ä–∂–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ —á–∏—Å—Ç–æ—Ç—É."],
             en:["Often chosen after food.","Aging can add depth and cleanliness."] }
    },
    fuZhuan:{
      origin:{ ru:"–ö–∏—Ç–∞–π (–•—É–Ω–∞–Ω—å/–®—ç–Ω—å—Å–∏ ‚Äî —Ä–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏). –•—ç–π —á–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–∏—Ä–ø–∏—á–∞.", en:"China (Hunan/Shaanxi styles). Hei cha in brick form." },
      facts:{ ru:["–ú–Ω–æ–≥–∏–µ –ª—é–±—è—Ç –∑–∞ —Ä–æ–≤–Ω—ã–π ¬´–¥–ª–∏–Ω–Ω—ã–π —Ñ–æ–Ω¬ª.","–£–º–µ—Ä–µ–Ω–Ω–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞."],
             en:["Often valued for long, even baseline.","Best kept moderate."] }
    },
    agedWhite:{
      origin:{ ru:"–§—É—Ü–∑—è–Ω—å, –ö–∏—Ç–∞–π. –í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π (—á–∞—Å—Ç–æ –®–æ—É –ú—ç–π/–ë–∞–π –ú—É –î–∞–Ω—å).", en:"Fujian, China. Aged white (often Shou Mei/Bai Mu Dan)." },
      facts:{ ru:["–° –≤–æ–∑—Ä–∞—Å—Ç–æ–º —É—Ö–æ–¥–∏—Ç –≤ –º—ë–¥/—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã/—Ç—ë–ø–ª—ã–µ —Ç—Ä–∞–≤—ã.","–í–µ—á–µ—Ä–æ–º –æ–±—ã—á–Ω–æ –∫–æ–º—Ñ–æ—Ä—Ç–µ–Ω –ø—Ä–∏ –ª—ë–≥–∫–æ–π –∫—Ä–µ–ø–æ—Å—Ç–∏."],
             en:["With age can move toward honey/dried fruit/warm herbs.","Often comfortable in the evening when brewed lightly."] }
    },
    white:{
      origin:{ ru:"–§—É—Ü–∑—è–Ω—å, –ö–∏—Ç–∞–π. –ë–µ–ª—ã–π —á–∞–π (–ò–Ω—å –ß–∂—ç–Ω—å).", en:"Fujian, China. White tea (Silver Needle)." },
      facts:{ ru:["–õ—É—á—à–µ —É–º–µ—Ä–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã.","–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤–æ–¥–µ ‚Äî –º—è–≥–∫–∞—è –≤–æ–¥–∞ —á–∞—Å—Ç–æ ¬´—Å–ª–∞—Å—Ç–∏—Ç¬ª."],
             en:["Moderate temps + short steeps are best.","Water quality matters a lot; softer water can taste sweeter."] }
    },
    hongCha:{
      origin:{ ru:"–ö–∏—Ç–∞–π (–º–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π). ¬´–ö—Ä–∞—Å–Ω—ã–π¬ª –ø–æ –∫–∏—Ç–∞–π—Å–∫–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.", en:"China (many regional styles). Called ‚Äúred tea‚Äù in Chinese." },
      facts:{ ru:["–û–±—ã—á–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ç—ë–ø–ª–∞—è –±–æ–¥—Ä–æ—Å—Ç—å¬ª.","–î–∏–∞–ø–∞–∑–æ–Ω –≤–∫—É—Å–æ–≤: –∫–∞—Ä–∞–º–µ–ª—å/—Ö–ª–µ–± ‚Üí –∫–∞–∫–∞–æ/—Å–ø–µ—Ü–∏–∏."],
             en:["Often felt as ‚Äúwarm energy‚Äù.","Flavor range: caramel/bread ‚Üí cocoa/spice."] }
    },
    green:{
      origin:{ ru:"–ö–∏—Ç–∞–π (–≤ —Ç.—á. –ß–∂—ç—Ü–∑—è–Ω). –ó–µ–ª—ë–Ω—ã–π —á–∞–π (–ø—Ä–∏–º–µ—Ä: –õ—É–Ω—Ü–∑–∏–Ω).", en:"China (incl. Zhejiang). Green tea (e.g., Longjing)." },
      facts:{ ru:["–°–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–≤–µ–∂–µ—Å—Ç–∏.","–ü–µ—Ä–µ–¥–µ—Ä–∂–∫–∞ –±—ã—Å—Ç—Ä–æ –¥–∞—ë—Ç –≥–æ—Ä–µ—á—å."],
             en:["Freshness matters a lot.","Oversteeping turns bitter quickly."] }
    },
    lightOolong:{
      origin:{ ru:"–§—É—Ü–∑—è–Ω—å (–ê–Ω—å—Å–∏) / –¢–∞–π–≤–∞–Ω—å. –°–≤–µ—Ç–ª—ã–µ —É–ª—É–Ω—ã.", en:"Fujian (Anxi) / Taiwan. Light oolongs." },
      facts:{ ru:["–ß–∞—Å—Ç–æ —Ü–≤–µ—Ç–æ—á–Ω–æ-—Å–ª–∏–≤–æ—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏ ¬´–≤–æ–∑–≤—Ä–∞—Ç–Ω–∞—è —Å–ª–∞–¥–æ—Å—Ç—å¬ª.","–°–∏–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ –ø—Ä–æ–ª–∏–≤–∞–º."],
             en:["Often floral/creamy with lingering sweetness.","Evolves a lot across infusions."] }
    },
    darkOolong:{
      origin:{ ru:"–§—É—Ü–∑—è–Ω—å, –£–∏. –¢—ë–º–Ω—ã–µ —É–ª—É–Ω—ã/–æ–±–∂–∞—Ä–∫–∞.", en:"Fujian, Wuyi. Dark/roasted oolongs." },
      facts:{ ru:["–û–±–∂–∞—Ä–∫–∞ –¥–∞—ë—Ç –≥–ª—É–±–∏–Ω—É –∏ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–π —Ç–æ–Ω.","–õ—é–±–∏—Ç –∫–∏–ø—è—Ç–æ–∫ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã."],
             en:["Roast adds depth and warming tone.","Likes boiling water and short infusions."] }
    },
    sheng:{
      origin:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π ¬´—Å—ã—Ä–æ–π¬ª –ø—É—ç—Ä.", en:"Yunnan, China. Traditional raw pu-erh." },
      facts:{ ru:["–ú–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∑–∫–æ–≤–∞—Ç –¥–ª—è —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö ‚Äî –≤–∞–∂–Ω–∞ –¥–æ–∑–∏—Ä–æ–≤–∫–∞.","–í—ã–¥–µ—Ä–∂–∫–∞ –æ–±—ã—á–Ω–æ —Å–º—è–≥—á–∞–µ—Ç —É–≥–ª—ã."],
             en:["Can feel sharp if you‚Äôre anxious‚Äîdose matters.","Aging often rounds edges."] }
    },
    yancha:{
      origin:{ ru:"–§—É—Ü–∑—è–Ω—å, –£–∏. ¬´–£—Ç—ë—Å–Ω—ã–µ¬ª —É–ª—É–Ω—ã (—è–Ω—å—á–∞).", en:"Fujian, Wuyi. Rock oolongs (yancha)." },
      facts:{ ru:["–ß–∞—Å—Ç–æ –æ–ø–∏—Å—ã–≤–∞—é—Ç ¬´–º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ—Å—Ç—å¬ª.","–û—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤–æ–¥–µ –∏ —Ç–∞–π–º–∏–Ω–≥—É."],
             en:["Often described as mineral.","Very sensitive to water and timing."] }
    }
  };

  // Classification (request #9)
  const TEA_CLASS = {
    shu:{
      ru:{
        fermentation:"–í—ã—Å–æ–∫–∞—è (—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è / –ø–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è)",
        processing:"–í–æ–¥—É–π (—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –±—Ä–æ–∂–µ–Ω–∏–µ), –ø—Ä–µ—Å—Å/—Ä–∞—Å—Å—ã–ø–Ω–æ–π",
        material:"–ö—Ä—É–ø–Ω—ã–π –ª–∏—Å—Ç –∏ –ø–æ—á–∫–∏ Camellia sinensis var. assamica; –≤–µ—Å–µ–Ω–Ω–∏–π/–æ—Å–µ–Ω–Ω–∏–π —Å–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä—Ç–∏–∏",
        region:"–Æ–Ω—å–Ω–∞–Ω—å (—Ä–∞–∑–Ω—ã–µ —É–µ–∑–¥—ã/–≥–æ—Ä—ã)",
        profile:"–î—Ä–µ–≤–µ—Å–Ω—ã–π, –æ—Ä–µ—Ö–æ–≤—ã–π, –∫–∞–∫–∞–æ, ¬´–∑–µ–º–ª–∏—Å—Ç—ã–π¬ª, –∏–Ω–æ–≥–¥–∞ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã",
        texture:"–ü–ª–æ—Ç–Ω—ã–π, –±–∞—Ä—Ö–∞—Ç–∏—Å—Ç—ã–π, —Ç—ë–ø–ª—ã–π –Ω–∞—Å—Ç–æ–π",
        effect:"–†–æ–≤–Ω–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å, ¬´–∑–∞–∑–µ–º–ª–µ–Ω–∏–µ¬ª; –ø—Ä–∏ –∫—Ä–µ–ø–æ—Å—Ç–∏ ‚Äî –±–æ–¥—Ä–∏—Ç",
        aging:"–û–±—ã—á–Ω–æ 1‚Äì10+ –ª–µ—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—É—ç—Ä–∞)",
        format:"–ë–ª–∏–Ω/–∫–∏—Ä–ø–∏—á/—Ç–æ—á–∞/—Ä–∞—Å—Å—ã–ø–Ω–æ–π",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤, 18‚Äì25¬∞C, —É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è"
      },
      en:{
        fermentation:"High (accelerated fermentation / post-fermented)",
        processing:"Wo dui, often pressed or loose",
        material:"Large-leaf material (assamica); harvest depends on batch",
        region:"Yunnan (various counties/mountains)",
        profile:"Woody, nutty, cocoa, earthy, sometimes dried fruit",
        texture:"Dense, velvety, warm liquor",
        effect:"Steady composure/grounding; strong brew can energize",
        aging:"Often 1‚Äì10+ years (batch dependent)",
        format:"Cake/brick/tuo/loose",
        storage:"Dry, odor-free, 18‚Äì25¬∞C, moderate airflow"
      }
    },
    chaTou:{
      ru:{
        fermentation:"–í—ã—Å–æ–∫–∞—è (–∫–∞–∫ —É —à—É-–ø—É—ç—Ä–∞ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤)",
        processing:"–ü–ª–æ—Ç–Ω—ã–µ ¬´–∫–∞–º—É—à–∫–∏¬ª; –æ–±—ã—á–Ω–æ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã/–Ωuggets",
        material:"–ü—É—ç—Ä–Ω–æ–µ —Å—ã—Ä—å—ë, —É–ø–ª–æ—Ç–Ω–∏–≤—à–µ–µ—Å—è –ø—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ",
        region:"–Æ–Ω—å–Ω–∞–Ω—å",
        profile:"–î—Ä–µ–≤–µ—Å–Ω—ã–π, –∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π, –æ—Ä–µ—Ö–æ–≤—ã–π, ¬´—Ç—ë–ø–ª—ã–π¬ª",
        texture:"–û—á–µ–Ω—å —Ä–æ–≤–Ω—ã–π, –ø–ª–æ—Ç–Ω—ã–π, –¥–æ–ª–≥–æ –¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–ª–∏–≤—ã",
        effect:"–ú—è–≥–∫–æ–µ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ + —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
        aging:"–ß–∞—Å—Ç–æ 1‚Äì10+ –ª–µ—Ç (–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–µ)",
        format:"–ùuggets (–∫–∞–º—É—à–∫–∏)",
        storage:"–ö–∞–∫ –ø—É—ç—Ä: —Å—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤, —É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è"
      },
      en:{
        fermentation:"High (often similar to shu pu-erh)",
        processing:"Dense nuggets (cha tou)",
        material:"Pu-erh material compacted during processing",
        region:"Yunnan",
        profile:"Woody, caramel, nutty, warm",
        texture:"Very even and long-lasting across infusions",
        effect:"Gentle calm + steady baseline",
        aging:"Often 1‚Äì10+ years",
        format:"Nuggets",
        storage:"Like pu-erh: dry, odor-free, moderate airflow"
      }
    },
    liuBao:{
      ru:{
        fermentation:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (—Ö—ç–π —á–∞)",
        processing:"–•—ç–π —á–∞: —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è/—Å—É—à–∫–∞; —á–∞—Å—Ç–æ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç",
        material:"–õ–∏—Å—Ç–æ–≤–æ–µ —Å—ã—Ä—å—ë; –ø–∞—Ä—Ç–∏–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ø–æ —Å–±–æ—Ä—É",
        region:"–ì—É–∞–Ω—Å–∏ (–¶–∞–Ω—ä—É/–£—á–∂–æ—É)",
        profile:"–¢—ë–ø–ª—ã–π –¥—Ä–µ–≤–µ—Å–Ω—ã–π, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –∏–Ω–æ–≥–¥–∞ –∫–∞–º—Ñ–æ—Ä–∞",
        texture:"–ì–ª–∞–¥–∫–∏–π, –æ–∫—Ä—É–≥–ª—ã–π –Ω–∞—Å—Ç–æ–π",
        effect:"–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è, –∫–æ–º—Ñ–æ—Ä—Ç –ø–æ—Å–ª–µ –µ–¥—ã",
        aging:"–ß–∞—Å—Ç–æ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç 1‚Äì15+ –ª–µ—Ç",
        format:"–†–∞—Å—Å—ã–ø–Ω–æ–π/–∫–∏—Ä–ø–∏—á/–∫–æ—Ä–∑–∏–Ω—ã –∏ –¥—Ä.",
        storage:"–°—É—Ö–æ, –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –∑–∞–ø–∞—Ö–æ–≤; —Ç–µ—Ä–ø–∏—Ç —É–º–µ—Ä–µ–Ω–Ω—É—é –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é"
      },
      en:{
        fermentation:"Post-fermented (hei cha)",
        processing:"Hei-cha fermentation + drying; often aged",
        material:"Leaf material varies by batch",
        region:"Guangxi (Cangwu/Wuzhou)",
        profile:"Warm woody, dried fruit, sometimes camphor",
        texture:"Smooth, rounded liquor",
        effect:"Stability, post-meal comfort",
        aging:"Often aged 1‚Äì15+ years",
        format:"Loose/brick/etc.",
        storage:"Dry, odor-free; moderate airflow"
      }
    },
    fuZhuan:{
      ru:{
        fermentation:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (—Ö—ç–π —á–∞)",
        processing:"–ö–∏—Ä–ø–∏—á–Ω—ã–π —Ö—ç–π —á–∞; –æ–±—â–µ–µ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏–µ/–≤—ã–¥–µ—Ä–∂–∫–∞",
        material:"–õ–∏—Å—Ç–æ–≤–æ–µ —Å—ã—Ä—å—ë; –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è",
        region:"–ö–∏—Ç–∞–π (—á–∞—Å—Ç–æ –•—É–Ω–∞–Ω—å/–®—ç–Ω—å—Å–∏ —Å—Ç–∏–ª–µ–≤—ã–µ —à–∫–æ–ª—ã)",
        profile:"–•–ª–µ–±–Ω—ã–µ/—Å–æ–ª–æ–¥–æ–≤—ã–µ, –æ—Ä–µ—Ö, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, ¬´—Ç—ë–ø–ª–∞—è —Å–ª–∞–¥–æ—Å—Ç—å¬ª",
        texture:"–†–æ–≤–Ω—ã–π, ¬´–¥–ª–∏–Ω–Ω—ã–π¬ª –Ω–∞—Å—Ç–æ–π",
        effect:"–°–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–Ω, –º—è–≥–∫–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",
        aging:"–ß–∞—Å—Ç–æ 1‚Äì10+ –ª–µ—Ç",
        format:"–ö–∏—Ä–ø–∏—á (fu brick)",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤, –Ω–µ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞—Ç—å"
      },
      en:{
        fermentation:"Post-fermented (hei cha)",
        processing:"Brick hei cha; matured/aged",
        material:"Leaf material depends on maker",
        region:"China (often Hunan/Shaanxi schools)",
        profile:"Bready/malty, nutty, dried fruit, warm sweetness",
        texture:"Even, long liquor",
        effect:"Calm baseline, gentle steadiness",
        aging:"Often 1‚Äì10+ years",
        format:"Brick",
        storage:"Dry, odor-free, avoid heat"
      }
    },
    agedWhite:{
      ru:{
        fermentation:"–õ—ë–≥–∫–∞—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è (–≤—ã–¥–µ—Ä–∂–∫–∞/–æ–∫–∏—Å–ª–µ–Ω–∏–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)",
        processing:"–ë–µ–ª—ã–π —á–∞–π: –ø–æ–¥–≤—è–ª–∏–≤–∞–Ω–∏–µ + —Å—É—à–∫–∞; –¥–∞–ª–µ–µ –≤—ã–¥–µ—Ä–∂–∫–∞",
        material:"–ü–æ—á–∫–∏/–ª–∏—Å—Ç (—á–∞—Å—Ç–æ –®–æ—É –ú—ç–π/–ë–∞–π –ú—É –î–∞–Ω—å)",
        region:"–§—É—Ü–∑—è–Ω—å (–§—É–¥–∏–Ω/–ß–∂—ç–Ω—Ö—ç ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä—Ç–∏–∏)",
        profile:"–ú—ë–¥, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, —Ç—ë–ø–ª—ã–µ —Ç—Ä–∞–≤—ã",
        texture:"–ú—è–≥–∫–∏–π, –æ–∫—Ä—É–≥–ª—ã–π",
        effect:"–¢–∏—à–∏–Ω–∞, —Å–Ω–∏–∂–µ–Ω–∏–µ ¬´—à—É–º–∞¬ª, –º—è–≥–∫–∞—è —è—Å–Ω–æ—Å—Ç—å",
        aging:"–û–±—ã—á–Ω–æ 2‚Äì15+ –ª–µ—Ç",
        format:"–†–∞—Å—Å—ã–ø–Ω–æ–π/–ø—Ä–µ—Å—Å–æ–≤–∞–Ω–Ω—ã–π –±–ª–∏–Ω/–∫–∏—Ä–ø–∏—á",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"
      },
      en:{
        fermentation:"Light natural (aging/slow oxidation)",
        processing:"White tea: wither + dry, then aged",
        material:"Buds/leaves (often Shou Mei/Bai Mu Dan)",
        region:"Fujian (batch dependent)",
        profile:"Honey, dried fruit, warm herbs",
        texture:"Soft, rounded",
        effect:"Inner quiet, lower mental noise, gentle clarity",
        aging:"Often 2‚Äì15+ years",
        format:"Loose or pressed",
        storage:"Dry, odor-free, stable temperature"
      }
    },
    white:{
      ru:{
        fermentation:"–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è",
        processing:"–ë–µ–ª—ã–π —á–∞–π: –ø–æ–¥–≤—è–ª–∏–≤–∞–Ω–∏–µ + —Å—É—à–∫–∞",
        material:"–ü–æ—á–∫–∏ (–ò–Ω—å –ß–∂—ç–Ω—å) / —Ä–∞–Ω–Ω–∏–π —Å–±–æ—Ä",
        region:"–§—É—Ü–∑—è–Ω—å",
        profile:"–¶–≤–µ—Ç–æ—á–Ω–æ-–º–µ–¥–æ–≤—ã–π, —Å–≤–µ–∂–∏–π, —Ç–æ–Ω–∫–∏–π",
        texture:"–õ—ë–≥–∫–∏–π, —à–µ–ª–∫–æ–≤–∏—Å—Ç—ã–π",
        effect:"–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —è—Å–Ω–æ—Å—Ç—å",
        aging:"–°–≤–µ–∂–∏–π (0‚Äì2 –≥–æ–¥–∞) –∏–ª–∏ –≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä—Ç–∏–∏)",
        format:"–†–∞—Å—Å—ã–ø–Ω–æ–π",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; –±–µ—Ä–µ—á—å –æ—Ç –≤–ª–∞–≥–∏"
      },
      en:{
        fermentation:"Minimal",
        processing:"Wither + dry",
        material:"Buds (Silver Needle), early harvest",
        region:"Fujian",
        profile:"Floral-honey, fresh, delicate",
        texture:"Light, silky",
        effect:"Gentle lift and clarity",
        aging:"Fresh or aged (batch dependent)",
        format:"Loose",
        storage:"Dry, odor-free; avoid moisture"
      }
    },
    hongCha:{
      ru:{
        fermentation:"–û–∫–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Å–æ–∫–æ–µ (–∫—Ä–∞—Å–Ω—ã–π/black tea)",
        processing:"–ó–∞–≤—è–ª–∏–≤–∞–Ω–∏–µ ‚Üí —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ ‚Üí –æ–∫–∏—Å–ª–µ–Ω–∏–µ ‚Üí —Å—É—à–∫–∞",
        material:"–ü–æ—á–∫–∏+–ª–∏—Å—Ç (—á–∞—Å—Ç–æ –≤–µ—Å–Ω–∞)",
        region:"–ö–∏—Ç–∞–π (–ø—Ä–∏–º–µ—Ä: –Æ–Ω—å–Ω–∞–Ω—å ‚Äî –î—è–Ω—å –•—É–Ω)",
        profile:"–ö–∞—Ä–∞–º–µ–ª—å, —Ö–ª–µ–±, –∫–∞–∫–∞–æ, —Å–ø–µ—Ü–∏–∏",
        texture:"–ü–ª–æ—Ç–Ω—ã–π, —Ç—ë–ø–ª—ã–π",
        effect:"–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è, —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å",
        aging:"–û–±—ã—á–Ω–æ —Å–≤–µ–∂–∏–π 0‚Äì3 –≥–æ–¥–∞ (—á–∞—Å—Ç–æ –ø—å—é—Ç —Å–≤–µ–∂–∏–º)",
        format:"–†–∞—Å—Å—ã–ø–Ω–æ–π",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; –≥–µ—Ä–º–µ—Ç–∏—á–Ω–µ–µ, —á–µ–º –ø—É—ç—Ä—ã"
      },
      en:{
        fermentation:"High oxidation",
        processing:"Wither ‚Üí roll ‚Üí oxidize ‚Üí dry",
        material:"Buds + leaf (often spring)",
        region:"China (e.g., Yunnan Dianhong)",
        profile:"Caramel, bread, cocoa, spice",
        texture:"Full, warm",
        effect:"Warm energy, composed focus",
        aging:"Often enjoyed fresh (0‚Äì3 years)",
        format:"Loose",
        storage:"Dry, odor-free; more airtight than pu-erh"
      }
    },
    green:{
      ru:{
        fermentation:"–ù–µ—Ç (—Ñ–∏–∫—Å–∞—Ü–∏—è –∑–µ–ª–µ–Ω–∏)",
        processing:"–®–∞ —Ü–∏–Ω (–ø—Ä–æ–∂–∞—Ä–∫–∞/–ø—Ä–æ–ø–∞—Ä–∏–≤–∞–Ω–∏–µ) ‚Üí —Ñ–æ—Ä–º–æ–≤–∫–∞ ‚Üí —Å—É—à–∫–∞",
        material:"–ú–æ–ª–æ–¥–æ–π –ª–∏—Å—Ç/–ø–æ—á–∫–∏",
        region:"–ö–∏—Ç–∞–π (–ø—Ä–∏–º–µ—Ä: –ß–∂—ç—Ü–∑—è–Ω ‚Äî –õ—É–Ω—Ü–∑–∏–Ω)",
        profile:"–û—Ä–µ—Ö–æ–≤–æ-—Ç—Ä–∞–≤—è–Ω–æ–π, —Å–≤–µ–∂–∏–π",
        texture:"–õ—ë–≥–∫–∏–π, —á–∏—Å—Ç—ã–π",
        effect:"–Ø—Å–Ω–æ—Å—Ç—å, –≤–∫–ª—é—á–µ–Ω–∏–µ, –±–æ–¥—Ä–æ—Å—Ç—å",
        aging:"–õ—É—á—à–µ —Å–≤–µ–∂–∏–π (0‚Äì12 –º–µ—Å—è—Ü–µ–≤)",
        format:"–†–∞—Å—Å—ã–ø–Ω–æ–π",
        storage:"–ì–µ—Ä–º–µ—Ç–∏—á–Ω–æ, –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ, –±–µ–∑ —Å–≤–µ—Ç–∞/–≤–ª–∞–≥–∏"
      },
      en:{
        fermentation:"None (green fixation)",
        processing:"Kill-green ‚Üí shape ‚Üí dry",
        material:"Young leaves/buds",
        region:"China (e.g., Zhejiang Longjing)",
        profile:"Nutty-green, fresh",
        texture:"Light, clean",
        effect:"Clarity and activation",
        aging:"Best fresh (0‚Äì12 months)",
        format:"Loose",
        storage:"Airtight, cool, dark, dry"
      }
    },
    lightOolong:{
      ru:{
        fermentation:"–ù–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ)",
        processing:"–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ, —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ/—Ñ–æ—Ä–º–æ–≤–∫–∞, –∏–Ω–æ–≥–¥–∞ –ª—ë–≥–∫–∞—è –æ–±–∂–∞—Ä–∫–∞",
        material:"–õ–∏—Å—Ç (—á–∞—Å—Ç–æ –≤–µ—Å–µ–Ω–Ω–∏–π)",
        region:"–§—É—Ü–∑—è–Ω—å (–ê–Ω—å—Å–∏) / –¢–∞–π–≤–∞–Ω—å",
        profile:"–¶–≤–µ—Ç–æ—á–Ω—ã–π, —Å–ª–∏–≤–æ—á–Ω—ã–π, ¬´–≤–æ–∑–≤—Ä–∞—Ç–Ω–∞—è —Å–ª–∞–¥–æ—Å—Ç—å¬ª",
        texture:"–°–æ—á–Ω—ã–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π",
        effect:"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å",
        aging:"–û–±—ã—á–Ω–æ —Å–≤–µ–∂–∏–π (0‚Äì2 –≥–æ–¥–∞), –±—ã–≤–∞–µ—Ç –≤—ã–¥–µ—Ä–∂–∫–∞/–æ–±–∂–∞—Ä–∫–∞",
        format:"–°–∫—Ä—É—á–µ–Ω–Ω—ã–π –ª–∏—Å—Ç",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; –±–µ—Ä–µ—á—å –∞—Ä–æ–º–∞—Ç"
      },
      en:{
        fermentation:"Low/medium (partial oxidation)",
        processing:"Partial oxidation, shaping; sometimes light roast",
        material:"Leaf (often spring)",
        region:"Fujian (Anxi) / Taiwan",
        profile:"Floral, creamy, lingering sweetness",
        texture:"Juicy, aromatic",
        effect:"Mood lift, light composure",
        aging:"Often fresh; some styles are aged/roasted",
        format:"Rolled leaf",
        storage:"Dry, odor-free; protect aroma"
      }
    },
    darkOolong:{
      ru:{
        fermentation:"–°—Ä–µ–¥–Ω—è—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ)",
        processing:"–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ + –æ–±–∂–∞—Ä–∫–∞ (–∫–ª—é—á–µ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä)",
        material:"–õ–∏—Å—Ç",
        region:"–§—É—Ü–∑—è–Ω—å (–£–∏)",
        profile:"–ñ–∞—Ä–µ–Ω—ã–µ –Ω–æ—Ç—ã, –∫–∞–∫–∞–æ, –ø–µ—á—ë–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã, –º–∏–Ω–µ—Ä–∞–ª—ã",
        texture:"–ü–ª–æ—Ç–Ω—ã–π, —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–π",
        effect:"–ì–ª—É–±–∏–Ω–∞, —Ñ–æ–∫—É—Å, ¬´–ø–ª–æ—Ç–Ω–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å¬ª",
        aging:"–ë—ã–≤–∞–µ—Ç ¬´–æ—Ç–ª–µ–∂–∫–∞¬ª –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏; –∏–Ω–æ–≥–¥–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç",
        format:"–ü–æ–ª–æ—Å–∞—Ç—ã–π –ª–∏—Å—Ç",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"
      },
      en:{
        fermentation:"Medium (partial oxidation)",
        processing:"Partial oxidation + roast (key driver)",
        material:"Leaf",
        region:"Fujian (Wuyi)",
        profile:"Roasty, cocoa, baked fruit, mineral",
        texture:"Dense, warming",
        effect:"Depth and focus",
        aging:"Often rested post-roast; some aged",
        format:"Strip leaf",
        storage:"Dry, odor-free; stable temp"
      }
    },
    sheng:{
      ru:{
        fermentation:"–ù–∏–∑–∫–∞—è (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–¥–µ—Ä–∂–∫–µ)",
        processing:"–®—ç–Ω: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ/—Å—É—à–∫–∞, –∑–∞—Ç–µ–º –≤—ã–¥–µ—Ä–∂–∫–∞",
        material:"–ö—Ä—É–ø–Ω–æ–ª–∏—Å—Ç–æ–≤–æ–µ —Å—ã—Ä—å—ë (assamica)",
        region:"–Æ–Ω—å–Ω–∞–Ω—å",
        profile:"–¢—Ä–∞–≤—è–Ω–∏—Å—Ç—ã–π/—Ñ—Ä—É–∫—Ç–æ–≤—ã–π/—Ü–≤–µ—Ç–æ—á–Ω—ã–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–æ—Ä—ã –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞)",
        texture:"–û—Ç –ª—ë–≥–∫–æ–≥–æ –¥–æ –ø–ª–æ—Ç–Ω–æ–≥–æ",
        effect:"–ß–∏—Å—Ç–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å ¬´–æ—Å—Ç—Ä—ã–º¬ª –ø—Ä–∏ –∫—Ä–µ–ø–æ—Å—Ç–∏)",
        aging:"0‚Äì30+ –ª–µ—Ç",
        format:"–ë–ª–∏–Ω—ã/—Ç–æ—á–∏/–∫–∏—Ä–ø–∏—á–∏/—Ä–∞—Å—Å—ã–ø–Ω–æ–π",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; —É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è"
      },
      en:{
        fermentation:"Low (natural aging over time)",
        processing:"Sheng: process then age",
        material:"Large-leaf assamica",
        region:"Yunnan",
        profile:"Green/fruity/floral depending on terroir and age",
        texture:"From light to full",
        effect:"Clean energy and focus (can feel sharp if strong)",
        aging:"0‚Äì30+ years",
        format:"Cakes/tuo/bricks/loose",
        storage:"Dry, odor-free; moderate airflow"
      }
    },
    yancha:{
      ru:{
        fermentation:"–°—Ä–µ–¥–Ω—è—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ)",
        processing:"–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ + –æ–±–∂–∞—Ä–∫–∞ (—É—Ç—ë—Å–Ω—ã–µ —É–ª—É–Ω—ã)",
        material:"–õ–∏—Å—Ç",
        region:"–§—É—Ü–∑—è–Ω—å (–£–∏)",
        profile:"–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–æ—Å—Ç—å, –ø–µ—á—ë–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã, –∂–∞—Ä–µ–Ω—ã–µ –Ω–æ—Ç—ã",
        texture:"–°–æ–±—Ä–∞–Ω–Ω—ã–π, ¬´—Å—É—Ö–æ–≤–∞—Ç—ã–π¬ª –Ω–æ –≥–ª—É–±–æ–∫–æ –∞—Ä–æ–º–∞—Ç–Ω—ã–π",
        effect:"–ì–ª—É–±–æ–∫–∏–π —Ñ–æ–∫—É—Å –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        aging:"–û—Ç —Å–≤–µ–∂–∏—Ö –¥–æ ¬´–æ—Ç–ª–µ–∂–∞–≤—à–∏—Ö—Å—è¬ª –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏",
        format:"–ü–æ–ª–æ—Å–∞—Ç—ã–π –ª–∏—Å—Ç",
        storage:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; –±–µ—Ä–µ—á—å –æ—Ç –≤–ª–∞–≥–∏"
      },
      en:{
        fermentation:"Medium (partial oxidation)",
        processing:"Partial oxidation + roast (rock oolong)",
        material:"Leaf",
        region:"Fujian (Wuyi)",
        profile:"Mineral, baked fruit, roast",
        texture:"Collected, aromatic",
        effect:"Deep focus and attentiveness",
        aging:"Fresh to rested post-roast",
        format:"Strip leaf",
        storage:"Dry, odor-free; avoid moisture"
      }
    }
  };

  // Tea details: description + states (kept)
  const TEA_DETAILS = {
    shu: { desc:{ru:"–ü–ª–æ—Ç–Ω—ã–π —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—ç—Ä: —á–∞—Å—Ç–æ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ä–æ–≤–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç¬ª –∏ –º—è–≥–∫–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –±–æ–¥—Ä–∏—Ç—å, –µ—Å–ª–∏ –∑–∞–≤–∞—Ä–∏—Ç—å –∫—Ä–µ–ø–∫–æ.", en:"A fully fermented pu-erh often felt as a steady base with calm composure. Can energize if brewed strong."}, gives:["good5","good9","good13","good16"], when:["bad1","bad2","bad9","bad10","bad12"] },
    chaTou:{ desc:{ru:"–ü—É—ç—Ä–Ω—ã–µ ¬´–∫–∞–º—É—à–∫–∏¬ª: –æ–±—ã—á–Ω–æ –º—è–≥—á–µ –ø–æ –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, –¥–æ–ª–≥–æ –¥–µ—Ä–∂–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –•–æ—Ä–æ—à –¥–ª—è —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –≤–µ—á–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–µ –∫—Ä–µ–ø–∏—Ç—å).", en:"Pu-erh nuggets: often gentler and long-lasting. Great for evening (keep it light)."}, gives:["good3","good9","good15","good19","good20"], when:["bad4","bad12","bad13","bad20"] },
    liuBao:{ desc:{ru:"–•—ç–π —á–∞ –∏–∑ –ì—É–∞–Ω—Å–∏: —Ç—ë–ø–ª—ã–π, —É—Å—Ç–æ–π—á–∏–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –ø–æ—Å–ª–µ –µ–¥—ã –∏ –¥–ª—è ¬´—Å–æ–±—Ä–∞—Ç—å –≥–æ–ª–æ–≤—É –±–µ–∑ —Ä—ã–≤–∫–∞¬ª.", en:"Hei cha from Guangxi: warm and steady. Often after food and for stable focus."}, gives:["good5","good7","good9","good16"], when:["bad1","bad2","bad9","bad17","bad10"] },
    fuZhuan:{ desc:{ru:"–ö–∏—Ä–ø–∏—á–Ω—ã–π —Ö—ç–π —á–∞: —Ä–æ–≤–Ω–æ–µ –º—è–≥–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–Ω –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.", en:"Brick hei cha: smooth steady background when you want long even stability."}, gives:["good5","good7","good16","good18"], when:["bad9","bad17","bad2","bad1"] },
    agedWhite:{ desc:{ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π: –º—è–≥–∫–æ —Å–Ω–∏–∂–∞–µ—Ç —Å—É–µ—Ç—É –∏ –¥–∞—ë—Ç —Ç—ë–ø–ª—É—é —Ç–∏—à–∏–Ω—É –±–µ–∑ —Ç—è–∂–µ—Å—Ç–∏.", en:"Aged white: often lowers mental noise and gives warm inner quiet."}, gives:["good3","good12","good15","good19","good20"], when:["bad3","bad4","bad11","bad12","bad20"] },
    white:{ desc:{ru:"–°–≤–µ–∂–∏–π –±–µ–ª—ã–π: –¥–µ–ª–∏–∫–∞—Ç–Ω–∞—è —è—Å–Ω–æ—Å—Ç—å –∏ –º—è–≥–∫–∏–π –ø–æ–¥—ä—ë–º –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.", en:"Fresh white: delicate clarity with gentle lift."}, gives:["good10","good2","good7","good4"], when:["bad11","bad18","bad19"] },
    hongCha:{ desc:{ru:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π: ¬´—Ç—ë–ø–ª–∞—è –±–æ–¥—Ä–æ—Å—Ç—å¬ª –∏ —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ —Ä–µ–∑–∫–æ–≥–æ —Å–∫–∞—á–∫–∞.", en:"Black/red tea: warm energy and composed focus without a harsh spike."}, gives:["good4","good11","good13","good1"], when:["bad7","bad14","bad15","bad16","bad10"] },
    green:{ desc:{ru:"–ó–µ–ª—ë–Ω—ã–π: —è—Ä–∫–∞—è —è—Å–Ω–æ—Å—Ç—å. –•–æ—Ä–æ—à —É—Ç—Ä–æ–º –∏ –¥–æ –æ–±–µ–¥–∞, –Ω–æ –ø—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∞–∫—Ç–∏–≤–Ω—ã–º.", en:"Green tea: bright clarity. Great early; may be too activating if anxious."}, gives:["good2","good12","good8","good4"], when:["bad5","bad6","bad7","bad15"] },
    lightOolong:{ desc:{ru:"–°–≤–µ—Ç–ª—ã–π —É–ª—É–Ω: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ + –ª—ë–≥–∫–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å. –ö–æ–º—Ñ–æ—Ä—Ç–µ–Ω –¥–ª—è –¥–Ω–µ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.", en:"Light oolong: mood lift and light composure‚Äîcomfortable for daytime."}, gives:["good6","good7","good13","good4"], when:["bad6","bad18","bad8","bad15"] },
    darkOolong:{ desc:{ru:"–¢—ë–º–Ω—ã–π —É–ª—É–Ω: –≥–ª—É–±–∏–Ω–∞ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è. –î–Ω—ë–º ‚Äî –æ—Ç–ª–∏—á–Ω–æ, –≤–µ—á–µ—Ä–æ–º ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å –∫—Ä–µ–ø–æ—Å—Ç—å—é.", en:"Dark oolong: depth and concentration. Great daytime; go easy at night."}, gives:["good1","good8","good14","good11"], when:["bad8","bad14","bad15","bad2"] },
    sheng:{ desc:{ru:"–®—ç–Ω –ø—É—ç—Ä: —á–∏—Å—Ç–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å. –õ—É—á—à–µ –¥–æ 14:00 –∏ —Å —É–º–µ—Ä–µ–Ω–Ω–æ–π –¥–æ–∑–∏—Ä–æ–≤–∫–æ–π.", en:"Sheng pu-erh: clean energy and focus. Best before 2pm and moderate dose."}, gives:["good2","good1","good4","good14"], when:["bad5","bad6","bad7","bad16"] },
    yancha:{ desc:{ru:"–Ø–Ω—å—á–∞: —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –∏ –≥–ª—É–±–æ–∫–∞—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ ¬´–≤–∫–ª—é—á–∏—Ç—å –º–æ–∑–≥¬ª –∏ –¥–µ—Ä–∂–∞—Ç—å –ª–∏–Ω–∏—é.", en:"Yancha: composed deep focus‚Äîwhen you need sustained attentiveness."}, gives:["good1","good8","good13","good14"], when:["bad8","bad14","bad2","bad16"] }
  };

  // =========================
  // States (20 + 20)
  // =========================
  const STATE_TEXT = {
    bad1:{ru:"–§–∏–∑–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å",en:"Physical fatigue"},
    bad2:{ru:"–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å",en:"Mental overload"},
    bad3:{ru:"–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",en:"Irritability"},
    bad4:{ru:"–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å",en:"Anxiety"},
    bad5:{ru:"–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å —É—Ç—Ä–æ–º",en:"Morning sleepiness"},
    bad6:{ru:"–¢—É–º–∞–Ω –≤ –≥–æ–ª–æ–≤–µ",en:"Brain fog"},
    bad7:{ru:"–í—è–ª–æ—Å—Ç—å –∏ –∏–Ω–µ—Ä—Ç–Ω–æ—Å—Ç—å",en:"Sluggishness"},
    bad8:{ru:"–†–∞—Å—Ñ–æ–∫—É—Å",en:"Lack of focus"},
    bad9:{ru:"–ü–µ—Ä–µ–µ–¥–∞–Ω–∏–µ / —Ç—è–∂–µ—Å—Ç—å",en:"Overeating / heaviness"},
    bad10:{ru:"–•–æ–ª–æ–¥ –≤ —Ç–µ–ª–µ",en:"Feeling cold"},
    bad11:{ru:"–ü–µ—Ä–µ–≥—Ä–µ–≤ / ‚Äú–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∂–∞—Ä‚Äù",en:"Overheated / ‚Äúinner heat‚Äù"},
    bad12:{ru:"–°—É–µ—Ç–∞ –≤ –≥–æ–ª–æ–≤–µ",en:"Mind racing"},
    bad13:{ru:"–ù–µ—Ä–≤–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",en:"Nervous tension"},
    bad14:{ru:"–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è",en:"Procrastination"},
    bad15:{ru:"–ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω—ã–π —Å–ø–∞–¥",en:"Afternoon slump"},
    bad16:{ru:"–ù–∏–∑–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è",en:"Low motivation"},
    bad17:{ru:"–†–∞–∑–¥—É—Ç—ã–π –∂–∏–≤–æ—Ç",en:"Bloating"},
    bad18:{ru:"–ü–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",en:"Low mood"},
    bad19:{ru:"–£—Å—Ç–∞–ª–æ—Å—Ç—å –≥–ª–∞–∑/—ç–∫—Ä–∞–Ω—ã",en:"Eye strain (screens)"},
    bad20:{ru:"–ë–µ—Å—Å–æ–Ω–Ω–∞—è –≥–æ–ª–æ–≤–∞ –≤–µ—á–µ—Ä–æ–º",en:"Restless head at night"},

    good1:{ru:"–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω–æ—Å—Ç—å",en:"Concentration"},
    good2:{ru:"–Ø—Å–Ω–æ—Å—Ç—å",en:"Clarity"},
    good3:{ru:"–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ",en:"Calm"},
    good4:{ru:"–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å",en:"Gentle energy"},
    good5:{ru:"–¢—ë–ø–ª–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",en:"Warm steadiness"},
    good6:{ru:"–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫",en:"Creative flow"},
    good7:{ru:"–†–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",en:"Even mood"},
    good8:{ru:"–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",en:"Attentiveness"},
    good9:{ru:"–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ",en:"Grounding"},
    good10:{ru:"–õ—ë–≥–∫–æ—Å—Ç—å",en:"Lightness"},
    good11:{ru:"–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è",en:"Warm energy"},
    good12:{ru:"–ß–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞",en:"Clear head"},
    good13:{ru:"–°–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞",en:"Composed (no stress)"},
    good14:{ru:"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",en:"Confidence"},
    good15:{ru:"–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å",en:"Meditative mood"},
    good16:{ru:"–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å (—Å–ø–æ–∫–æ–π–Ω–∞—è)",en:"Steady endurance"},
    good17:{ru:"–ö–æ–º–º—É–Ω–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å",en:"Sociability"},
    good18:{ru:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",en:"Recovery"},
    good19:{ru:"–¢–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏",en:"Inner quiet"},
    good20:{ru:"–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–æ —Å–Ω—É",en:"Ready for sleep"},
  };
  function TState(id, lang){ return (STATE_TEXT[id] && STATE_TEXT[id][lang]) ? STATE_TEXT[id][lang] : id; }

  // =========================
  // Recommendations mapping
  // =========================
  const badStates = [
    {id:"bad1",  teas:[TEA.shu, TEA.liuBao, TEA.hongCha, TEA.agedWhite]},
    {id:"bad2",  teas:[TEA.shu, TEA.agedWhite, TEA.liuBao, TEA.darkOolong]},
    {id:"bad3",  teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"bad4",  teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"bad5",  teas:[TEA.green, TEA.sheng, TEA.lightOolong, TEA.hongCha]},
    {id:"bad6",  teas:[TEA.green, TEA.lightOolong, TEA.sheng, TEA.hongCha]},
    {id:"bad7",  teas:[TEA.hongCha, TEA.green, TEA.darkOolong, TEA.sheng]},
    {id:"bad8",  teas:[TEA.darkOolong, TEA.hongCha, TEA.shu, TEA.yancha]},
    {id:"bad9",  teas:[TEA.liuBao, TEA.fuZhuan, TEA.shu, TEA.darkOolong]},
    {id:"bad10", teas:[TEA.hongCha, TEA.shu, TEA.darkOolong, TEA.liuBao]},
    {id:"bad11", teas:[TEA.white, TEA.agedWhite, TEA.green, TEA.lightOolong]},
    {id:"bad12", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"bad13", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"bad14", teas:[TEA.hongCha, TEA.darkOolong, TEA.green, TEA.sheng]},
    {id:"bad15", teas:[TEA.darkOolong, TEA.hongCha, TEA.shu, TEA.liuBao]},
    {id:"bad16", teas:[TEA.hongCha, TEA.yancha, TEA.sheng, TEA.lightOolong]},
    {id:"bad17", teas:[TEA.liuBao, TEA.fuZhuan, TEA.shu, TEA.darkOolong]},
    {id:"bad18", teas:[TEA.lightOolong, TEA.hongCha, TEA.green, TEA.white]},
    {id:"bad19", teas:[TEA.agedWhite, TEA.white, TEA.liuBao, TEA.shu]},
    {id:"bad20", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
  ];
  const goodStates = [
    {id:"good1",  teas:[TEA.yancha, TEA.darkOolong, TEA.hongCha, TEA.shu]},
    {id:"good2",  teas:[TEA.green, TEA.sheng, TEA.lightOolong, TEA.white]},
    {id:"good3",  teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"good4",  teas:[TEA.hongCha, TEA.lightOolong, TEA.green, TEA.sheng]},
    {id:"good5",  teas:[TEA.shu, TEA.liuBao, TEA.fuZhuan, TEA.hongCha]},
    {id:"good6",  teas:[TEA.lightOolong, TEA.sheng, TEA.green, TEA.hongCha]},
    {id:"good7",  teas:[TEA.agedWhite, TEA.hongCha, TEA.liuBao, TEA.lightOolong]},
    {id:"good8",  teas:[TEA.darkOolong, TEA.yancha, TEA.hongCha, TEA.shu]},
    {id:"good9",  teas:[TEA.chaTou, TEA.shu, TEA.liuBao, TEA.fuZhuan]},
    {id:"good10", teas:[TEA.white, TEA.green, TEA.lightOolong, TEA.agedWhite]},
    {id:"good11", teas:[TEA.hongCha, TEA.darkOolong, TEA.shu, TEA.liuBao]},
    {id:"good12", teas:[TEA.green, TEA.sheng, TEA.white, TEA.lightOolong]},
    {id:"good13", teas:[TEA.hongCha, TEA.darkOolong, TEA.shu, TEA.agedWhite]},
    {id:"good14", teas:[TEA.yancha, TEA.darkOolong, TEA.hongCha, TEA.sheng]},
    {id:"good15", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.white]},
    {id:"good16", teas:[TEA.shu, TEA.liuBao, TEA.fuZhuan, TEA.hongCha]},
    {id:"good17", teas:[TEA.lightOolong, TEA.hongCha, TEA.green, TEA.white]},
    {id:"good18", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"good19", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"good20", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
  ];
  const badById  = Object.fromEntries(badStates.map(s=>[s.id, s]));
  const goodById = Object.fromEntries(goodStates.map(s=>[s.id, s]));

  // =========================
  // ‚ÄúAI‚Äù keyword matcher (local)
  // =========================
  const KEYWORDS = {
    bad: {
      bad1:  ["—É—Å—Ç–∞–ª", "—É—Å—Ç–∞–ª–æ—Å—Ç—å", "–≤—ã–º–æ—Ç", "—Ä–∞–∑–±–∏—Ç", "fatigue", "tired", "exhaust"],
      bad2:  ["–ø–µ—Ä–µ–≥—Ä—É–∑", "–ø–µ—Ä–µ–≥—Ä—É–∂", "—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ", "–º–Ω–æ–≥–æ –∑–∞–¥–∞—á", "overload", "overwhelmed"],
      bad3:  ["—Ä–∞–∑–¥—Ä–∞–∂", "–∑–ª—é—Å—å", "–±–µ—Å–∏—Ç", "irritab", "annoy", "angry"],
      bad4:  ["—Ç—Ä–µ–≤–æ–≥", "—Ç—Ä–µ–≤–æ–∂–Ω–æ", "–ø–∞–Ω–∏–∫", "anxiety", "anxious", "panic"],
      bad5:  ["—Å–æ–Ω–ª–∏–≤", "–∫–ª–æ–Ω–∏—Ç", "–Ω–µ –ø—Ä–æ—Å–Ω—É–ª", "sleepy", "drowsy", "morning"],
      bad6:  ["—Ç—É–º–∞–Ω", "–≤–∞—Ç–Ω–∞—è", "–Ω–µ —Å–æ–æ–±—Ä–∞–∂", "brain fog", "foggy", "cloudy head"],
      bad7:  ["–≤—è–ª", "–∏–Ω–µ—Ä—Ç", "–ª–µ–Ω", "sluggish", "lazy", "no energy"],
      bad8:  ["—Ä–∞—Å—Ñ–æ–∫—É—Å", "–Ω–µ –º–æ–≥—É —Å–æ—Å—Ä–µ–¥", "—Ä–∞–∑–±—Ä–æ—Å", "distract", "no focus"],
      bad9:  ["—Ç—è–∂–µ—Å—Ç—å", "–ø–µ—Ä–µ–µ–ª", "–ø–ª–æ—Ç–Ω–æ –ø–æ–µ–ª", "overeat", "heavy stomach"],
      bad10: ["—Ö–æ–ª–æ–¥–Ω–æ", "–∑—è–±–∫–æ", "–º–µ—Ä–∑–Ω—É", "cold", "chilly"],
      bad11: ["–∂–∞—Ä", "–ø–µ—Ä–µ–≥—Ä–µ–≤", "–≥–æ—Ä—è—á–æ", "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∂–∞—Ä", "hot", "overheated"],
      bad12: ["—Å—É–µ—Ç–∞", "–º—ã—Å–ª–∏ —Å–∫–∞—á—É—Ç", "–≥–æ–Ω—è–µ—Ç –º—ã—Å–ª–∏", "mind racing", "racing thoughts"],
      bad13: ["–Ω–∞–ø—Ä—è–∂", "–Ω–µ—Ä–≤—ã", "—Å—Ç—Ä–µ—Å—Å", "tension", "nervous", "stressed"],
      bad14: ["–ø—Ä–æ–∫—Ä–∞—Å—Ç", "–æ—Ç–∫–ª–∞–¥—ã", "–Ω–µ –º–æ–≥—É –Ω–∞—á–∞—Ç—å", "procrast", "delay"],
      bad15: ["–ø–æ—Å–ª–µ –æ–±–µ–¥–∞", "–ø–æ—Å–ª–µ–æ–±–µ–¥", "—Å–ø–∞–¥", "afternoon slump", "after lunch"],
      bad16: ["–Ω–µ—Ç –º–æ—Ç–∏–≤–∞", "–∞–ø–∞—Ç–∏—è", "–Ω–µ —Ö–æ—á—É", "low motivation", "no motivation"],
      bad17: ["–≤–∑–¥—É—Ç", "–∂–∏–≤–æ—Ç", "–≥–∞–∑", "bloat", "bloating"],
      bad18: ["–ø–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–≥—Ä—É—Å—Ç—å", "—É–Ω—ã–Ω–∏–µ", "low mood", "sad"],
      bad19: ["–≥–ª–∞–∑–∞", "—ç–∫—Ä–∞–Ω—ã", "–º–æ–Ω–∏—Ç–æ—Ä", "eye strain", "screen"],
      bad20: ["–Ω–µ —É—Å–Ω—É—Ç—å", "–±–µ—Å—Å–æ–Ω", "–≥–æ–ª–æ–≤–∞ –Ω–µ –≤—ã–∫–ª—é—á", "insomnia", "cant sleep", "restless night"],
    },
    good: {
      good1:  ["—Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á", "—Ñ–æ–∫—É—Å", "concentration", "focus"],
      good2:  ["—è—Å–Ω–æ—Å—Ç—å", "—á–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞", "clarity", "clear"],
      good3:  ["—Å–ø–æ–∫–æ–π", "calm", "relax"],
      good4:  ["–±–æ–¥—Ä", "—ç–Ω–µ—Ä–≥", "gentle energy", "energized"],
      good5:  ["—É—Å—Ç–æ–π—á–∏–≤", "—Ä–æ–≤–Ω–æ", "steady", "grounded warm"],
      good6:  ["—Ç–≤–æ—Ä", "–∫—Ä–µ–∞—Ç–∏–≤", "flow", "creative"],
      good7:  ["—Ä–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–æ–≤–Ω–æ", "even mood", "balanced mood"],
      good8:  ["–≤–Ω–∏–º–∞—Ç–µ–ª—å", "–æ—Å–æ–∑–Ω–∞–Ω", "attentive", "mindful"],
      good9:  ["–∑–∞–∑–µ–º–ª", "ground", "grounding"],
      good10: ["–ª—ë–≥–∫–æ—Å—Ç—å", "–ª–µ–≥–∫–æ", "lightness", "light"],
      good11: ["—Ç—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è", "—Ç–µ–ø–ª–æ", "warm energy", "warmth"],
      good12: ["clear head", "—Å–æ–±—Ä–∞–Ω", "–±–µ–∑ —Ç—É–º–∞–Ω–∞"],
      good13: ["–±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞", "—Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–∫—É—Å", "composed", "no stress"],
      good14: ["—É–≤–µ—Ä–µ–Ω", "confidence", "confident"],
      good15: ["–º–µ–¥–∏—Ç–∞—Ç–∏–≤", "—Ç–∏—à–∏–Ω–∞", "meditative", "zen"],
      good16: ["–≤—ã–Ω–æ—Å–ª–∏–≤", "–¥–æ–ª–≥–æ", "endurance", "stamina"],
      good17: ["–æ–±—â–∏—Ç–µ–ª", "–∫–æ–º–º—É–Ω–∏–∫–∞", "sociable", "social"],
      good18: ["–≤–æ—Å—Å—Ç–∞–Ω–æ–≤", "recovery", "recover"],
      good19: ["–≤–Ω—É—Ç—Ä–∏ —Ç–∏—Ö–æ", "—Ç–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏", "inner quiet", "quiet inside"],
      good20: ["–∫–æ —Å–Ω—É", "–∑–∞—Å–Ω—É—Ç—å", "ready for sleep", "sleep ready"],
    }
  };

  function scoreText(text, words){
    const t = text.toLowerCase();
    let s = 0;
    const hits = [];
    for(const w of words){
      if(t.includes(w.toLowerCase())){
        s += 1;
        hits.push(w);
      }
    }
    return {score:s, hits};
  }

  function analyzeFreeText(text){
    const t = (text || "").trim();
    const result = { bad: [], good: [] };
    if(!t) return result;

    const badScored = [];
    for(const id in KEYWORDS.bad){
      const r = scoreText(t, KEYWORDS.bad[id]);
      if(r.score > 0) badScored.push({id, score:r.score, hits:r.hits});
    }
    badScored.sort((a,b)=> b.score - a.score);

    const goodScored = [];
    for(const id in KEYWORDS.good){
      const r = scoreText(t, KEYWORDS.good[id]);
      if(r.score > 0) goodScored.push({id, score:r.score, hits:r.hits});
    }
    goodScored.sort((a,b)=> b.score - a.score);

    result.bad = badScored.slice(0,5);
    result.good = goodScored.slice(0,5);
    return result;
  }

  // =========================
  // Reasons for pills (request #4)
  // =========================
  const TEA_REASON_BASE = {
    shu:        {ru:"–ü–ª–æ—Ç–Ω—ã–π —Ç—ë–ø–ª—ã–π –ø—Ä–æ—Ñ–∏–ª—å + —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±—ã—á–Ω–æ –¥–∞—é—Ç —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω.", en:"Dense warm profile + fermentation often feels steady."},
    chaTou:     {ru:"–ú—è–≥–∫–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –∏ ¬´–¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–æ–ª–∏–≤—ã¬ª –¥–∞—é—Ç —Å–ø–æ–∫–æ–π–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.", en:"Gentle extraction and long infusions feel steady."},
    liuBao:     {ru:"–¢—ë–ø–ª—ã–π —Ö—ç–π —á–∞: —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—â–∏–π –∏ ¬´—Å–æ–±–∏—Ä–∞—é—â–∏–π¬ª.", en:"Warm hei cha often feels stabilizing and collecting."},
    fuZhuan:    {ru:"–†–æ–≤–Ω—ã–π –∫–∏—Ä–ø–∏—á–Ω—ã–π —Ö—ç–π —á–∞: —Ö–æ—Ä–æ—à –∫–∞–∫ —Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–Ω –±–µ–∑ –ø–∏–∫–æ–≤.", en:"Even brick hei cha: calm baseline without spikes."},
    agedWhite:  {ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π –æ–±—ã—á–Ω–æ –º—è–≥—á–µ –∏ ¬´—Ç–∏—à–µ¬ª –ø–æ –æ—â—É—â–µ–Ω–∏—è–º.", en:"Aged white is often softer and quieter."},
    white:      {ru:"–î–µ–ª–∏–∫–∞—Ç–Ω—ã–π –±–µ–ª—ã–π: –ª—ë–≥–∫–∞—è —è—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–π –∫—Ä–µ–ø–æ—Å—Ç–∏.", en:"Delicate white: gentle clarity when moderate."},
    hongCha:    {ru:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π: —Ç—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ —Ä–µ–∑–∫–æ–≥–æ —Ä—ã–≤–∫–∞ (–µ—Å–ª–∏ –Ω–µ –∫—Ä–µ–ø–∏—Ç—å).", en:"Red/black tea: warm energy without a harsh spike if moderate."},
    green:      {ru:"–ó–µ–ª—ë–Ω—ã–π: –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —è—Å–Ω–æ—Å—Ç–∏, –Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –¥–æ–∑–∏—Ä–æ–≤–∫–µ.", en:"Green: quick clarity but dose-sensitive."},
    lightOolong:{ru:"–°–≤–µ—Ç–ª—ã–π —É–ª—É–Ω: –∞—Ä–æ–º–∞—Ç –∏ ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å¬ª —á–∞—Å—Ç–æ —É–ª—É—á—à–∞—é—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.", en:"Light oolong: aroma and composure often lift mood."},
    darkOolong: {ru:"–¢—ë–º–Ω—ã–π —É–ª—É–Ω: –≥–ª—É–±–∏–Ω–∞ –∏ —Ñ–æ–∫—É—Å; –∫—Ä–µ–ø–æ—Å—Ç—å –≤–∞–∂–Ω–∞.", en:"Dark oolong: depth and focus; strength matters."},
    sheng:      {ru:"–®—ç–Ω: —á–∏—Å—Ç–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ñ–æ–∫—É—Å; –ª—É—á—à–µ —É–º–µ—Ä–µ–Ω–Ω–æ.", en:"Sheng: clean activation and focus; keep moderate."},
    yancha:     {ru:"–Ø–Ω—å—á–∞: ¬´—Å–æ–±—Ä–∞–Ω–Ω–∞—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å¬ª –∏ –≥–ª—É–±–∏–Ω–∞ –≤–∫—É—Å–∞.", en:"Yancha: collected attentiveness and depth."}
  };

  const STATE_HINT = {
    bad4:{ru:"–ü—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ –æ–±—ã—á–Ω–æ –≤—ã–±–∏—Ä–∞—é—Ç –±–æ–ª–µ–µ —Ä–æ–≤–Ω—ã–µ –∏ —Ç—ë–ø–ª—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏, –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –ø–∏–∫–æ–≤.", en:"For anxiety, steadier warm profiles are usually preferred."},
    bad12:{ru:"–ü—Ä–∏ ¬´—Å—É–µ—Ç–µ –≤ –≥–æ–ª–æ–≤–µ¬ª –ø–æ–º–æ–≥–∞–µ—Ç —Ä–æ–≤–Ω—ã–π —Ç–µ–º–ø –∏ –º—è–≥–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å.", en:"For racing thoughts, a steady baseline and moderate strength helps."},
    bad6:{ru:"–ü—Ä–∏ ¬´—Ç—É–º–∞–Ω–µ¬ª —á–∞—â–µ –Ω—É–∂–Ω—ã –±–æ–ª–µ–µ ¬´–ø—Ä–æ—è—Å–Ω—è—é—â–∏–µ¬ª —á–∞–∏ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã.", en:"For brain fog, more clarifying teas and short steeps are common."},
    bad15:{ru:"–ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω—ã–π —Å–ø–∞–¥ —á–∞—Å—Ç–æ –ª—É—á—à–µ –ø–æ–¥–Ω–∏–º–∞—Ç—å —Ç—ë–ø–ª—ã–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞.", en:"Afternoon slump is often lifted by warm activation without overload."},
    good1:{ru:"–î–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –≤–∞–∂–Ω–∞ ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å¬ª –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —à—É–º–∞.", en:"For concentration, composed focus without noise matters."},
    good3:{ru:"–î–ª—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è ‚Äî —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤.", en:"For calm‚Äîan even baseline without spikes."},
    good20:{ru:"–î–ª—è —Å–Ω–∞ ‚Äî –º—è–≥–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å, —Ç—ë–ø–ª—ã–π –∏ ¬´—Ç–∏—Ö–∏–π¬ª –ø—Ä–æ—Ñ–∏–ª—å.", en:"For sleep‚Äîlight strength and a quiet warm profile."},
  };

  function reasonFor(teaKey, stateId){
    const base = TEA_REASON_BASE[teaKey]?.[lang] || TEA_REASON_BASE[teaKey]?.en || "";
    const hint = STATE_HINT[stateId]?.[lang] || STATE_HINT[stateId]?.en || "";
    const stateName = TState(stateId, lang);
    const teaName = TEA[teaKey]?.name?.[lang] || TEA[teaKey]?.name?.en || teaKey;
    const core = hint ? `${base} ${hint}` : base;
    return `<b>${teaName}</b> ‚Üí <b>${stateName}</b><br/>${escapeHtml(core)}`;
  }

  // =========================
  // Ozon link helper
  // =========================
  function ozonSearchUrl(q){
    return `https://www.ozon.ru/search/?text=${encodeURIComponent(q)}`;
  }

  // =========================
  // DOM
  // =========================
  const badCloud  = document.getElementById("badCloud");
  const goodCloud = document.getElementById("goodCloud");
  const badCloudMobile  = document.getElementById("badCloudMobile");
  const goodCloudMobile = document.getElementById("goodCloudMobile");

  const rightCard = document.getElementById("rightCard");

  const cardTitle = document.getElementById("cardTitle");
  const cardChip  = document.getElementById("cardChip");
  const cardDesc  = document.getElementById("cardDesc");
  const teaList   = document.getElementById("teaList");

  const reasoningBox = document.getElementById("reasoningBox");
  const reasoningText = document.getElementById("reasoningText");
  const hideWhyBtn = document.getElementById("hideWhyBtn");

  const multiBlocks       = document.getElementById("multiBlocks");
  const selectedBadChips  = document.getElementById("selectedBadChips");
  const selectedGoodChips = document.getElementById("selectedGoodChips");

  const multiToggle = document.getElementById("multiToggle");
  const counterText = document.getElementById("counterText");

  const clearBadBtn  = document.getElementById("clearBadBtn");
  const clearGoodBtn = document.getElementById("clearGoodBtn");
  const clearAllBtn  = document.getElementById("clearAllBtn");

  const limitModal     = document.getElementById("limitModal");
  const closeLimitBtn  = document.getElementById("closeLimitBtn");

  const proModal = document.getElementById("proModal");
  const proModalNo = document.getElementById("proModalNo");
  const proModalYes = document.getElementById("proModalYes");
  const proModalCloseX = document.getElementById("proModalCloseX");
  const proModalActions = document.getElementById("proModalActions");
  const proModalBody = document.getElementById("uiProModalBody");

  const aboutLink = document.getElementById("aboutLink");
  const aboutLinkMobile = document.getElementById("aboutLinkMobile");
  const aboutModal = document.getElementById("aboutModal");
  const aboutCloseBtn = document.getElementById("aboutCloseBtn");

  const langSelect = document.getElementById("langSelect");
  const themeBtn   = document.getElementById("themeBtn");

  const nlpInput = document.getElementById("nlpInput");
  const nlpBtn   = document.getElementById("nlpBtn");
  const nlpInputMobile = document.getElementById("nlpInputMobile");
  const nlpBtnMobile   = document.getElementById("nlpBtnMobile");

  // mobile wizard
  const stepDot0 = document.getElementById("stepDot0");
  const stepDot1 = document.getElementById("stepDot1");
  const stepDot2 = document.getElementById("stepDot2");
  const stepDot3 = document.getElementById("stepDot3");
  const prevStepBtn = document.getElementById("prevStepBtn");
  const nextStepBtn = document.getElementById("nextStepBtn");

  const mobileStep0 = document.getElementById("mobileStep0");
  const mobileStep1 = document.getElementById("mobileStep1");
  const mobileStep2 = document.getElementById("mobileStep2");
  const mobileStep3 = document.getElementById("mobileStep3");

  const multiToggleMobile = document.getElementById("multiToggleMobile");
  const counterTextMobile = document.getElementById("counterTextMobile");

  const selectedBadChipsMobile = document.getElementById("selectedBadChipsMobile");
  const selectedGoodChipsMobile = document.getElementById("selectedGoodChipsMobile");
  const teaListMobile = document.getElementById("teaListMobile");

  const clearBadBtnMobile  = document.getElementById("clearBadBtnMobile");
  const clearGoodBtnMobile = document.getElementById("clearGoodBtnMobile");
  const clearAllBtnMobile  = document.getElementById("clearAllBtnMobile");

  const reasoningBoxMobile = document.getElementById("reasoningBoxMobile");
  const reasoningTextMobile = document.getElementById("reasoningTextMobile");
  const hideWhyBtnMobile = document.getElementById("hideWhyBtnMobile");

  // tea modal
  const teaModal = document.getElementById("teaModal");
  const teaModalCloseBtn = document.getElementById("teaModalCloseBtn");
  const teaModalTitle = document.getElementById("teaModalTitle");
  const teaModalImg = document.getElementById("teaModalImg");
  const teaModalDesc = document.getElementById("teaModalDesc");
  const teaModalClass = document.getElementById("teaModalClass");
  const teaModalOriginTitle = document.getElementById("teaModalOriginTitle");
  const teaModalOrigin = document.getElementById("teaModalOrigin");
  const teaModalFactsTitle = document.getElementById("teaModalFactsTitle");
  const teaModalFacts = document.getElementById("teaModalFacts");
  const teaModalGivesTitle = document.getElementById("teaModalGivesTitle");
  const teaModalWhenTitle = document.getElementById("teaModalWhenTitle");
  const teaModalBrewTitle = document.getElementById("teaModalBrewTitle");
  const teaModalGives = document.getElementById("teaModalGives");
  const teaModalWhen = document.getElementById("teaModalWhen");
  const teaModalBrew = document.getElementById("teaModalBrew");

  // tooltip
  const tooltip = document.getElementById("tooltip");

  // =========================
  // App state
  // =========================
  let lang = "ru";
  let multiMode = false;
  const selectedBad  = new Set();
  const selectedGood = new Set();
  let lastReasoning = "";
  let pendingEnablePro = false;

  // =========================
  // Modals
  // =========================
  function openModal(el){ el.style.display = "flex"; }
  function closeModal(el){ el.style.display = "none"; }

  closeLimitBtn.addEventListener("click", ()=>closeModal(limitModal));
  limitModal.addEventListener("click", (e)=>{ if(e.target === limitModal) closeModal(limitModal); });

  proModalCloseX.addEventListener("click", ()=>{ pendingEnablePro=false; closeModal(proModal); resetProModalView(); });
  proModal.addEventListener("click", (e)=>{ if(e.target === proModal) { pendingEnablePro=false; closeModal(proModal); resetProModalView(); } });

  teaModalCloseBtn.addEventListener("click", ()=>closeModal(teaModal));
  teaModal.addEventListener("click", (e)=>{ if(e.target === teaModal) closeModal(teaModal); });

  aboutLink.addEventListener("click", ()=> openModal(aboutModal));
  aboutLinkMobile.addEventListener("click", ()=> openModal(aboutModal));
  aboutCloseBtn.addEventListener("click", ()=> closeModal(aboutModal));
  aboutModal.addEventListener("click", (e)=>{ if(e.target === aboutModal) closeModal(aboutModal); });

  // =========================
  // Helpers
  // =========================
  function teaName(tea){ return tea.name[lang] || tea.name.en || tea.name.ru; }
  function teaTag(tea){ return tea.tag[lang] || tea.tag.en || tea.tag.ru; }
  function teaBrew(tea){ return tea.brew[lang] || tea.brew.en || tea.brew.ru; }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function updateCounter(){
    const txt = UI[lang].counter(selectedBad.size, selectedGood.size);
    counterText.textContent = txt;
    counterTextMobile.textContent = txt;
  }

  function resetSingleView(){
    document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
    cardTitle.textContent = UI[lang].cardIdleTitle;
    cardDesc.textContent = UI[lang].cardDesc;
    teaList.innerHTML = "";
    hideReasoning();
  }

  function showReasoning(html){
    if(!html || !html.trim()){
      hideReasoning();
      hideReasoningMobile();
      return;
    }
    lastReasoning = html;

    reasoningText.innerHTML = html;
    reasoningBox.style.display = "block";
    hideWhyBtn.textContent = UI[lang].hide;
    document.getElementById("uiWhy").textContent = UI[lang].why;

    reasoningTextMobile.innerHTML = html;
    reasoningBoxMobile.style.display = "block";
    hideWhyBtnMobile.textContent = UI[lang].hide;
  }
  function hideReasoning(){ reasoningBox.style.display = "none"; }
  function hideReasoningMobile(){ reasoningBoxMobile.style.display = "none"; }
  hideWhyBtn.addEventListener("click", ()=> hideReasoning());
  hideWhyBtnMobile.addEventListener("click", ()=> hideReasoningMobile());

  function renderStatePills(target, ids, kind, teaKey){
    target.innerHTML = "";
    if(!ids || !ids.length){
      const s = document.createElement("span");
      s.className = "muted";
      s.textContent = "‚Äî";
      target.appendChild(s);
      return;
    }
    ids.forEach(id=>{
      const p = document.createElement("span");
      p.className = `pillState ${kind}`;
      p.textContent = TState(id, lang);
      // request #4: tea-specific tooltip on hover
      if(teaKey){
        p.dataset.tip = reasonFor(teaKey, id);
      }
      target.appendChild(p);
    });
  }

  function renderClassTable(teaKey){
    const cls = TEA_CLASS[teaKey]?.[lang] || TEA_CLASS[teaKey]?.en;
    if(!cls){
      teaModalClass.innerHTML = "";
      return;
    }
    const rows = [
      ["–°—Ç–µ–ø–µ–Ω—å —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏–∏", cls.fermentation],
      ["–¢–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏", cls.processing],
      ["–°—ã—Ä—å—ë –∏ —Å–±–æ—Ä", cls.material],
      ["–†–µ–≥–∏–æ–Ω", cls.region],
      ["–í–∫—É—Å-–∞—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å", cls.profile],
      ["–¢–µ–∫—Å—Ç—É—Ä–∞ –Ω–∞—Å—Ç–æ—è", cls.texture],
      ["–≠—Ñ—Ñ–µ–∫—Ç", cls.effect],
      ["–°—Ç–µ–ø–µ–Ω—å –≤—ã–¥–µ—Ä–∂–∫–∏", cls.aging],
      ["–§–æ—Ä–º–∞ –∏ —Ñ–æ—Ä–º–∞—Ç", cls.format],
      ["–•—Ä–∞–Ω–µ–Ω–∏–µ", cls.storage],
    ];
    const rowsEn = [
      ["Fermentation level", cls.fermentation],
      ["Processing type", cls.processing],
      ["Material & harvest", cls.material],
      ["Region", cls.region],
      ["Flavor/aroma profile", cls.profile],
      ["Liquor texture", cls.texture],
      ["Effect", cls.effect],
      ["Aging", cls.aging],
      ["Form & format", cls.format],
      ["Storage", cls.storage],
    ];
    const useRows = (lang === "ru") ? rows : rowsEn;
    teaModalClass.innerHTML = useRows.map(([k,v])=>`
      <tr>
        <td class="classK">${escapeHtml(k)}</td>
        <td>${escapeHtml(v || "‚Äî")}</td>
      </tr>
    `).join("");
  }

  function openTeaDetails(teaKey){
    const tea = TEA[teaKey];
    const det = TEA_DETAILS[teaKey];
    const meta = TEA_META[teaKey];
    const asset = TEA_ASSETS[teaKey];

    teaModalTitle.textContent = tea ? teaName(tea) : "Tea";
    teaModalDesc.textContent = det?.desc?.[lang] || det?.desc?.en || "";

    // image (request #9)
    teaModalImg.src = asset?.img || "";
    teaModalImg.alt = tea ? teaName(tea) : "Tea";

    // classification (request #9)
    renderClassTable(teaKey);

    teaModalOriginTitle.textContent = UI[lang].teaModal.originTitle;
    teaModalFactsTitle.textContent  = UI[lang].teaModal.factsTitle;

    teaModalOrigin.textContent = meta?.origin?.[lang] || meta?.origin?.en || "‚Äî";

    const factsArr = meta?.facts?.[lang] || meta?.facts?.en || [];
    teaModalFacts.innerHTML = factsArr.length
      ? `<ul style="margin:6px 0 0; padding-left:18px;">${factsArr.map(f=>`<li>${escapeHtml(f)}</li>`).join("")}</ul>`
      : "‚Äî";

    teaModalGivesTitle.textContent = UI[lang].teaModal.givesTitle;
    teaModalWhenTitle.textContent  = UI[lang].teaModal.whenTitle;
    teaModalBrewTitle.textContent  = UI[lang].teaModal.brewTitle;

    // request #4: tooltips here too
    renderStatePills(teaModalGives, det?.gives || [], "good", teaKey);
    renderStatePills(teaModalWhen,  det?.when  || [], "bad", teaKey);

    teaModalBrew.textContent = tea ? teaBrew(tea) : "";

    openModal(teaModal);
  }

  function highlightRightCard(){
    window.scrollTo({ top: 0, behavior: "smooth" });
    rightCard.classList.remove("flashGreen");
    void rightCard.offsetWidth;
    rightCard.classList.add("flashGreen");
    rightCard.classList.add("keepGreen");
  }

  // =========================
  // Tooltip behavior (request #4)
  // =========================
  function showTip(html, x, y){
    tooltip.innerHTML = html;
    tooltip.style.display = "block";
    const pad = 12;
    const maxX = window.innerWidth - pad;
    const maxY = window.innerHeight - pad;
    const rect = tooltip.getBoundingClientRect();
    let nx = x + 12;
    let ny = y + 12;
    if(nx + rect.width > maxX) nx = maxX - rect.width;
    if(ny + rect.height > maxY) ny = maxY - rect.height;
    tooltip.style.left = `${Math.max(pad, nx)}px`;
    tooltip.style.top  = `${Math.max(pad, ny)}px`;
  }
  function hideTip(){
    tooltip.style.display = "none";
    tooltip.innerHTML = "";
  }

  // pointer-friendly tooltips:
  document.addEventListener("pointermove", (e)=>{
    if(tooltip.style.display === "block"){
      showTip(tooltip.innerHTML, e.clientX, e.clientY);
    }
  });

  document.addEventListener("pointerover", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip]");
    if(!el) return;
    // show on hover for mouse, on tap for touch
    const isTouch = matchMedia("(pointer: coarse)").matches;
    if(isTouch) return;
    showTip(el.dataset.tip, e.clientX, e.clientY);
  });

  document.addEventListener("pointerout", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip]");
    if(!el) return;
    const isTouch = matchMedia("(pointer: coarse)").matches;
    if(isTouch) return;
    hideTip();
  });

  document.addEventListener("click", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip]");
    if(!el) return;
    const isTouch = matchMedia("(pointer: coarse)").matches;
    if(!isTouch) return;
    const rect = el.getBoundingClientRect();
    showTip(el.dataset.tip, rect.left + rect.width/2, rect.top + rect.height/2);
    setTimeout(hideTip, 1800);
  });

  // =========================
  // Render clouds
  // =========================
  function renderCloud(list, targetEl, type, big=false){
    if(!targetEl) return;
    targetEl.innerHTML = "";
    list.forEach(item=>{
      const btn = document.createElement("button");
      btn.className = `node ${type}` + (big ? " nodeBig" : "");
      btn.dataset.id = item.id;
      btn.dataset.type = type;
      btn.dataset.active = "false";
      btn.dataset.selected = "false";
      btn.innerHTML = `${escapeHtml(TState(item.id, lang))}<span class="checkdot"></span>`;
      btn.addEventListener("click", ()=> onStateClick(item, btn, type));
      targetEl.appendChild(btn);
    });
  }

  function selectStateBtn(id, type){
    document.querySelectorAll(`.node.${type}[data-id="${id}"]`).forEach(btn=>{
      btn.dataset.selected = "true";
    });
  }

  function clearSelectionsUI(){
    document.querySelectorAll(".node").forEach(b=>{
      b.dataset.selected = "false";
      b.dataset.active = "false";
    });
  }

  function renderSelectedChips(){
    function fill(container, ids, kind){
      container.innerHTML = "";
      if(ids.size === 0){
        const t = document.createElement("span");
        t.className = "muted";
        t.textContent = "‚Äî";
        container.appendChild(t);
        return;
      }
      [...ids].forEach(id=>{
        const s = document.createElement("span");
        s.className = `stateChip ${kind}`;
        s.textContent = TState(id, lang);
        container.appendChild(s);
      });
    }
    fill(selectedBadChips, selectedBad, "bad");
    fill(selectedGoodChips, selectedGood, "good");
    fill(selectedBadChipsMobile, selectedBad, "bad");
    fill(selectedGoodChipsMobile, selectedGood, "good");
  }

  function aggregateTeas(states){
    const score = new Map();
    states.forEach(st=>{
      st.teas.slice(0,4).forEach(t=>{
        const cur = score.get(t.key);
        if(cur) cur.count += 1;
        else score.set(t.key, {tea: t, count: 1});
      });
    });
    return [...score.values()].sort((a,b)=> (b.count - a.count) || teaName(a.tea).localeCompare(teaName(b.tea)));
  }

  async function renderTeaList(items, targetUl){
    targetUl.innerHTML = "";
    for(const it of items){
      const tea = it.tea;
      const count = it.count;
      const url = ozonSearchUrl(tea.q);

      const det = TEA_DETAILS[tea.key];
      const removes = (det?.when || []).slice(0,3);
      const gives   = (det?.gives || []).slice(0,3);

      const li = document.createElement("li");
      li.innerHTML = `
        <div class="k">
          <span>
            <button class="teaBtn" type="button" data-tea-key="${tea.key}">
              ${escapeHtml(teaName(tea))}
            </button>
          </span>
          <span class="tag">${escapeHtml(teaTag(tea))}${count ? ` ‚Ä¢ ${count}` : ""}</span>
        </div>
        <div class="muted">${escapeHtml(teaBrew(tea))}</div>

        <!-- request #4: pills in right block with tea-specific explanations -->
        <div class="teaPills">
          <div class="pillRow">
            <span class="pillLabel">${lang==="ru" ? "—É–±–∏—Ä–∞–µ—Ç:" : "reduces:"}</span>
            ${removes.map(id=>`<span class="pillState bad" data-tip="${escapeHtml(reasonFor(tea.key, id))}">${escapeHtml(TState(id, lang))}</span>`).join("")}
          </div>
          <div class="pillRow">
            <span class="pillLabel">${lang==="ru" ? "–¥–∞—ë—Ç:" : "gives:"}</span>
            ${gives.map(id=>`<span class="pillState good" data-tip="${escapeHtml(reasonFor(tea.key, id))}">${escapeHtml(TState(id, lang))}</span>`).join("")}
          </div>
        </div>

        <div class="buyLine">
          <a class="buyLink" href="${url}" target="_blank" rel="noopener">${escapeHtml(UI[lang].buy)}</a>
          <span class="muted" style="font-size:11px;">${escapeHtml(TEA_ASSETS[tea.key]?.credit || "")}</span>
        </div>
      `;
      targetUl.appendChild(li);

      li.querySelector(`button[data-tea-key="${tea.key}"]`)
        .addEventListener("click", ()=> openTeaDetails(tea.key));
    }
  }

  function renderMultiRecommendations(){
    if(selectedBad.size === 0 && selectedGood.size === 0){
      cardTitle.textContent = UI[lang].cardIdleTitle;
      cardDesc.textContent = UI[lang].cardDesc;
      teaList.innerHTML = "";
      teaListMobile.innerHTML = "";
      if(lastReasoning) showReasoning(lastReasoning);
      return;
    }

    cardTitle.textContent = UI[lang].prompts.proTitle;
    cardDesc.textContent = UI[lang].prompts.proDesc;

    const badSel  = [...selectedBad].map(id=>badById[id]).filter(Boolean);
    const goodSel = [...selectedGood].map(id=>goodById[id]).filter(Boolean);

    const merged = aggregateTeas([...badSel, ...goodSel]).slice(0,12);
    void renderTeaList(merged, teaList);
    void renderTeaList(merged, teaListMobile);

    if(lastReasoning) showReasoning(lastReasoning);
  }

  // =========================
  // Mode switching + PRO modal (request #6)
  // =========================
  function setMode(nextMulti){
    multiMode = nextMulti;

    [multiToggle, multiToggleMobile].forEach(t=>{
      t.dataset.on = String(nextMulti);
      t.setAttribute("aria-checked", String(nextMulti));
    });

    cardChip.textContent = nextMulti ? UI[lang].cardModePro : UI[lang].cardModeSingle;

    if(nextMulti){
      document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
      multiBlocks.style.display = "block";
      renderSelectedChips();
      renderMultiRecommendations();
    } else {
      selectedBad.clear();
      selectedGood.clear();
      document.querySelectorAll(".node").forEach(b=> b.dataset.selected = "false");
      multiBlocks.style.display = "none";
      resetSingleView();
      lastReasoning = "";
      hideReasoningMobile();
      hideReasoning();
    }
    updateCounter();
  }

  function resetProModalView(){
    proModalActions.style.display = "flex";
    proModalNo.style.display = "inline-flex";
    proModalYes.style.display = "inline-flex";
    proModalBody.textContent = UI[lang].proModalQuestion;
  }

  function requestEnablePro(){
    pendingEnablePro = true;
    document.getElementById("uiProModalTitle").textContent = UI[lang].proModalTitle;
    resetProModalView();
    proModalNo.textContent = UI[lang].proNo;
    proModalYes.textContent = UI[lang].proYes;
    openModal(proModal);
  }

  function toggleModeWithModal(){
    if(!multiMode){
      requestEnablePro();
    } else {
      setMode(false);
    }
  }

  function proAnswer(isYes){
    // enable PRO anyway, then show the ‚Äúas was‚Äù message (request #6)
    setMode(true);

    proModalActions.style.display = "flex";
    proModalNo.style.display = "none";
    proModalYes.style.display = "none";

    proModalBody.textContent = isYes ? UI[lang].proYesText : UI[lang].proNoText;

    // replace actions with single OK
    proModalActions.innerHTML = `<button class="miniBtn" id="proOkBtn" type="button">${UI[lang].ok}</button>`;
    document.getElementById("proOkBtn").addEventListener("click", ()=>{
      closeModal(proModal);
      // restore original buttons for next time
      proModalActions.innerHTML = `
        <button class="miniBtn" id="proModalNo" type="button">${UI[lang].proNo}</button>
        <button class="primaryBtn" id="proModalYes" type="button">${UI[lang].proYes}</button>
      `;
      // re-bind (since we replaced DOM)
      bindProButtons();
    }, {once:true});
  }

  function bindProButtons(){
    const no = document.getElementById("proModalNo");
    const yes = document.getElementById("proModalYes");
    no.addEventListener("click", ()=> proAnswer(false));
    yes.addEventListener("click", ()=> proAnswer(true));
  }

  // initial binding
  proModalNo.addEventListener("click", ()=> proAnswer(false));
  proModalYes.addEventListener("click", ()=> proAnswer(true));

  [multiToggle, multiToggleMobile].forEach(t=>{
    t.addEventListener("click", toggleModeWithModal);
    t.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleModeWithModal();
      }
    });
  });

  // =========================
  // Click handler (states)
  // =========================
  function onStateClick(item, btn, type){
    if(!multiMode){
      document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
      btn.dataset.active = "true";

      cardTitle.textContent = TState(item.id, lang);
      cardDesc.textContent = (type === "bad") ? UI[lang].prompts.bad : UI[lang].prompts.good;

      const list = item.teas.slice(0,4).map(tea=>({tea, count:null}));
      void renderTeaList(list, teaList);
      void renderTeaList(list, teaListMobile);

      if(lastReasoning) showReasoning(lastReasoning);
      else { hideReasoning(); hideReasoningMobile(); }

      return;
    }

    const set = (type === "bad") ? selectedBad : selectedGood;
    const isSelected = btn.dataset.selected === "true";

    if(isSelected){
      set.delete(item.id);
      btn.dataset.selected = "false";
      // mirror buttons (desktop+mobile)
      document.querySelectorAll(`.node.${type}[data-id="${item.id}"]`).forEach(b=> b.dataset.selected="false");
    } else {
      if(set.size >= 5){
        openModal(limitModal);
        return;
      }
      set.add(item.id);
      document.querySelectorAll(`.node.${type}[data-id="${item.id}"]`).forEach(b=> b.dataset.selected="true");
    }

    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  }

  // Clear buttons
  function clearBad(){
    selectedBad.clear();
    document.querySelectorAll(`.node.bad`).forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  }
  function clearGood(){
    selectedGood.clear();
    document.querySelectorAll(`.node.good`).forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  }
  function clearAll(){
    selectedBad.clear();
    selectedGood.clear();
    document.querySelectorAll(`.node`).forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
    lastReasoning = "";
    hideReasoning();
    hideReasoningMobile();
  }
  clearBadBtn.addEventListener("click", clearBad);
  clearGoodBtn.addEventListener("click", clearGood);
  clearAllBtn.addEventListener("click", clearAll);
  clearBadBtnMobile.addEventListener("click", clearBad);
  clearGoodBtnMobile.addEventListener("click", clearGood);
  clearAllBtnMobile.addEventListener("click", clearAll);

  // =========================
  // Free-text ‚ÄúAI‚Äù button (desktop+mobile)
  // =========================
  function buildReasoningText(inputText, analyzed){
    const esc = escapeHtml;
    const lines = [];
    lines.push(`<div><b>${lang==="ru" ? "–¢–≤–æ–π —Ç–µ–∫—Å—Ç:" : "Your text:"}</b> ${esc(inputText)}</div>`);

    if(analyzed.bad.length === 0 && analyzed.good.length === 0){
      lines.push(`<div style="margin-top:6px;">${esc(lang==="ru"
        ? "–ù–µ –Ω–∞—à—ë–ª —è–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –æ–ø–∏—Å–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ (—Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞, —Ç—É–º–∞–Ω, –ø–æ—Å–ª–µ –æ–±–µ–¥–∞, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ç.–¥.)."
        : "No strong keyword matches ‚Äî try being more specific.")}</div>`);
      return lines.join("");
    }

    function fmtBlock(title, arr){
      if(arr.length === 0) return;
      lines.push(`<div style="margin-top:8px;"><b>${esc(title)}</b></div>`);
      lines.push(`<ul style="margin:6px 0 0; padding-left:18px;">` +
        arr.map(x=>{
          const name = esc(TState(x.id, lang));
          const hits = x.hits.slice(0,5).map(h=>`‚Äú${esc(h)}‚Äù`).join(", ");
          const score = x.score;
          const hitText = hits ? ` ‚Äî ${esc(lang==="ru" ? "–Ω–∞–π–¥–µ–Ω–æ" : "matched")}: ${hits}` : "";
          return `<li>${name} <span style="color:var(--muted);">(${score})${hitText}</span></li>`;
        }).join("") +
      `</ul>`);
    }

    fmtBlock(lang==="ru" ? "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—É–±—Ä–∞—Ç—å)" : "Detected states (reduce)", analyzed.bad);
    fmtBlock(lang==="ru" ? "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤—ã–∑–≤–∞—Ç—å)" : "Detected states (evoke)", analyzed.good);

    lines.push(`<div style="margin-top:8px; color:var(--muted); font-size:12px;">${
      esc(lang==="ru"
        ? "–õ–æ–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (—Å–ª–æ–≤–∞—Ä—å –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ)."
        : "Local keyword matcher (dictionary can be extended in code).")
    }</div>`);

    return lines.join("");
  }

  function applyAI(text){
    const analyzed = analyzeFreeText(text);
    // PRO on (without extra modal here)
    if(!multiMode) setMode(true);

    selectedBad.clear();
    selectedGood.clear();
    clearSelectionsUI();

    analyzed.bad.forEach(x=> selectedBad.add(x.id));
    analyzed.good.forEach(x=> selectedGood.add(x.id));

    [...selectedBad].slice(0,5).forEach(id=> selectStateBtn(id, "bad"));
    [...selectedGood].slice(0,5).forEach(id=> selectStateBtn(id, "good"));

    renderSelectedChips();
    updateCounter();

    lastReasoning = buildReasoningText(text, analyzed);
    renderMultiRecommendations();
    showReasoning(lastReasoning);

    highlightRightCard();

    // jump mobile to step 3
    if(isMobile()){
      setStep(3);
    }
  }

  nlpBtn.addEventListener("click", ()=>{
    const text = (nlpInput.value || "").trim();
    if(!text) return;
    applyAI(text);
  });
  nlpInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){ e.preventDefault(); nlpBtn.click(); }
  });

  nlpBtnMobile.addEventListener("click", ()=>{
    const text = (nlpInputMobile.value || "").trim();
    if(!text) return;
    applyAI(text);
  });
  nlpInputMobile.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){ e.preventDefault(); nlpBtnMobile.click(); }
  });

  // =========================
  // Mobile wizard logic (request #3)
  // =========================
  function isMobile(){
    return window.matchMedia("(max-width: 760px)").matches;
  }
  let step = 0;
  function setStep(n){
    step = Math.max(0, Math.min(3, n));
    const dots = [stepDot0, stepDot1, stepDot2, stepDot3];
    dots.forEach((d,i)=> d.dataset.on = String(i===step));

    mobileStep0.style.display = (step===0) ? "" : "none";
    mobileStep1.style.display = (step===1) ? "" : "none";
    mobileStep2.style.display = (step===2) ? "" : "none";
    mobileStep3.style.display = (step===3) ? "" : "none";

    prevStepBtn.disabled = (step===0);
    nextStepBtn.textContent = (step===3) ? (lang==="ru" ? "–≥–æ—Ç–æ–≤–æ" : "done") : (lang==="ru" ? "–¥–∞–ª—å—à–µ" : "next");
  }

  prevStepBtn.addEventListener("click", ()=> setStep(step-1));
  nextStepBtn.addEventListener("click", ()=>{
    if(step===0){ setStep(1); return; }
    if(step===1){ setStep(2); return; }
    if(step===2){ setStep(3); return; }
    setStep(3);
  });

  // =========================
  // Language + theme
  // =========================
  function applyThemeButtonLabel(){
    const theme = document.documentElement.getAttribute("data-theme") || "light";
    themeBtn.textContent = (theme === "light") ? UI[lang].themeLight : UI[lang].themeDark;
  }

  function setTheme(next){
    document.documentElement.setAttribute("data-theme", next);
    localStorage.setItem("tea_states_theme", next);
    applyThemeButtonLabel();
  }

  themeBtn.addEventListener("click", ()=>{
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    setTheme(cur === "light" ? "dark" : "light");
  });

  function fillLangSelect(){
    langSelect.innerHTML = "";
    LANGS.forEach(l=>{
      const opt = document.createElement("option");
      opt.value = l.id;
      opt.textContent = l.label;
      langSelect.appendChild(opt);
    });
  }

  function setLang(next){
    if(!UI[next]) return;
    lang = next;
    localStorage.setItem("tea_states_lang", lang);
    langSelect.value = lang;
    applyUI();
  }
  langSelect.addEventListener("change", ()=> setLang(langSelect.value));

  function applyUI(){
    const u = UI[lang];
    document.documentElement.lang = lang;

    document.getElementById("uiTitle").textContent = u.title;
    document.getElementById("uiSubtitle").textContent = u.subtitle;
    document.getElementById("uiLangLabel").textContent = u.langLabel;

    document.getElementById("uiBadTitle").textContent = u.badTitle;
    document.getElementById("uiBadHint").textContent = u.badHint;
    document.getElementById("uiBadPill").textContent = u.badPill;

    document.getElementById("uiGoodTitle").textContent = u.goodTitle;
    document.getElementById("uiGoodHint").textContent = u.goodHint;
    document.getElementById("uiGoodPill1").textContent = u.goodPill1;
    document.getElementById("uiGoodPill2").textContent = u.goodPill2;

    document.getElementById("uiAddedRemove").textContent = u.addedRemove;
    document.getElementById("uiAddedGet").textContent = u.addedGet;
    document.getElementById("uiTeaPick").textContent = u.teaPick;
    document.getElementById("uiMultiLine").textContent = u.multiLine;

    clearBadBtn.textContent = u.clear;
    clearGoodBtn.textContent = u.clear;
    clearAllBtn.textContent = u.resetAll;

    document.getElementById("uiBrewQuick").innerHTML = u.quickBrew;

    document.getElementById("uiProTitle").textContent = u.proTitle;
    document.getElementById("uiProTitleMobile").textContent = u.proTitle;

    document.getElementById("uiFineprint").textContent = u.fineprint;
    document.getElementById("uiFineprintMobile").textContent = u.fineprint;

    aboutLink.textContent = u.about;
    aboutLinkMobile.textContent = u.about;

    document.getElementById("uiAboutTitle").textContent = u.aboutTitle;
    document.getElementById("uiAboutBody").textContent = u.aboutBody;

    document.getElementById("uiLimitTitle").textContent = u.limitTitle;
    document.getElementById("uiLimitBody").textContent = u.limitBody;
    closeLimitBtn.textContent = u.ok;

    document.getElementById("uiNlpTitle").textContent = u.nlpTitle;
    document.getElementById("uiNlpHint").textContent = u.nlpHint;
    nlpInput.placeholder = u.nlpPlaceholder;
    nlpBtn.textContent = u.nlpBtn;
    document.getElementById("uiNlpNote").textContent = u.nlpNote;

    // pro modal
    document.getElementById("uiProModalTitle").textContent = u.proModalTitle;
    // if modal currently in question mode, update
    resetProModalView();

    teaModalCloseBtn.textContent = u.ok;
    teaModalOriginTitle.textContent = u.teaModal.originTitle;
    teaModalFactsTitle.textContent  = u.teaModal.factsTitle;
    teaModalGivesTitle.textContent  = u.teaModal.givesTitle;
    teaModalWhenTitle.textContent   = u.teaModal.whenTitle;
    teaModalBrewTitle.textContent   = u.teaModal.brewTitle;

    renderCloud(badStates, badCloud, "bad", false);
    renderCloud(goodStates, goodCloud, "good", false);
    renderCloud(badStates, badCloudMobile, "bad", true);
    renderCloud(goodStates, goodCloudMobile, "good", true);

    // restore selected visuals after re-render
    [...selectedBad].forEach(id=> selectStateBtn(id, "bad"));
    [...selectedGood].forEach(id=> selectStateBtn(id, "good"));
    renderSelectedChips();

    if(multiMode){
      renderMultiRecommendations();
    } else {
      resetSingleView();
    }

    updateCounter();
    applyThemeButtonLabel();

    if(lastReasoning){
      showReasoning(lastReasoning);
    }
  }

  // =========================
  // Init
  // =========================
  function init(){
    fillLangSelect();

    const savedLang = localStorage.getItem("tea_states_lang");
    lang = savedLang || ((navigator.language || "en").toLowerCase().startsWith("ru") ? "ru" : "en");
    langSelect.value = lang;

    const savedTheme = localStorage.getItem("tea_states_theme");
    setTheme(savedTheme || "light");

    // default: single on desktop, PRO on mobile wizard for usability
    if(isMobile()){
      setMode(true);
      setStep(0);
    } else {
      setMode(false);
    }

    applyUI();
  }

  init();

  // Wire tea click delegation
  document.addEventListener("click", (e)=>{
    const btn = e.target.closest && e.target.closest(".teaBtn");
    if(btn && btn.dataset && btn.dataset.teaKey){
      openTeaDetails(btn.dataset.teaKey);
    }
  });

  // Re-bind pro buttons if replaced by OK flow
  function rebindingSafety(){
    // if actions got replaced, ignore
    if(document.getElementById("proModalNo") && document.getElementById("proModalYes")){
      // already bound initially
      return;
    }
  }

  // keep wizard sane on resize
  window.addEventListener("resize", ()=>{
    if(isMobile() && !multiMode){
      setMode(true);
    }
  });

</script>
</body>
</html>

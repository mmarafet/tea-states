<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è</title>

  <style>
    :root{
      /* Light theme */
      --bg: #f6f7fb;
      --card: #ffffff;
      --card2:#fbfcff;
      --text:#0f172a;
      --muted:#5b6578;
      --border: rgba(15,23,42,.12);
      --shadow: 0 10px 28px rgba(15,23,42,.10);

      --btnBg: rgba(15,23,42,.04);
      --btnBgHover: rgba(15,23,42,.07);

      --accent: rgba(13,148,136,.18);
      --accentBorder: rgba(13,148,136,.35);

      --selectBg: #ffffff;
      --selectText: #0f172a;

      --modalBg: rgba(255,255,255,.92);
      --modalBg2: rgba(255,255,255,.86);

      --keepGreenBg1: rgba(13,148,136,.10);
      --keepGreenBg2: rgba(13,148,136,.06);
      --keepGreenBorder: rgba(13,148,136,.45);
      --keepGreenShadow: 0 0 0 6px rgba(13,148,136,.10), 0 14px 30px rgba(15,23,42,.12);

      /* Selected contrast (light) */
      --badSelBg: rgba(2,132,199,.14);
      --badSelBorder: rgba(2,132,199,.55);
      --goodSelBg: rgba(13,148,136,.14);
      --goodSelBorder: rgba(13,148,136,.60);

      --badSelText: var(--text);
      --goodSelText: var(--text);

      --tipBg: rgba(15,23,42,.96);
      --tipText: #ffffff;
      --tipBorder: rgba(255,255,255,.16);

      --dangerBorder: rgba(244,63,94,.28);
      --dangerBg: rgba(244,63,94,.10);
    }

    html[data-theme="dark"]{
      /* Dark theme */
      --bg:#0b0f14;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --text:#e8eef5;
      --muted:#9aaabb;
      --border: rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);

      --btnBg: rgba(255,255,255,.08);
      --btnBgHover: rgba(255,255,255,.12);

      --accent: rgba(125, 211, 252, .14);
      --accentBorder: rgba(125, 211, 252, .28);

      --selectBg: rgba(12,16,22,.95);
      --selectText: #e8eef5;

      --modalBg: rgba(12,16,22,.92);
      --modalBg2: rgba(12,16,22,.86);

      --keepGreenBg1: rgba(167, 243, 208, .12);
      --keepGreenBg2: rgba(167, 243, 208, .08);
      --keepGreenBorder: rgba(167, 243, 208, .35);
      --keepGreenShadow: 0 0 0 6px rgba(167,243,208,.10), 0 14px 30px rgba(0,0,0,.35);

      /* Selected contrast (dark) ‚Äî –±–æ–ª–µ–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ */
      --badSelBg: rgba(56,189,248,.22);
      --badSelBorder: rgba(56,189,248,.75);
      --goodSelBg: rgba(34,197,94,.20);
      --goodSelBorder: rgba(34,197,94,.72);

      --badSelText: var(--text);
      --goodSelText: var(--text);

      --tipBg: rgba(10,12,16,.96);
      --tipText: #e8eef5;
      --tipBorder: rgba(255,255,255,.14);

      --dangerBorder: rgba(244,63,94,.32);
      --dangerBg: rgba(244,63,94,.12);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 10% 10%, rgba(2,132,199,.10), transparent 55%),
        radial-gradient(900px 650px at 90% 20%, rgba(13,148,136,.08), transparent 50%),
        var(--bg);
      padding-bottom: env(safe-area-inset-bottom);
    }

    header{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 18px 10px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    h1{ margin: 0 0 6px; font-size: 20px; letter-spacing:.2px; }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
      max-width: 520px;
    }

    .topRight{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .headerLeft{
      flex: 1 1 720px;
      min-width: 240px;
    }
    .topRight{ flex: 0 0 auto; }
    /* Modals: allow inner scrolling (mobile-friendly) */
    .modal{
      display:flex;
      flex-direction: column;
      max-height: calc(100vh - 32px);
    }
    @supports (height: 100dvh){
      .modal{ max-height: calc(100dvh - 32px); }
    }
    .modalBody{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }


    .langWrap{display:flex; align-items:center; gap: 8px; flex-wrap: nowrap;}
    .langThemeStack{display:flex; flex-direction:column; gap:10px; align-items:flex-end;}
    .langSelectWrap{display:flex; align-items:center; gap:10px;}
    .langFlag{font-size:18px; line-height:1; opacity:.9; user-select:none;}

    .langLabel{ color: var(--muted); font-size: 12px; white-space: nowrap; user-select:none; }
    .langSelect{
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid var(--border);
      background: var(--selectBg);
      color: var(--selectText);
      border-radius: 12px;
      padding: 8px 12px;
      min-width: 150px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.10);
      outline: none;
    }

    #domainSelect{ min-width: 200px; }
    .langSelect:hover{ filter: brightness(1.02); }

    /* Domain + classifier switch */
    .domainBlock{
      display:flex;
      flex-direction: column;
      gap: 8px;
      align-items:flex-start;
    }
    .classifierWrap{
      display:flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-start;
      max-width: 320px;
    }
    .classBtn{
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 999px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      line-height: 1;
      white-space: nowrap;
      user-select: none;
    }
    .classBtn:hover{ background: var(--btnBgHover); }
    .classBtn[data-active="true"]{
      border-color: var(--accentBorder);
      background: var(--accent);
    }


    .themeBtn{
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.10);
      outline: none;
    }
    .themeBtn:hover{ background: var(--btnBgHover); }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 18px 18px;
      display: grid;
      grid-template-columns: 1fr 440px;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 980px){
      header{ flex-direction: column; align-items: stretch; }
      .topRight{ justify-content: flex-start; }
      .wrap{ grid-template-columns: 1fr; }
    }

    .left{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 800px){
      .left{ grid-template-columns: 1fr; }
    }

    .panel, .card, .controls, .footerCard, .nlpCard, .mobileNav{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* Right card persistent ‚Äúgreenish‚Äù mode */
    .card.keepGreen{
      border-color: var(--keepGreenBorder);
      box-shadow: var(--keepGreenShadow);
      background: linear-gradient(180deg, var(--keepGreenBg1), var(--keepGreenBg2));
    }

    /* Flash animation on NLP pick */
    @keyframes greenFlash {
      0%   { box-shadow: 0 0 0 0 rgba(13,148,136,0.0), var(--shadow); }
      40%  { box-shadow: 0 0 0 10px rgba(13,148,136,0.20), var(--shadow); }
      100% { box-shadow: var(--keepGreenShadow); }
    }
    .card.flashGreen{
      animation: greenFlash 900ms ease-out forwards;
    }

    .head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    html[data-theme="light"] .head{ background: rgba(15,23,42,.02); }
    .title{ font-weight: 800; font-size: 14px; letter-spacing:.2px; }
    .hint{ color: var(--muted); font-size: 12px; white-space: nowrap; }
    .body{ padding: 12px; }

    .legend{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 0 0 10px;
    }
    .pill{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .pill{ background: rgba(15,23,42,.03); }

    .cloud{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 2px;
    }
    .node{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      line-height: 1;
      user-select: none;
      position: relative;
      white-space: nowrap;
      transition: transform .06s ease, border-color .15s ease, background .15s ease;
    }
    html[data-theme="light"] .node{ background: rgba(15,23,42,.03); }
    .node:hover{ border-color: rgba(15,23,42,.20); }
    html[data-theme="dark"] .node:hover{ border-color: rgba(255,255,255,.20); }
    .node:active{ transform: translateY(1px); }

    /* active in single-mode */
    .node.bad[data-active="true"]{
      border-color: var(--badSelBorder);
      background: var(--badSelBg);
      color: var(--badSelText);
    }
    .node.good[data-active="true"]{
      border-color: var(--goodSelBorder);
      background: var(--goodSelBg);
      color: var(--goodSelText);
    }

    /* selected in PRO (–∫–æ–Ω—Ç—Ä–∞—Å—Ç –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ —Ç–æ–∂–µ) */
    .node.bad[data-selected="true"]{
      border-color: var(--badSelBorder);
      background: var(--badSelBg);
      color: var(--badSelText);
    }
    .node.good[data-selected="true"]{
      border-color: var(--goodSelBorder);
      background: var(--goodSelBg);
      color: var(--goodSelText);
    }

    .checkdot{
      display:none;
      position:absolute;
      right:6px;
      top:50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(15,23,42,.55);
      box-shadow: 0 0 0 2px rgba(255,255,255,.25);
    }
    html[data-theme="dark"] .checkdot{
      background: rgba(255,255,255,.75);
      box-shadow: 0 0 0 2px rgba(0,0,0,.25);
    }
    .node[data-selected="true"] .checkdot{ display:block; }

    /* Right card */
    .cardTop{
      padding: 14px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    html[data-theme="light"] .cardTop{ background: rgba(15,23,42,.02); }
    .cardTop h2{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .chip{
      font-size: 12px;
      border-radius: 999px;
      padding: 5px 9px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
      white-space: nowrap;
    }
    html[data-theme="light"] .chip{ background: rgba(15,23,42,.03); }

    .cardBody{ padding: 14px; }
    .muted{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .divider{ height:1px; background: var(--border); margin: 12px 0; }

    .sectionTitle{
      font-weight: 900;
      font-size: 13px;
      margin: 10px 0 8px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .miniBtn{
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 10px;
      padding: 6px 8px;
      cursor:pointer;
      font-size: 12px;
      white-space: nowrap;
    }
    .miniBtn:hover{ background: var(--btnBgHover); }

    .stateChips{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0 0 8px;
    }
    .stateChip{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      position: relative;
    }
    html[data-theme="light"] .stateChip{ background: rgba(15,23,42,.03); }

    /* –¶–≤–µ—Ç–∞ —á–∏–ø–æ–≤ —Å–ø—Ä–∞–≤–∞ (–∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–µ–º—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) */
    .stateChip.bad{
      border-color: var(--badSelBorder);
      background: color-mix(in oklab, var(--badSelBg) 70%, transparent);
    }
    .stateChip.good{
      border-color: var(--goodSelBorder);
      background: color-mix(in oklab, var(--goodSelBg) 70%, transparent);
    }

    .list{ margin: 10px 0 0; padding: 0; list-style: none; }
    .list li{
      padding: 10px 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 8px;
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .list li{ background: rgba(15,23,42,.02); }

    .listTop{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content: space-between;
    }

    .thumb{
      width: 46px;
      height: 46px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }

    .list li .k{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap:10px;
      margin-bottom: 4px;
      font-weight: 850;
      font-size: 13px;
    }

    /* tea name opens modal */
    .teaBtn{
      all: unset;
      cursor: pointer;
      color: var(--text);
      border-bottom: 1px dashed rgba(15,23,42,.25);
      line-height: 1.2;
    }
    html[data-theme="dark"] .teaBtn{
      border-bottom: 1px dashed rgba(255,255,255,.22);
    }
    .teaBtn:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .teaBtn:hover{ border-bottom-color: rgba(255,255,255,.55); }

    .tag{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(0,0,0,.02);
      white-space: nowrap;
      flex: 0 0 auto;
    }
    html[data-theme="dark"] .tag{ background: rgba(0,0,0,.12); }

    .pillWrapSmall{
      display:flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .pillState{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      user-select:none;
    }
    html[data-theme="light"] .pillState{ background: rgba(15,23,42,.03); }
    .pillState.bad{ border-color: var(--badSelBorder); background: color-mix(in oklab, var(--badSelBg) 70%, transparent); }
    .pillState.good{ border-color: var(--goodSelBorder); background: color-mix(in oklab, var(--goodSelBg) 70%, transparent); }

    .pillMore{
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
      user-select:none;
    }
    html[data-theme="light"] .pillMore{ background: rgba(15,23,42,.03); }

    .buyLine{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 8px;
      align-items: baseline;
      flex-wrap: wrap;
    }
    .buyLink{
      color: var(--text);
      text-decoration: none;
      border-bottom: 1px dashed rgba(15,23,42,.22);
      cursor: pointer;
    }
    html[data-theme="dark"] .buyLink{
      border-bottom: 1px dashed rgba(255,255,255,.22);
    }
    .buyLink:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .buyLink:hover{ border-bottom-color: rgba(255,255,255,.55); }

    /* Below area */
    .below{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 18px 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .controls{
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .controlsLeft{ display:flex; align-items:center; gap: 12px; flex-wrap: wrap; }
    .toggleWrap{ display:flex; align-items:center; gap: 10px; }
    .toggle{
      width: 44px;
      height: 26px;
      border-radius: 999px;
      background: rgba(15,23,42,.10);
      border: 1px solid var(--border);
      position: relative;
      cursor: pointer;
      flex: 0 0 auto;
    }
    html[data-theme="dark"] .toggle{ background: rgba(255,255,255,.12); }
    .toggleKnob{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: rgba(15,23,42,.55);
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 2px;
      transition: left .18s ease, background .18s ease;
    }
    html[data-theme="dark"] .toggleKnob{ background: rgba(255,255,255,.75); }
    .toggle[data-on="true"]{
      background: var(--accent);
      border-color: var(--accentBorder);
    }
    .toggle[data-on="true"] .toggleKnob{
      left: 20px;
      background: rgba(13,148,136,.85);
    }
    html[data-theme="dark"] .toggle[data-on="true"] .toggleKnob{
      background: rgba(167, 243, 208, .85);
    }
    .counter{ color: var(--muted); font-size: 12px; white-space: nowrap; }

    /* "–û —Å–∞–π—Ç–µ" moved into PRO block */
    .aboutInline{
      margin-top: 6px;
      font-size: 12px;
      color: var(--text);
      cursor: pointer;
      border-bottom: 1px dashed rgba(15,23,42,.25);
      text-decoration: none;
      user-select:none;
      display:inline-block;
      width: fit-content;
    }
    html[data-theme="dark"] .aboutInline{ border-bottom-color: rgba(255,255,255,.22); }
    .aboutInline:hover{ border-bottom-color: rgba(15,23,42,.55); }
    html[data-theme="dark"] .aboutInline:hover{ border-bottom-color: rgba(255,255,255,.55); }

    .footerCard{ padding: 12px 14px; }
    .fineprint{ color: var(--muted); font-size: 12px; line-height: 1.45; }

    /* AI assistant block (moved AFTER main 3 blocks) */
    .nlpCard{
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .nlpLeft{
      flex: 1 1 520px;
      min-width: 260px;
    }
    .nlpTitle{ font-weight: 900; font-size: 13px; margin: 0 0 8px; }
    .nlpRow{ display:flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .nlpInput{
      flex: 1 1 420px;
      min-width: 240px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.70);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
      font-size: 13px;
    }
    html[data-theme="dark"] .nlpInput{ background: rgba(255,255,255,.06); }
    .nlpInput:focus{
      border-color: var(--accentBorder);
      box-shadow: 0 0 0 4px var(--accent);
    }
    .primaryBtn{
      border: 1px solid var(--accentBorder);
      background: rgba(13,148,136,.14);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 800;
      white-space: nowrap;
    }
    html[data-theme="dark"] .primaryBtn{
      background: rgba(125,211,252,.14);
      border-color: rgba(125,211,252,.28);
    }
    .primaryBtn:hover{ filter: brightness(1.05); }
    .nlpNote{ margin: 8px 0 0; color: var(--muted); font-size: 12px; line-height: 1.4; }

    /* Mobile step-by-step –∞–Ω–∫–µ—Ç–∞ */
    .mobileNav{
      display:none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 18px;
      position: sticky;
      top: 0;
      z-index: 20;
      border-radius: 0 0 16px 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .mobileNavInner{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .stepTitle{
      font-weight: 900;
      font-size: 13px;
      letter-spacing:.2px;
    }
    .stepHint{
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
    }
    .navBtns{ display:flex; gap: 8px; align-items:center; }
    .navBtn{
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 12px;
      font-weight: 800;
    }
    .navBtn:hover{ background: var(--btnBgHover); }
    .navBtn.primary{
      border-color: var(--accentBorder);
      background: color-mix(in oklab, var(--accent) 55%, transparent);
    }

    /* Mobile step logic via body[data-mstep] */
    @media (max-width: 640px){
      .mobileNav{ display:block; }
      /* Step 1: show only PRO controls + fineprint + AI (optional hidden here) */
      body[data-mstep="1"] .wrap{ display:none; }
      body[data-mstep="1"] #aiBlock{ display:none; }

      /* Step 2: show only "bad" panel */
      body[data-mstep="2"] aside{ display:none; }
      body[data-mstep="2"] #goodPanel{ display:none; }
      body[data-mstep="2"] #aiBlock{ display:none; }

      /* Step 3: show only "good" panel */
      body[data-mstep="3"] aside{ display:none; }
      body[data-mstep="3"] #badPanel{ display:none; }
      body[data-mstep="3"] #aiBlock{ display:none; }

      /* Step 4: show only recommendations (right card) */
      body[data-mstep="4"] .left{ display:none; }

      /* Make right card feel like ‚Äúscreen‚Äù */
      .wrap{ padding-top: 6px; }
      .card{ border-radius: 16px; }
    }

    /* Modals */
    .modalOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 100;
      padding: 16px;
    }
    .modal{
      width: min(760px, 100%);
      border-radius: 16px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--modalBg), var(--modalBg2));
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .modalTop{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      background: rgba(255,255,255,.02);
    }
    .modalTop strong{ font-size: 14px; letter-spacing:.2px; }
    .modalBody{
      padding: 14px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.6;
    }

    .modalActions{
      display:flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      flex-wrap: wrap;
    }

    .modalTop{ flex: 0 0 auto; }
    .modalBody{ flex: 1 1 auto; overflow: auto; }
    .modalActions{ flex: 0 0 auto; }

    .dangerBtn{
      border: 1px solid var(--dangerBorder);
      background: var(--dangerBg);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 12px;
      white-space: nowrap;
    }
    .dangerBtn:hover{ filter: brightness(1.05); }

    /* Tea modal layout (desktop) */
    .teaHead{
      display:flex;
      gap: 12px;
      align-items:flex-start;
    }
    .teaImg{
      width: 92px;
      height: 92px;
      border-radius: 14px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .teaTopMeta{
      flex: 1 1 auto;
      min-width: 0;
    }

    /* Tea modal: compact mobile header pills */
    .teaMini{ display:none; margin-top: 8px; }
    .teaMiniRow{ display:flex; gap: 8px; align-items:flex-start; margin-top: 6px; }
    .miniLabel{ font-size: 11px; color: var(--muted); white-space: nowrap; padding-top: 2px; }
    .pillWrap.mini{ gap: 6px; }
    .pillState.mini{
      font-size: 11px;
      padding: 4px 7px;
      border-radius: 999px;
    }

    @media (max-width: 640px){
      .teaMini{ display:block; }
      /* hide heavy grid in compact mode so the card fits without scrolling */
}

    .teaTopLine{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .teaShort{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.45;
    }

    

    #teaModalBody:not(.expanded) #teaModalDesc{
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    #teaModalBody.expanded #teaModalDesc{
      display: block;
      overflow: visible;
    }
.detailsGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .modalBlockTitle{ font-weight: 900; margin: 0 0 6px; font-size: 13px; }
    .pillWrap{ display:flex; gap: 6px; flex-wrap: wrap; }

    .infoGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    @media (max-width: 520px){
      .infoGrid{ grid-template-columns: 1fr; }
    }
    .infoItem{
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] .infoItem{ background: rgba(15,23,42,.02); }
    .infoK{ font-weight: 900; font-size: 12px; margin-bottom: 2px; }
    .infoV{ color: var(--muted); font-size: 12px; line-height: 1.35; }

    details.accord{
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(255,255,255,.03);
    }
    html[data-theme="light"] details.accord{ background: rgba(15,23,42,.02); }
    details.accord summary{
      cursor: pointer;
      font-weight: 900;
      font-size: 13px;
      list-style: none;
    }
    details.accord summary::-webkit-details-marker{ display:none; }
    details.accord[open]{ background: color-mix(in oklab, var(--accent) 26%, rgba(255,255,255,.02)); }

    /* Mobile tea modal: scrollable content + tap to close */
@media (max-width: 640px){
  .modalOverlay{ padding: 10px; }
  .modal{ width: 100%; border-radius: 18px; }
  .modalBody{
    max-height: calc(100vh - 140px);
    max-height: calc(100dvh - 140px);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
  }
  .teaImg{ width: 78px; height: 78px; }
}

/* Tooltip */
    .tip{
      position: fixed;
      z-index: 1000;
      pointer-events: none;
      max-width: min(320px, calc(100vw - 24px));
      background: var(--tipBg);
      color: var(--tipText);
      border: 1px solid var(--tipBorder);
      border-radius: 12px;
      padding: 10px 10px;
      font-size: 12px;
      line-height: 1.35;
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .12s ease, transform .12s ease;
    }
    .tip.show{
      opacity: 1;
      transform: translateY(0);
    }
    .tip .t1{ font-weight: 900; margin-bottom: 4px; }
    .tip .t2{ color: color-mix(in oklab, var(--tipText) 78%, transparent); }

  
    .blendCard .teaName{font-weight:800;}
</style>
</head>

<body data-mstep="1">
<header>
  <div class="headerLeft">
    <h1 id="uiTitle">–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è</h1>
    <p class="sub" id="uiSubtitle">
      –ù–∞–∂–º–∏ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —Å–ø—Ä–∞–≤–∞ –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –í —Ä–µ–∂–∏–º–µ PRO –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10).
    </p>
  </div>

  <div class="topRight">
    <div class="domainBlock">
      <div class="langWrap domainRow">
        <span class="langLabel" id="uiDomainLabel">–†–∞–∑–¥–µ–ª</span>
        <select class="langSelect" id="domainSelect" aria-label="Section selector"></select>
      </div>
      <div class="langWrap">
        <span class="langLabel" id="uiClassifierLabel">–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä</span>
        <select class="langSelect" id="classifierSelect" aria-label="Classifier selector"></select>
      </div>
    </div>
<div class="langThemeStack">
      <div class="langWrap langRow">
        <span class="langLabel" id="uiLangLabel">–Ø–∑—ã–∫</span>
        <div class="langSelectWrap">
          <select class="langSelect" id="langSelect" aria-label="Language selector"></select>
          <span class="langFlag" id="langFlag" aria-hidden="true">üá∑üá∫</span>
        </div>
      </div>
      <button class="themeBtn" id="themeBtn" type="button">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
    </div>
  </div>
</header>

<!-- Mobile stepper nav -->
<section class="mobileNav" id="mobileNav">
  <div class="mobileNavInner">
    <div>
      <div class="stepTitle" id="mStepTitle">–®–∞–≥ 1/4</div>
      <div class="stepHint" id="mStepHint">–í–∫–ª—é—á–∏ PRO (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)</div>
    </div>
    <div class="navBtns">
      <button class="navBtn" id="mBackBtn" type="button">–ù–∞–∑–∞–¥</button>
      <button class="navBtn primary" id="mNextBtn" type="button">–î–∞–ª–µ–µ</button>
    </div>
  </div>
</section>

<div class="wrap" id="mainWrap">
  <div class="left">
    <section class="panel" id="badPanel">
      <div class="head">
        <div class="title" id="uiBadTitle">–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)</div>
        <div class="hint" id="uiBadHint">20 —à—Ç.</div>
      </div>
      <div class="body">
        <div class="legend">
          <span class="pill" id="uiBadPill">–í PRO: –∫–ª–∏–∫–∞–π –ø–æ ‚Äú–ø–∏–ª—é–ª—è–º‚Äù –¥–æ 5</span>
        </div>
        <div class="cloud" id="badCloud"></div>
      </div>
    </section>
    <section class="panel" id="goodPanel">
      <div class="head">
        <div class="title" id="uiGoodTitle">–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)</div>
        <div class="hint" id="uiGoodHint">20 —à—Ç.</div>
      </div>
      <div class="body">
        <div class="legend">
          <span class="pill" id="uiGoodPill1">–£—Ç—Ä–æ ‚Äî ‚Äú–∑–µ–ª–µ–Ω–µ–µ/—Å–≤–µ—Ç–ª–µ–µ‚Äù</span>
          <span class="pill" id="uiGoodPill2">–í–µ—á–µ—Ä ‚Äî ‚Äú—Ç–µ–º–Ω–µ–µ/—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ‚Äù</span>
        </div>
        <div class="cloud" id="goodCloud"></div>
      </div>
    </section>
  </div>

  <aside>
    <section class="card" id="rightCard">
      <div class="cardTop">
        <h2 id="cardTitle">–í—ã–±–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
        <span class="chip" id="cardChip">–û–¥–∏–Ω –≤—ã–±–æ—Ä</span>
      </div>
      <div class="cardBody">
        <p class="muted" id="cardDesc">
          –í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è –¥–ª—è –Ω–µ–≥–æ. –í ‚ÄúPRO‚Äù ‚Äî —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
        </p>

        <div id="reasoningBox" style="display:none;">
          <div class="divider"></div>
          <div class="sectionTitle">
            <span id="uiWhy">–ü–æ—á–µ–º—É —Ç–∞–∫</span>
            <button class="miniBtn" id="hideWhyBtn" type="button">—Å–∫—Ä—ã—Ç—å</button>
          </div>
          <div class="muted" id="reasoningText"></div>
        </div>

        <div id="multiBlocks" style="display:none;">
          <div class="divider"></div>

          <div class="sectionTitle">
            <span id="uiAddedRemove">–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú—É–±—Ä–∞—Ç—å‚Äù</span>
            <button class="miniBtn" id="clearBadBtn" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
          <div class="stateChips" id="selectedBadChips"></div>

          <div class="sectionTitle">
            <span id="uiAddedGet">–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù</span>
            <button class="miniBtn" id="clearGoodBtn" type="button">–æ—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
          <div class="stateChips" id="selectedGoodChips"></div>

          <div class="divider"></div>
          <p class="muted" id="uiMultiLine">
            –í—ã—à–µ ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é.
          </p>

          <div class="sectionTitle">
            <span id="uiTeaPick">–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</span>
            <button class="miniBtn" id="clearAllBtn" type="button">—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
          </div>
        </div>

        <ul class="list" id="teaList"></ul>

        <div class="divider"></div>
        <p class="muted" id="uiBrewQuick">
          <b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–ª–∏–≤–∞:</b><br/>
          120‚Äì150 –º–ª –≥–∞–π–≤–∞–Ω—å/—á–∞–π–Ω–∏–∫ ‚Ä¢ 4‚Äì6 –≥ (–≤–µ—á–µ—Ä–æ–º 3‚Äì5 –≥) ‚Ä¢ –ø—Ä–æ–ª–∏–≤—ã 5‚Äì15 —Å–µ–∫, –¥–∞–ª–µ–µ –ø–æ –≤–∫—É—Å—É.
        </p>
      </div>
    </section>
  </aside>
</div>

<div class="below">
  <!-- AI block moved here (AFTER the main 3 blocks) -->
  <section class="nlpCard" id="aiBlock">
    <div class="nlpLeft">
      <div class="nlpTitle" id="uiNlpTitle">–û–ø–∏—à–∏ —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ —è –ø–æ–¥–±–µ—Ä—É —á–∞–∏</div>
      <div class="nlpRow">
        <input class="nlpInput" id="nlpInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ—Å–ª–µ –æ–±–µ–¥–∞ –∫–ª–æ–Ω–∏—Ç –≤ —Å–æ–Ω, –≥–æ–ª–æ–≤–∞ –≤–∞—Ç–Ω–∞—è, —Ö–æ—á–µ—Ç—Å—è —Å–æ–±—Ä–∞—Ç—å—Å—è –±–µ–∑ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è¬ª" />
        <button class="primaryBtn" id="nlpBtn" type="button">–ü–æ–¥–æ–±—Ä–∞—Ç—å —á–∞–∏</button>
      </div>
      <div class="nlpNote" id="uiNlpNote">
        –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ—Ç—Å—è PRO –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è.
      </div>
    </div>
  </section>

  <!-- Fineprint -->
  <section class="footerCard">
    <div class="fineprint" id="uiFineprint">
      ‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ñ–µ–∏–Ω, –∫—Ä–µ–ø–æ—Å—Ç—å, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è. –ü—Ä–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.
    </div>
  </section>
<section class="controls" id="controlsPanel">
    <div class="controlsLeft">
      <div class="toggleWrap">
        <div class="toggle" id="multiToggle" data-on="false" role="switch" aria-checked="false" tabindex="0">
          <div class="toggleKnob"></div>
        </div>
        <div>
          <div style="font-weight:900;" id="uiProTitle">–í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π PRO</div>
          <div class="counter" id="counterText">–£–±—Ä–∞—Ç—å: 0/5 ‚Ä¢ –í—ã–∑–≤–∞—Ç—å: 0/5</div>
          <a class="aboutInline" id="aboutLink" href="javascript:void(0)">–û —Å–∞–π—Ç–µ</a>
        </div>
      </div>
    </div>
  </section>

</div>


<!-- Tooltip -->
<div class="tip" id="tip" aria-hidden="true"></div>

<!-- Modal: selection limit -->
<div class="modalOverlay" id="limitModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiLimitTitle">–õ–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞</strong>
      <button class="miniBtn" id="closeLimitBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="uiLimitBody">
      –î–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10—à—Ç), –º–æ–π –¥—Ä—É–≥.
    </div>
  </div>
</div>


<!-- Modal: Coming soon -->
<div class="modalOverlay" id="soonModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiSoonTitle">–°–∫–æ—Ä–æ</strong>
      <button class="miniBtn" id="closeSoonBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="uiSoonBody">–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</div>
  </div>
</div>

<!-- Modal: PRO info (restored) -->
<div class="modalOverlay" id="proModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiProModalTitle">–†–µ–∂–∏–º PRO</strong>
      <button class="miniBtn" id="proModalCloseX" type="button">‚úï</button>
    </div>
    <div class="modalBody" id="uiProModalBody">
      –í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –≤–µ—Ä—Å–∏—é PRO?
    </div>
    <div class="modalActions" id="proModalActions">
      <button class="miniBtn" id="proModalNo" type="button">–Ω–µ—Ç</button>
      <button class="primaryBtn" id="proModalYes" type="button">–¥–∞</button>
    </div>
  </div>
</div>

<!-- Modal: About -->
<div class="modalOverlay" id="aboutModal">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <strong id="uiAboutTitle">–û —Å–∞–π—Ç–µ</strong>
      <button class="miniBtn" id="aboutCloseBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="uiAboutBody">
      –î–∞–Ω–Ω—ã–π —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ GPT-5.2.
      –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–∞—è.
      <br/><br/>
      –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ–∑–∏—Ä–æ–≤–∫–∏, –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫,
      —Å–ø–æ—Å–æ–±–∞ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–π.
    </div>
  </div>
</div>

<!-- Modal: tea details -->
<div class="modalOverlay" id="teaModal">
  <div class="modal" role="dialog" aria-modal="true" id="teaModalCard">
    <div class="modalTop">
      <strong id="teaModalTitle">–ß–∞–π</strong>
      <button class="miniBtn" id="teaModalCloseBtn" type="button">–æ–∫</button>
    </div>
    <div class="modalBody" id="teaModalBody">
      <div class="teaHead">
        <img class="teaImg" id="teaModalImg" alt="" />
        <div class="teaTopMeta">
          <div class="teaTopLine">
            <div class="muted" id="teaModalTagLine"></div>
            <span class="tag" id="teaModalTag"></span>
          </div>
          <div class="muted" id="teaModalDesc"></div>
          <div class="teaMini" id="teaMini">
            <div class="teaMiniRow">
              <span class="miniLabel" id="uiMiniGivesLabel">–î–∞—ë—Ç:</span>
              <div class="pillWrap mini" id="teaModalGivesMini"></div>
            </div>
            <div class="teaMiniRow">
              <span class="miniLabel" id="uiMiniRemovesLabel">–£–±–∏—Ä–∞–µ—Ç:</span>
              <div class="pillWrap mini" id="teaModalWhenMini"></div>
            </div>
          </div>
          
          <div style="margin-top:8px;">
            <button class="miniBtn" id="teaMoreBtn" type="button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>
        </div>
      </div>

      <div class="detailsGrid">
        <div>
          <div class="modalBlockTitle" id="teaModalGivesTitle">–ß—Ç–æ –æ–±—ã—á–Ω–æ –¥–∞—ë—Ç</div>
          <div class="pillWrap" id="teaModalGives"></div>
        </div>

        <div>
          <div class="modalBlockTitle" id="teaModalWhenTitle">–ß—Ç–æ –æ–±—ã—á–Ω–æ —É–±–∏—Ä–∞–µ—Ç</div>
          <div class="pillWrap" id="teaModalWhen"></div>
        </div>

        <details class="accord" id="teaClassAccord">
          <summary id="teaModalClassTitle">–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</summary>
          <div style="margin-top:10px;" class="infoGrid" id="teaModalClassGrid"></div>
        </details>

        <details class="accord">
          <summary id="teaModalOriginTitle">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ</summary>
          <div class="muted" id="teaModalOrigin" style="margin-top:8px;"></div>
        </details>

        <details class="accord">
          <summary id="teaModalFactsTitle">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã</summary>
          <div class="muted" id="teaModalFacts" style="margin-top:8px;"></div>
        </details>

        <details class="accord">
          <summary id="teaModalBrewTitle">–ó–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</summary>
          <div class="muted" id="teaModalBrew" style="margin-top:8px;"></div>
        </details>
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // i18n: RU + EN
  // =========================
  const LANGS = [
    { id:"ru", label:"–†—É—Å—Å–∫–∏–π" },
    { id:"en", label:"English" },
  ];

  const UI = {
    ru: {
      title:"–ß–∞–π ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏—è",
      subtitle:"–ù–∞–∂–º–∏ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —Å–ø—Ä–∞–≤–∞ –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –í —Ä–µ–∂–∏–º–µ PRO –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10).",
      langLabel:"–Ø–∑—ã–∫",
      domainLabel:"–†–∞–∑–¥–µ–ª",
    classifierLabel:"–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä",
      domains:[
        {id:"tea", label:"–ö–∏—Ç–∞–π—Å–∫–∏–π —á–∞–π"},
        {id:"herbs", label:"–¢—Ä–∞–≤—ã"},
        {id:"incense", label:"–ë–ª–∞–≥–æ–≤–æ–Ω–∏—è"},
        {id:"spices", label:"–°–ø–µ—Ü–∏–∏"},
        {id:"supplements", label:"–ë–ê–î—ã"},
        {id:"plants", label:"–†–∞—Å—Ç–µ–Ω–∏—è"},
      ],
      classifiers:[
        {id:"states", label:"–°–æ—Å—Ç–æ—è–Ω–∏—è"},
        {id:"qualities", label:"–ö–∞—á–µ—Å—Ç–≤–∞"},
        {id:"health", label:"–ó–¥–æ—Ä–æ–≤—å–µ"},
        {id:"psych", label:"–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è"},
      ],
      soonClassifierBody:"–≠—Ç–æ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ. –°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ä–µ–∂–∏–º ¬´–°–æ—Å—Ç–æ—è–Ω–∏—è¬ª.",

      soonTitle:"–°–∫–æ—Ä–æ",
      soonBody:"–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.",
      miniGivesLabel:"–î–∞—ë—Ç:",
      miniRemovesLabel:"–£–±–∏—Ä–∞–µ—Ç:",

      themeLight:"‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞",
      themeDark:"üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞",

      badTitle:"–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)", badHint:"20 —à—Ç.", badPill:"–í PRO: –∫–ª–∏–∫–∞–π –ø–æ ‚Äú–ø–∏–ª—é–ª—è–º‚Äù –¥–æ 5",
      goodTitle:"–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)", goodHint:"20 —à—Ç.",
      goodPill1:"–£—Ç—Ä–æ ‚Äî ‚Äú–∑–µ–ª–µ–Ω–µ–µ/—Å–≤–µ—Ç–ª–µ–µ‚Äù", goodPill2:"–í–µ—á–µ—Ä ‚Äî ‚Äú—Ç–µ–º–Ω–µ–µ/—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ‚Äù",

      cardIdleTitle:"–í—ã–±–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",
      cardModeSingle:"–û–¥–∏–Ω –≤—ã–±–æ—Ä",
      cardModePro:"PRO",
      cardDesc:"–í ‚Äú–û–¥–∏–Ω –≤—ã–±–æ—Ä‚Äù ‚Äî –∫–ª–∏–∫ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–∫–∞–∂–µ—Ç 3‚Äì4 —á–∞—è –¥–ª—è –Ω–µ–≥–æ. –í ‚ÄúPRO‚Äù ‚Äî —Å–ø—Ä–∞–≤–∞ —Å–æ–±–µ—Ä—ë—Ç—Å—è –æ–±—â–∏–π –ø–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.",

      why:"–ü–æ—á–µ–º—É —Ç–∞–∫",
      hide:"—Å–∫—Ä—ã—Ç—å",

      addedRemove:"–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú—É–±—Ä–∞—Ç—å‚Äù", addedGet:"–î–æ–±–∞–≤–ª–µ–Ω–æ: ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù", teaPick:"–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
      clear:"–æ—á–∏—Å—Ç–∏—Ç—å", resetAll:"—Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë",
      multiLine:"–í—ã—à–µ ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é.",

      quickBrew:"<b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–ª–∏–≤–∞:</b><br/>120‚Äì150 –º–ª –≥–∞–π–≤–∞–Ω—å/—á–∞–π–Ω–∏–∫ ‚Ä¢ 4‚Äì6 –≥ (–≤–µ—á–µ—Ä–æ–º 3‚Äì5 –≥) ‚Ä¢ –ø—Ä–æ–ª–∏–≤—ã 5‚Äì15 —Å–µ–∫, –¥–∞–ª–µ–µ –ø–æ –≤–∫—É—Å—É.",

      proTitle:"–í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π PRO",
      counter:(a,b)=>`–£–±—Ä–∞—Ç—å: ${a}/5 ‚Ä¢ –í—ã–∑–≤–∞—Ç—å: ${b}/5`,

      proModalTitle:"–†–µ–∂–∏–º PRO",
      proModalQuestion:"–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –≤–µ—Ä—Å–∏—é PRO?",
      proNo:"–Ω–µ—Ç",
      proYes:"–¥–∞",
      proNoText:"–ü—Ä–æ–¥—É–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è, —Ç–æ –º–æ–∂–µ—Ç–µ –∑–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É —Å–±–µ—Ä–±–∞–Ω–∫–∞: 2202206736083473",
      proYesText:"–ü–æ—Ö–≤–∞–ª—å–Ω–æ –∫–æ–Ω–µ—á–Ω–æ, –Ω–æ –ø—Ä–æ–¥—É–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –ï—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è, —Ç–æ –º–æ–∂–µ—Ç–µ –∑–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É —Å–±–µ—Ä–±–∞–Ω–∫–∞: 2202206736083473",
      ok:"–æ–∫",

      nlpTitle:"–û–ø–∏—à–∏ —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ —è –ø–æ–¥–±–µ—Ä—É —á–∞–∏",
      nlpPlaceholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ—Å–ª–µ –æ–±–µ–¥–∞ –∫–ª–æ–Ω–∏—Ç –≤ —Å–æ–Ω, –≥–æ–ª–æ–≤–∞ –≤–∞—Ç–Ω–∞—è, —Ö–æ—á–µ—Ç—Å—è —Å–æ–±—Ä–∞—Ç—å—Å—è –±–µ–∑ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è¬ª",
      nlpBtn:"–ü–æ–¥–æ–±—Ä–∞—Ç—å —á–∞–∏",
      nlpNote:"–†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ 5 ‚Äú—É–±—Ä–∞—Ç—å‚Äù –∏ –¥–æ 5 ‚Äú–≤—ã–∑–≤–∞—Ç—å‚Äù, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ—Ç—Å—è PRO –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è.",

      prompts:{
        badTea:"–ü–æ–¥ —ç—Ç–∏ –æ—â—É—â–µ–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç:",
        badHerbs:"–ü–æ–¥ —ç—Ç–∏ –æ—â—É—â–µ–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç —Ç—Ä–∞–≤—ã/–Ω–∞—Å—Ç–æ–∏:",
        goodTea:"–ß—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–ø—Ä–æ–±—É–π:",
        goodHerbs:"–ß—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–ø—Ä–æ–±—É–π —Ç—Ä–∞–≤—è–Ω–æ–π –Ω–∞—Å—Ç–æ–π/—Å–±–æ—Ä:",
        proTitle:"–ü–æ–¥–±–æ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
        proDescTea:"–ù–∏–∂–µ ‚Äî —á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é.",
        proDescHerbs:"–ù–∏–∂–µ ‚Äî —Ç—Ä–∞–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é."
      },

      brewQuickTea:`<b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–ª–∏–≤–∞:</b><br/>120‚Äì150 –º–ª –≥–∞–π–≤–∞–Ω—å/—á–∞–π–Ω–∏–∫ ‚Ä¢ 4‚Äì6 –≥ (–≤–µ—á–µ—Ä–æ–º 3‚Äì5 –≥) ‚Ä¢ –ø—Ä–æ–ª–∏–≤—ã 5‚Äì15 —Å–µ–∫, –¥–∞–ª–µ–µ –ø–æ –≤–∫—É—Å—É.`,
      brewQuickHerbs:`<b>–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Å—Ç–æ—è:</b><br/>–ù–∞ 1 –ª: 6‚Äì12 –≥ —Å–±–æ—Ä–∞ (–º—è–≥–∫–æ ‚Üí 6‚Äì8 –≥, –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ ‚Üí 10‚Äì12 –≥) ‚Ä¢ 90‚Äì95¬∞C ‚Ä¢ –Ω–∞—Å—Ç–æ—è—Ç—å 10‚Äì15 –º–∏–Ω—É—Ç. –ù–∞—á–∏–Ω–∞–π —Å –º–µ–Ω—å—à–µ–π –¥–æ–∑–∏—Ä–æ–≤–∫–∏.`,

      fineprintTea:"‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —á–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ñ–µ–∏–Ω, –∫—Ä–µ–ø–æ—Å—Ç—å, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è. –ü—Ä–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.",
      fineprintHerbs:"‚ÑπÔ∏è –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Ç—Ä–∞–≤—è–Ω—ã–µ —Å–±–æ—Ä—ã/–Ω–∞—Å—Ç–æ–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞; —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–∏–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏, –¥–æ–∑–∏—Ä–æ–≤–∫—É –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è. –ü—Ä–∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.",
      about:"–û —Å–∞–π—Ç–µ",

      aboutTitle:"–û —Å–∞–π—Ç–µ",
      aboutBody:`–î–∞–Ω–Ω—ã–π —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ GPT-5.2.
–ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –æ–±–æ–±—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –æ–ø–∏—Å–∞–Ω–∏—è: –∫–∏—Ç–∞–π—Å–∫–∞—è —á–∞–π–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞, —Ñ–∏—Ç–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –∞ —Ç–∞–∫–∂–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Å–æ—Å—Ç–∞–≤–µ (–∫–æ—Ñ–µ–∏–Ω, L-—Ç–µ–∞–Ω–∏–Ω, –ø–æ–ª–∏—Ñ–µ–Ω–æ–ª—ã; –¥–ª—è —Ç—Ä–∞–≤ ‚Äî —ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞, –≥–æ—Ä–µ—á–∏, –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ –∫–∏—Å–ª–æ—Ç—ã –∏ –¥—Ä.) –∏ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ–º –≤–ª–∏—è–Ω–∏–∏ –Ω–∞ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –∏ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.

–†–∞–∑–¥–µ–ª—ã —Å–∞–π—Ç–∞ –º–æ–≥—É—Ç –≤–∫–ª—é—á–∞—Ç—å: –∫–∏—Ç–∞–π—Å–∫–∏–µ —á–∞–∏, —Ç—Ä–∞–≤—è–Ω—ã–µ —Å–±–æ—Ä—ã, —Å–ø–µ—Ü–∏–∏, –±–ª–∞–≥–æ–≤–æ–Ω–∏—è, —Ä–∞—Å—Ç–µ–Ω–∏—è –∏ –ë–ê–î—ã. –≠—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏/–∏–¥–µ–∏ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞, –∞ –Ω–µ ¬´–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ¬ª.

–í–∞–∂–Ω–æ:
‚Ä¢ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞;
‚Ä¢ —Ä–µ–∞–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ–∑–∏—Ä–æ–≤–∫–∏, –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫, —Å–ø–æ—Å–æ–±–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –∑–¥–æ—Ä–æ–≤—å—è;
‚Ä¢ –≤–æ–∑–º–æ–∂–Ω—ã –∞–ª–ª–µ—Ä–≥–∏–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —Ç—Ä–∞–≤ –∏ –ë–ê–î–æ–≤).

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π, –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –ª–µ—á–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—Ä–∞—á–∞. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π, –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏, –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å–Ω–∞, —Å–µ—Ä–¥–µ—á–Ω–æ‚Äë—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–ª–∏ –ø—Ä–∏—ë–º–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.

–ò—Å–ø–æ–ª—å–∑—É—è —Å–∞–π—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.`,

      limitTitle:"–õ–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞",
      limitBody:"–î–æ 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—Å–µ–≥–æ –¥–æ 10—à—Ç), –º–æ–π –¥—Ä—É–≥.",

      buy:"–∫—É–ø–∏—Ç—å",
      more:"–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
      less:"–°–≤–µ—Ä–Ω—É—Ç—å",

      teaModal:{
        originTitle:"–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ",
        factsTitle:"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã",
        givesTitle:"–ß—Ç–æ –æ–±—ã—á–Ω–æ –¥–∞—ë—Ç",
        whenTitle:"–ß—Ç–æ –æ–±—ã—á–Ω–æ —É–±–∏—Ä–∞–µ—Ç",
        brewTitle:"–ó–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ",
        classTitle:"–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è",
      },

      mobile:{
        steps:[
          {t:"–®–∞–≥ 1/4", h:"–í–∫–ª—é—á–∏ PRO (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)"},
          {t:"–®–∞–≥ 2/4", h:"–í—ã–±–µ—Ä–∏ ¬´—Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å¬ª"},
          {t:"–®–∞–≥ 3/4", h:"–í—ã–±–µ—Ä–∏ ¬´—Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É¬ª"},
          {t:"–®–∞–≥ 4/4", h:"–°–º–æ—Ç—Ä–∏ –ø–æ–¥–±–æ—Ä"},
        ],
        back:"–ù–∞–∑–∞–¥",
        next:"–î–∞–ª–µ–µ",
        done:"–ì–æ—Ç–æ–≤–æ",
      }
    },

    en: {
      title:"Tea ‚Üí States",
      subtitle:"Click a state ‚Äî recommendations appear on the right. In PRO mode you can pick up to 5 states from each list (10 total).",
      langLabel:"Language",
      domainLabel:"Category",
      domains:[
        {id:"tea", label:"Chinese tea"},
        {id:"herbs", label:"Herbs"},
        {id:"incense", label:"Incense"},
        {id:"spices", label:"Spices"},
        {id:"supplements", label:"Supplements"},
        {id:"plants", label:"Plants"},
      ],
      classifiers:[
        {id:"states", label:"States"},
        {id:"qualities", label:"Qualities"},
        {id:"health", label:"Health"},
        {id:"psych", label:"Psychology"},
      ],
      soonClassifierBody:"This classifier is coming soon. For now, only ‚ÄúStates‚Äù is available.",

      soonTitle:"Coming soon",
      soonBody:"This section is under construction.",
      miniGivesLabel:"Gives:",
      miniRemovesLabel:"Removes:",

      themeLight:"‚òÄÔ∏è Light theme",
      themeDark:"üåô Dark theme",

      badTitle:"Current states (reduce)", badHint:"20", badPill:"In PRO: pick up to 5",
      goodTitle:"Desired states (evoke)", goodHint:"20",
      goodPill1:"Morning ‚Äî ‚Äúgreener/lighter‚Äù", goodPill2:"Evening ‚Äî ‚Äúdarker/more fermented‚Äù",

      cardIdleTitle:"Pick a state",
      cardModeSingle:"Single",
      cardModePro:"PRO",
      cardDesc:"Single mode: click a state to see 3‚Äì4 teas. PRO mode aggregates recommendations for selected states.",

      why:"Why",
      hide:"hide",

      addedRemove:"Selected: ‚Äúreduce‚Äù", addedGet:"Selected: ‚Äúevoke‚Äù", teaPick:"Recommendations for selected states",
      clear:"clear", resetAll:"reset all",
      multiLine:"Above ‚Äî selected states. Below ‚Äî teas that most often fit this combination.",

      quickBrew:"<b>Quick gongfu setup:</b><br/>120‚Äì150 ml gaiwan/pot ‚Ä¢ 4‚Äì6 g (evening 3‚Äì5 g) ‚Ä¢ 5‚Äì15 s infusions, then adjust.",

      proTitle:"Select multiple states PRO",
      counter:(a,b)=>`Reduce: ${a}/5 ‚Ä¢ Evoke: ${b}/5`,

      proModalTitle:"PRO mode",
      proModalQuestion:"Are you sure you want to purchase PRO?",
      proNo:"no",
      proYes:"yes",
      proNoText:"The product is free, but if you really want ‚Äî you can donate to Sberbank card: 2202206736083473",
      proYesText:"Nice, but the product is free. If you really want ‚Äî you can donate to Sberbank card: 2202206736083473",
      ok:"OK",

      nlpTitle:"Describe your state in your own words and I‚Äôll pick teas",
      nlpPlaceholder:"E.g. ‚Äúafter lunch I get sleepy, brain fog, want calm focus without stress‚Äù",
      nlpBtn:"Pick teas",
      nlpNote:"Runs locally in your browser: keywords map to up to 5 ‚Äúreduce‚Äù + 5 ‚Äúevoke‚Äù, then PRO turns on with reasoning.",

      prompts:{
        badTea:"These teas often fit this feeling:",
        badHerbs:"These herbs/infusions often fit this feeling:",
        goodTea:"To amplify this state, try:",
        goodHerbs:"To amplify this state, try an herbal infusion/blend:",
        proTitle:"Recommendations for selected states",
        proDescTea:"Below are teas that most often fit this combination.",
        proDescHerbs:"Below are herbs that most often fit this combination."
      },

      brewQuickTea:`<b>Quick gongfu setup:</b><br/>120‚Äì150 ml gaiwan/teapot ‚Ä¢ 4‚Äì6 g (evening 3‚Äì5 g) ‚Ä¢ infusions 5‚Äì15 sec, then adjust to taste.`,
      brewQuickHerbs:`<b>Quick infusion setup:</b><br/>Per 1 liter: 6‚Äì12 g blend (gentle ‚Üí 6‚Äì8 g, stronger ‚Üí 10‚Äì12 g) ‚Ä¢ 90‚Äì95¬∞C ‚Ä¢ steep 10‚Äì15 minutes. Start with a lower dose.`,

      fineprintTea:"‚ÑπÔ∏è Not medical advice. Individual responses to tea vary; consider caffeine, strength, time of day, and contraindications. If you have medical conditions, are pregnant/breastfeeding, or take medications ‚Äî consult a professional.",
      fineprintHerbs:"‚ÑπÔ∏è Not medical advice. Individual responses to herbal blends/infusions vary; consider allergies, medication interactions, dosage, and contraindications. If you have medical conditions, are pregnant/breastfeeding, or take medications ‚Äî consult a professional.",
      about:"About",

      aboutTitle:"About",
      aboutBody:`This website uses recommendations generated with the GPT‚Äë5.2 AI model.
The matching logic summarizes information from open sources and traditional description systems: Chinese tea tradition, herbal references, and modern data on composition (caffeine, L‚Äëtheanine, polyphenols; for herbs ‚Äî essential oils, bitters, organic acids, etc.) and their possible links to alertness, focus, relaxation, and subjective wellbeing.

Sections may include: Chinese tea, herbal blends, spices, incense, plants, and supplements. These are ideas and heuristics for selection ‚Äî not prescriptions.

Please note:
‚Ä¢ matches do not guarantee a specific outcome for a specific person;
‚Ä¢ effects depend on dosage, time of day, preparation method, individual sensitivity, and health status;
‚Ä¢ allergies and medication interactions are possible (especially with herbs and supplements).

The information is not medical advice and is not intended to diagnose, treat, cure, or prevent any disease. If you have medical conditions, are pregnant/breastfeeding, have sleep or cardiovascular issues, or take medications ‚Äî consult a professional.

By using the site, you acknowledge the experimental/recommendation nature of the content and make consumption decisions at your own responsibility.`,

      limitTitle:"Selection limit",
      limitBody:"Up to 5 states from each list (10 total), my friend.",

      buy:"buy",
      more:"More",
      less:"Less",

      teaModal:{
        originTitle:"Origin",
        factsTitle:"Fun facts",
        givesTitle:"Typically gives",
        whenTitle:"Typically reduces",
        brewTitle:"Brewing",
        classTitle:"Classification",
      },

      mobile:{
        steps:[
          {t:"Step 1/4", h:"Enable PRO if needed"},
          {t:"Step 2/4", h:"Pick current states"},
          {t:"Step 3/4", h:"Pick desired states"},
          {t:"Step 4/4", h:"See recommendations"},
        ],
        back:"Back",
        next:"Next",
        done:"Done",
      }
    }
  };

  // =========================
  // Tea dictionary + metadata
  // =========================
  const TEA = {
    shu:        {key:"shu",        q:"—à—É –ø—É—ç—Ä —á–∞–π",        name:{ru:"–®—É –ø—É—ç—Ä", en:"Shu pu-erh"}, tag:{ru:"‚Üì –∑–∞–∑–µ–º–ª—è–µ—Ç", en:"‚Üì grounding"}, brew:{ru:"4‚Äì5 –≥ / 120‚Äì150 –º–ª ‚Ä¢ 6‚Äì8 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –≤–µ—á–µ—Ä–æ–º –Ω–µ –∫—Ä–µ–ø–∫–æ", en:"4‚Äì5 g / 120‚Äì150 ml ‚Ä¢ 6‚Äì8 infusions ‚Ä¢ keep light in the evening"} },
    chaTou:     {key:"chaTou",     q:"–ª–∞–æ —á–∞ —Ç–æ—É –ø—É—ç—Ä",    name:{ru:"–õ–∞–æ –ß–∞ –¢–æ—É (–ø—É—ç—Ä–Ω—ã–µ ‚Äú–∫–∞–º—É—à–∫–∏‚Äù)", en:"Lao Cha Tou (pu-erh nuggets)"}, tag:{ru:"‚Üì –º—è–≥–∫–æ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç", en:"‚Üì gentle calm"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ –¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –ø–æ–∑–¥–Ω–∏–º –≤–µ—á–µ—Ä–æ–º ‚Äî —Ç–æ–ø", en:"5‚Äì6 g ‚Ä¢ many infusions ‚Ä¢ great late evening (light)"} },
    liuBao:     {key:"liuBao",     q:"–ª—é –±–∞–æ —Ö—ç–π —á–∞",      name:{ru:"–õ—é –ë–∞–æ (—Ö—ç–π —á–∞)", en:"Liu Bao (hei cha)"}, tag:{ru:"‚Üì —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç", en:"‚Üì stabilizes"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ —Ö–æ—Ä–æ—à–æ –ø–æ—Å–ª–µ –µ–¥—ã", en:"4‚Äì6 g ‚Ä¢ 6‚Äì10 infusions ‚Ä¢ great after food"} },
    fuZhuan:    {key:"fuZhuan",    q:"—Ñ—É —á–∂—É–∞–Ω—å —á–∞–π",      name:{ru:"–§—É –ß–∂—É–∞–Ω—å (—Ö—ç–π —á–∞)", en:"Fu Zhuan (hei cha)"}, tag:{ru:"‚Üì —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω", en:"‚Üì steady baseline"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –º—è–≥–∫–æ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ", en:"4‚Äì6 g ‚Ä¢ 6‚Äì10 infusions ‚Ä¢ smooth and long"} },
    agedWhite:  {key:"agedWhite",  q:"–≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π —á–∞–π –ª–∞–æ –±–∞–π —á–∞", name:{ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π (–õ–∞–æ –ë–∞–π –ß–∞)", en:"Aged white tea"}, tag:{ru:"~ —Ç–∏—Ö–∏–π", en:"~ gentle"}, brew:{ru:"4‚Äì5 –≥ ‚Ä¢ 5‚Äì8 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –º—è–≥–∫–æ, —á–∏—Å—Ç–æ", en:"4‚Äì5 g ‚Ä¢ 5‚Äì8 infusions ‚Ä¢ soft & clean"} },
    white:      {key:"white",      q:"–±–µ–ª—ã–π —á–∞–π –±–∞–π –º—É –¥–∞–Ω—å",  name:{ru:"–ë–µ–ª—ã–π —á–∞–π (–ë–∞–π –ú—É –î–∞–Ω—å)", en:"White tea (Bai Mu Dan)"}, tag:{ru:"‚Üë –º—è–≥–∫–æ", en:"‚Üë soft lift"}, brew:{ru:"4‚Äì5 –≥ ‚Ä¢ 80‚Äì90¬∞C ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã", en:"4‚Äì5 g ‚Ä¢ 80‚Äì90¬∞C ‚Ä¢ short infusions"} },
    hongCha:    {key:"hongCha",    q:"–∫—Ä–∞—Å–Ω—ã–π —á–∞–π —Ö—É–Ω —á–∞", name:{ru:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π (–•—É–Ω –ß–∞)", en:"Black tea (hong cha)"}, tag:{ru:"‚Üí —Ç—ë–ø–ª—ã–π —Ñ–æ–∫—É—Å", en:"‚Üí warm focus"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ 4‚Äì7 –ø—Ä–æ–ª–∏–≤–æ–≤ ‚Ä¢ –±–æ–¥—Ä–∏—Ç –º—è–≥–∫–æ", en:"4‚Äì6 g ‚Ä¢ 4‚Äì7 infusions ‚Ä¢ gentle energy"} },
    green:      {key:"green",      q:"–∑–µ–ª—ë–Ω—ã–π —á–∞–π –ª—É–Ω—Ü–∑–∏–Ω", name:{ru:"–ó–µ–ª—ë–Ω—ã–π (–õ—É–Ω—Ü–∑–∏–Ω)", en:"Green tea (Longjing)"}, tag:{ru:"‚Üë‚Üë —è—Å–Ω–æ—Å—Ç—å", en:"‚Üë‚Üë clarity"}, brew:{ru:"3‚Äì4 –≥ ‚Ä¢ 70‚Äì85¬∞C ‚Ä¢ –Ω–µ –ø–µ—Ä–µ–¥–µ—Ä–∂–∏–≤–∞—Ç—å", en:"3‚Äì4 g ‚Ä¢ 70‚Äì85¬∞C ‚Ä¢ don‚Äôt oversteep"} },
    lightOolong:{key:"lightOolong",q:"—Ç–µ –≥—É–∞–Ω—å –∏–Ω—å —É–ª—É–Ω",  name:{ru:"–°–≤–µ—Ç–ª—ã–π —É–ª—É–Ω (–¢–µ –ì—É–∞–Ω—å –ò–Ω—å)", en:"Light oolong (Tie Guan Yin)"}, tag:{ru:"‚Üë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", en:"‚Üë mood"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ 85‚Äì95¬∞C ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤", en:"5‚Äì6 g ‚Ä¢ 85‚Äì95¬∞C ‚Ä¢ 6‚Äì10 infusions"} },
    darkOolong: {key:"darkOolong", q:"–¥–∞ —Ö—É–Ω –ø–∞–æ —É–ª—É–Ω",    name:{ru:"–¢—ë–º–Ω—ã–π —É–ª—É–Ω (–î–∞ –•—É–Ω –ü–∞–æ)", en:"Dark oolong (Da Hong Pao)"}, tag:{ru:"‚Üí/‚Üì –≥–ª—É–±–∏–Ω–∞", en:"‚Üí/‚Üì depth"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ 95‚Äì100¬∞C ‚Ä¢ 6‚Äì10 –ø—Ä–æ–ª–∏–≤–æ–≤", en:"5‚Äì6 g ‚Ä¢ 95‚Äì100¬∞C ‚Ä¢ 6‚Äì10 infusions"} },
    sheng:      {key:"sheng",      q:"—à–µ–Ω –ø—É—ç—Ä —á–∞–π",       name:{ru:"–®—ç–Ω –ø—É—ç—Ä (—Å—ã—Ä–æ–π)", en:"Sheng pu-erh"}, tag:{ru:"‚Üë‚Üë –±–æ–¥—Ä–∏—Ç", en:"‚Üë‚Üë energizing"}, brew:{ru:"4‚Äì6 –≥ ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã ‚Ä¢ –ª—É—á—à–µ –¥–æ 14:00", en:"4‚Äì6 g ‚Ä¢ short infusions ‚Ä¢ best before 2pm"} },
    yancha:     {key:"yancha",     q:"—è–Ω—å—á–∞ —É–∏—à–∞–Ω—å —É–ª—É–Ω",  name:{ru:"–Ø–Ω—å—á–∞ (—É—Ç—ë—Å–Ω—ã–µ —É–ª—É–Ω—ã –£–∏)", en:"Yancha (Wuyi rock oolong)"}, tag:{ru:"‚Üí –≥–ª—É–±–æ–∫–∏–π —Ñ–æ–∫—É—Å", en:"‚Üí deep focus"}, brew:{ru:"5‚Äì6 –≥ ‚Ä¢ –∫–∏–ø—è—Ç–æ–∫ ‚Ä¢ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã", en:"5‚Äì6 g ‚Ä¢ boiling water ‚Ä¢ short infusions"} }
  };


  // =========================
  // Herbs catalog (minimal v1)
  // =========================
  const HERB = {
    chamomile: {key:"chamomile", q:"—Ä–æ–º–∞—à–∫–∞ —á–∞–π", name:{ru:"–†–æ–º–∞—à–∫–∞", en:"Chamomile"}, tag:{ru:"‚Üì —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ", en:"‚Üì calming"}, brew:{ru:"1‚Äì2 —á.–ª. ‚Ä¢ 90‚Äì95¬∞C ‚Ä¢ 5‚Äì8 –º–∏–Ω", en:"1‚Äì2 tsp ‚Ä¢ 90‚Äì95¬∞C ‚Ä¢ 5‚Äì8 min"} },
    mint:      {key:"mint", q:"–º—è—Ç–∞ —á–∞–π", name:{ru:"–ú—è—Ç–∞", en:"Mint"}, tag:{ru:"~ —Å–≤–µ–∂–µ—Å—Ç—å", en:"~ freshness"}, brew:{ru:"1‚Äì2 —á.–ª. ‚Ä¢ 90¬∞C ‚Ä¢ 5‚Äì7 –º–∏–Ω", en:"1‚Äì2 tsp ‚Ä¢ 90¬∞C ‚Ä¢ 5‚Äì7 min"} },
    lemonBalm: {key:"lemonBalm", q:"–º–µ–ª–∏—Å—Å–∞ —á–∞–π", name:{ru:"–ú–µ–ª–∏—Å—Å–∞", en:"Lemon balm"}, tag:{ru:"‚Üì —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å", en:"‚Üì anxiety"}, brew:{ru:"1‚Äì2 —á.–ª. ‚Ä¢ 90¬∞C ‚Ä¢ 7‚Äì10 –º–∏–Ω", en:"1‚Äì2 tsp ‚Ä¢ 90¬∞C ‚Ä¢ 7‚Äì10 min"} },
    motherwort:{key:"motherwort", q:"–ø—É—Å—Ç—ã—Ä–Ω–∏–∫ —á–∞–π", name:{ru:"–ü—É—Å—Ç—ã—Ä–Ω–∏–∫", en:"Motherwort"}, tag:{ru:"‚Üì –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ", en:"‚Üì tension"}, brew:{ru:"1 —á.–ª. ‚Ä¢ 90¬∞C ‚Ä¢ 7‚Äì10 –º–∏–Ω", en:"1 tsp ‚Ä¢ 90¬∞C ‚Ä¢ 7‚Äì10 min"} },
    ginger:    {key:"ginger", q:"–∏–º–±–∏—Ä—å —á–∞–π", name:{ru:"–ò–º–±–∏—Ä—å", en:"Ginger"}, tag:{ru:"‚Üë —Ä–∞–∑–æ–≥—Ä–µ–≤", en:"‚Üë warming"}, brew:{ru:"–ª–æ–º—Ç–∏–∫–∏ ‚Ä¢ –∫–∏–ø—è—Ç–æ–∫ ‚Ä¢ 5‚Äì10 –º–∏–Ω", en:"slices ‚Ä¢ boiling water ‚Ä¢ 5‚Äì10 min"} },
    ginseng:   {key:"ginseng", q:"–∂–µ–Ω—å—à–µ–Ω—å —á–∞–π", name:{ru:"–ñ–µ–Ω—å—à–µ–Ω—å", en:"Ginseng"}, tag:{ru:"‚Üë —Ç–æ–Ω—É—Å", en:"‚Üë tone"}, brew:{ru:"–ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ‚Ä¢ –Ω–µ –Ω–∞ –Ω–æ—á—å", en:"per instructions ‚Ä¢ not late"} },
    rosehip:   {key:"rosehip", q:"—à–∏–ø–æ–≤–Ω–∏–∫ —á–∞–π", name:{ru:"–®–∏–ø–æ–≤–Ω–∏–∫", en:"Rosehip"}, tag:{ru:"‚Üí –º—è–≥–∫–æ", en:"‚Üí gentle"}, brew:{ru:"–≤ —Ç–µ—Ä–º–æ—Å–µ 2‚Äì4 —á –∏–ª–∏ 10‚Äì15 –º–∏–Ω", en:"thermos 2‚Äì4 h or 10‚Äì15 min"} },
    sage:      {key:"sage", q:"—à–∞–ª—Ñ–µ–π —á–∞–π", name:{ru:"–®–∞–ª—Ñ–µ–π", en:"Sage"}, tag:{ru:"‚Üí –≥–æ—Ä–ª–æ/—è—Å–Ω–æ—Å—Ç—å", en:"‚Üí clarity"}, brew:{ru:"1 —á.–ª. ‚Ä¢ 90¬∞C ‚Ä¢ 5‚Äì8 –º–∏–Ω", en:"1 tsp ‚Ä¢ 90¬∞C ‚Ä¢ 5‚Äì8 min"} },
  };

  const HERB_IMG = {
    chamomile:"https://upload.wikimedia.org/wikipedia/commons/4/4b/Matricaria_chamomilla_flowers.jpg",
    mint:"https://upload.wikimedia.org/wikipedia/commons/6/6d/Mentha_spicata_-_K%C3%B6hler%E2%80%93s_Medizinal-Pflanzen-090.jpg",
    lemonBalm:"https://upload.wikimedia.org/wikipedia/commons/6/63/Melissa_officinalis_plant.jpg",
    motherwort:"https://upload.wikimedia.org/wikipedia/commons/6/6b/Leonurus_cardiaca_-_K%C3%B6hler%E2%80%93s_Medizinal-Pflanzen-085.jpg",
    ginger:"https://upload.wikimedia.org/wikipedia/commons/5/5f/Ginger_Root.jpg",
    ginseng:"https://upload.wikimedia.org/wikipedia/commons/3/33/Panax_ginseng_2005.jpg",
    rosehip:"https://upload.wikimedia.org/wikipedia/commons/0/0f/Rosa_canina_hips.jpg",
    sage:"https://upload.wikimedia.org/wikipedia/commons/2/21/Salvia_officinalis0.jpg",
  };

  // Reuse tea classification grid structure for herbs (labels stay the same; values are herb-specific)
  const HERB_CLASS = {
    common:{
      ferment:{ru:"‚Äî", en:"‚Äî"},
      process:{ru:"–°—É—à–∫–∞/–Ω–∞—Å—Ç–æ–π", en:"Dry & infuse"},
      material:{ru:"–õ–∏—Å—Ç/—Ü–≤–µ—Ç–æ–∫/–∫–æ—Ä–µ–Ω—å", en:"Leaf/flower/root"},
      region:{ru:"–†–∞–∑–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã", en:"Various regions"},
      profile:{ru:"–¢—Ä–∞–≤—è–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å", en:"Herbal profile"},
      texture:{ru:"–í–æ–¥–Ω—ã–π –Ω–∞—Å—Ç–æ–π", en:"Infusion"},
      effect:{ru:"–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ", en:"Individual"},
      aging:{ru:"–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è", en:"Not required"},
      format:{ru:"–†–æ—Å—Å—ã–ø—å—é/–ø–∞–∫–µ—Ç", en:"Loose/bag"},
      storage:{ru:"–°—É—Ö–æ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ", en:"Dry, airtight"},
    }
  };

  const HERB_META = {
    chamomile:{ firstMention:{ru:"–£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π —Ç—Ä–∞–≤–Ω–æ–π —Ç—Ä–∞–¥–∏—Ü–∏–∏ —Å –¥—Ä–µ–≤–Ω–æ—Å—Ç–∏.", en:"Used in European herbal tradition since antiquity."},
      geography:{ru:"–ï–≤—Ä–æ–ø–∞/–ê–∑–∏—è, –∫—É–ª—å—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ.", en:"Europe/Asia, cultivated widely."},
      altitude:{ru:"–û—Ç —Ä–∞–≤–Ω–∏–Ω –¥–æ –ø—Ä–µ–¥–≥–æ—Ä–∏–π.", en:"Lowlands to foothills."},
      facts:{ru:["–ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –≤–µ—á–µ—Ä–æ–º –∏–∑-–∑–∞ –º—è–≥–∫–æ–≥–æ ¬´—É—Å–ø–æ–∫–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ¬ª –æ—â—É—â–µ–Ω–∏—è.","–ï—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Å–ª–∏—à–∫–æ–º –∫—Ä–µ–ø–∫–æ ‚Äî –º–æ–∂–µ—Ç ¬´—Ä–∞–∑–º–æ—Ä–∏—Ç—å¬ª."],
            en:["Often chosen in the evening for a gentle calming feel.","Over-brewing can feel overly sedating."]}},
    mint:{ firstMention:{ru:"–ú—è—Ç–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ –≤ –∫—É–ª–∏–Ω–∞—Ä–∏–∏ –∏ –Ω–∞–ø–∏—Ç–∫–∞—Ö —Å—Ç–æ–ª–µ—Ç–∏—è–º–∏.", en:"Mint has been used in food and drinks for centuries."},
      geography:{ru:"–ö—É–ª—å—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ.", en:"Cultivated widely."},
      altitude:{ru:"–†–∞–∑–Ω—ã–µ –≤—ã—Å–æ—Ç—ã, –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–∞.", en:"Various altitudes, hardy plant."},
      facts:{ru:["–ú–æ–∂–µ—Ç —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ ¬´–æ—Å–≤–µ–∂–∞—Ç—å –≥–æ–ª–æ–≤—É¬ª.","–•–æ—Ä–æ—à–∞ –ø–æ—Å–ª–µ –µ–¥—ã."],
            en:["Can feel subjectively ‚Äòhead-clearing‚Äô.","Often enjoyed after meals."]}},
    lemonBalm:{ firstMention:{ru:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ —Ü–µ–Ω–∏—Ç—Å—è –∫–∞–∫ –º—è–≥–∫–∞—è —Ç—Ä–∞–≤–∞ –¥–ª—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è.", en:"Traditionally valued as a gentle calming herb."},
      geography:{ru:"–ï–≤—Ä–æ–ø–∞, —à–∏—Ä–æ–∫–æ –≤—ã—Ä–∞—â–∏–≤–∞–µ—Ç—Å—è.", en:"Europe, grown widely."},
      altitude:{ru:"–†–∞–≤–Ω–∏–Ω—ã/—Å–∞–¥–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è.", en:"Lowlands/gardens."},
      facts:{ru:["–£ –º–Ω–æ–≥–∏—Ö –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ç–∏—à–µ –≤–Ω—É—Ç—Ä–∏¬ª.","–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–µ—á–µ—Ä–Ω–∏—Ö —Ä–∏—Ç—É–∞–ª–æ–≤."],
            en:["Often feels like ‚Äòquieter inside‚Äô.","Fits well into evening rituals."]}},
    motherwort:{ firstMention:{ru:"–û–¥–Ω–∞ –∏–∑ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∞–≤ –≤ –Ω–∞—Ä–æ–¥–Ω–æ–π —Ç—Ä–∞–¥–∏—Ü–∏–∏.", en:"A classic herb in folk traditions."},
      geography:{ru:"–ï–≤—Ä–æ–ø–∞/–ê–∑–∏—è.", en:"Europe/Asia."},
      altitude:{ru:"–†–∞–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.", en:"Various conditions."},
      facts:{ru:["–ú–æ–∂–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –∫–∞–∫ ¬´—Å–Ω–∏–º–∞–µ—Ç –∑–∞–∂–∏–º¬ª.","–£ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö ‚Äî –ª—É—á—à–µ –º–∞–ª—ã–º–∏ –¥–æ–∑–∞–º–∏."],
            en:["Can feel like it ‚Äòreleases tension‚Äô.","If sensitive, start with small amounts."]}},
    ginger:{ firstMention:{ru:"–ò–∑–≤–µ—Å—Ç–µ–Ω –≤ –ê–∑–∏–∏ –∫–∞–∫ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–π –∫–æ—Ä–µ–Ω—å.", en:"Known in Asia as a warming root."},
      geography:{ru:"–Æ–∂–Ω–∞—è/–Æ–≥–æ‚Äë–í–æ—Å—Ç–æ—á–Ω–∞—è –ê–∑–∏—è.", en:"South/Southeast Asia."},
      altitude:{ru:"–¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã.", en:"Tropical zones."},
      facts:{ru:["–•–æ—Ä–æ—à –≤ —Ö–æ–ª–æ–¥–Ω–æ–µ —É—Ç—Ä–æ.","–û—Å—Ç—Ä—ã–π ‚Äî –Ω–µ –≤—Å–µ–º –Ω–∞—Ç–æ—â–∞–∫."],
            en:["Great on cold mornings.","Spicy‚Äîmay be too much on an empty stomach."]}},
    ginseng:{ firstMention:{ru:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ —Ü–µ–Ω–∏—Ç—Å—è –≤ –í–æ—Å—Ç–æ—á–Ω–æ–π –ê–∑–∏–∏.", en:"Traditionally valued in East Asia."},
      geography:{ru:"–ö–æ—Ä–µ—è/–ö–∏—Ç–∞–π –∏ –¥—Ä.", en:"Korea/China etc."},
      altitude:{ru:"–ß–∞—Å—Ç–æ –≥–æ—Ä–Ω—ã–µ —Ä–∞–π–æ–Ω—ã.", en:"Often mountainous areas."},
      facts:{ru:["–ú–æ–∂–µ—Ç –±–æ–¥—Ä–∏—Ç—å ‚Äî –Ω–µ –Ω–∞ –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä.","–õ—É—á—à–µ –∫—É—Ä—Å–∞–º–∏, –∞ –Ω–µ –ª–∏—Ç—Ä–∞–º–∏."],
            en:["Can be stimulating‚Äîavoid late evening.","Better in courses, not huge amounts."]}},
    rosehip:{ firstMention:{ru:"–ü–ª–æ–¥—ã —à–∏–ø–æ–≤–Ω–∏–∫–∞ —à–∏—Ä–æ–∫–æ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –≤ –Ω–∞–ø–∏—Ç–∫–∞—Ö.", en:"Rosehip fruits have long been used in drinks."},
      geography:{ru:"–ï–≤—Ä–æ–ø–∞/–†–æ—Å—Å–∏—è/–ê–∑–∏—è.", en:"Europe/Russia/Asia."},
      altitude:{ru:"–û—Ç —Ä–∞–≤–Ω–∏–Ω –¥–æ –≥–æ—Ä–Ω—ã—Ö –¥–æ–ª–∏–Ω.", en:"Lowlands to mountain valleys."},
      facts:{ru:["–ú—è–≥–∫–∏–π —Ñ–æ–Ω, —á–∞—Å—Ç–æ —Ö–æ—Ä–æ—à–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è.","–í —Ç–µ—Ä–º–æ—Å–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–∞—Å—ã—â–µ–Ω–Ω–µ–µ."],
            en:["Gentle baseline, often well tolerated.","Thermos brewing makes it richer."]}},
    sage:{ firstMention:{ru:"–®–∞–ª—Ñ–µ–π ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–≤–∞ –≤ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö –ï–≤—Ä–æ–ø—ã.", en:"Sage is a classic herb in European traditions."},
      geography:{ru:"–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—å–µ, –≤—ã—Ä–∞—â–∏–≤–∞—é—Ç —à–∏—Ä–æ–∫–æ.", en:"Mediterranean, grown widely."},
      altitude:{ru:"–°—É—Ö–∏–µ —Å–æ–ª–Ω–µ—á–Ω—ã–µ –∑–æ–Ω—ã.", en:"Dry sunny zones."},
      facts:{ru:["–ß–∞—Å—Ç–æ –ø—å—é—Ç –∫—É—Ä—Å–∞–º–∏, –∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.","–•–æ—Ä–æ—à –≤ –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–π —Å–µ–∑–æ–Ω."],
            en:["Often used in short courses, not constantly.","Nice in the cool season."]}},
  };

  const HERB_DETAILS = {
    chamomile:{ desc:{ru:"–ú—è–≥–∫–∏–π –≤–µ—á–µ—Ä–Ω–∏–π –Ω–∞—Å—Ç–æ–π: —É –º–Ω–æ–≥–∏—Ö —Å–Ω–∏–∂–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—É–µ—Ç—É –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç –∑–∞—Å—ã–ø–∞–Ω–∏–µ.", en:"A gentle evening infusion that often reduces mental noise and supports sleep."},
      gives:["good19","good20","good15","good12"], when:["bad3","bad4","bad12","bad20","bad11"] },
    mint:{ desc:{ru:"–û—Å–≤–µ–∂–∞—é—â–∏–π –Ω–∞—Å—Ç–æ–π: –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å ¬´–ø—Ä–æ–≤–µ—Ç—Ä–∏—Ç—å –≥–æ–ª–æ–≤—É¬ª –∏ –º—è–≥–∫–æ —Å–Ω—è—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.", en:"Refreshing infusion: can feel head-clearing and gently relaxing."},
      gives:["good10","good7","good3","good19"], when:["bad2","bad9","bad17","bad18"] },
    lemonBalm:{ desc:{ru:"–ú–µ–ª–∏—Å—Å–∞ —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ç–∏—à–µ –≤–Ω—É—Ç—Ä–∏¬ª, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç–º–∞.", en:"Lemon balm often feels like ‚Äòquieter inside‚Äô and suits evening routines."},
      gives:["good19","good20","good15","good3"], when:["bad3","bad4","bad12","bad11"] },
    motherwort:{ desc:{ru:"–ü—É—Å—Ç—ã—Ä–Ω–∏–∫ ‚Äî –ø—Ä–æ —Å–Ω—è—Ç–∏–µ –∑–∞–∂–∏–º–∞ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è (–ª—É—á—à–µ –Ω–µ –∫—Ä–µ–ø–∏—Ç—å).", en:"Motherwort can feel tension-releasing (brew lightly)."},
      gives:["good19","good15","good3","good20"], when:["bad3","bad4","bad12","bad20"] },
    ginger:{ desc:{ru:"–°–æ–≥—Ä–µ–≤–∞—é—â–∏–π –∏–º–±–∏—Ä–Ω—ã–π –Ω–∞—Å—Ç–æ–π ‚Äî –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∏ —Ä–∞–∑–æ–≥—Ä–µ–≤–∞ –≤ —Ö–æ–ª–æ–¥–Ω–æ–µ —É—Ç—Ä–æ.", en:"Warming ginger infusion for activation on cold mornings."},
      gives:["good11","good4","good1","good13"], when:["bad1","bad14","bad15","bad7"] },
    ginseng:{ desc:{ru:"–ñ–µ–Ω—å—à–µ–Ω—å –º–æ–∂–µ—Ç –æ—â—É—Ç–∏–º–æ –±–æ–¥—Ä–∏—Ç—å –∏ —Å–æ–±–∏—Ä–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ ‚Äî –Ω–µ –Ω–∞ –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä.", en:"Ginseng can be noticeably stimulating and focusing‚Äîavoid late evening."},
      gives:["good1","good4","good11","good13"], when:["bad1","bad2","bad9","bad10","bad14"] },
    rosehip:{ desc:{ru:"–®–∏–ø–æ–≤–Ω–∏–∫ ‚Äî –º—è–≥–∫–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Ñ–æ–Ω, —á–∞—Å—Ç–æ —Ö–æ—Ä–æ—à–æ –∏–¥—ë—Ç –∫–∞–∫ —É—Ç—Ä–µ–Ω–Ω–∏–π/–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–ø–∏—Ç–æ–∫.", en:"Rosehip gives a gentle supportive baseline, often good morning/day."},
      gives:["good7","good4","good18","good16"], when:["bad1","bad6","bad17","bad14"] },
    sage:{ desc:{ru:"–®–∞–ª—Ñ–µ–π ‚Äî ¬´—Å–æ–±—Ä–∞—Ç—å –≥–æ–ª–æ–≤—É¬ª –∏ —Ç—ë–ø–ª–∞—è —è—Å–Ω–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–π —Å–µ–∑–æ–Ω.", en:"Sage can feel like warm clarity, especially in cooler seasons."},
      gives:["good4","good10","good11","good7"], when:["bad2","bad9","bad17","bad10"] },
  };


  // Images
  
  // =========================
  // Herb blend doses (per 1 liter)
  // =========================
  const HERB_DOSE = {
    chamomile:  {min:1.5, max:4.0, base:2.5, unit:{ru:"–≥", en:"g"}, note:{ru:"–º—è–≥–∫–∞—è –±–∞–∑–∞", en:"soft base"}},
    mint:       {min:0.8, max:2.5, base:1.6, unit:{ru:"–≥", en:"g"}, note:{ru:"—è—Ä–∫–∏–π –≤–∫—É—Å ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ", en:"strong taste ‚Äî go easy"}},
    lemonBalm:  {min:1.5, max:4.0, base:2.5, unit:{ru:"–≥", en:"g"}, note:{ru:"—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –±–∞–∑–∞", en:"calming base"}},
    motherwort: {min:0.5, max:1.5, base:1.0, unit:{ru:"–≥", en:"g"}, note:{ru:"–≥–æ—Ä—å–∫–æ, –ª—É—á—à–µ –º–∞–ª–æ–π –¥–æ–ª–µ–π", en:"bitter ‚Äî keep low"}},
    sage:       {min:1.0, max:2.5, base:1.6, unit:{ru:"–≥", en:"g"}, note:{ru:"–≤—è–∂—É—â–µ–µ, –∞—Ä–æ–º–∞—Ç–Ω–æ–µ", en:"astringent, aromatic"}},
    rosehip:    {min:6.0, max:15.0, base:10.0, unit:{ru:"–≥", en:"g"}, note:{ru:"—è–≥–æ–¥—ã; –º–æ–∂–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Ç–æ–ª–æ—á—å", en:"berries; can be crushed"}},
    ginger:     {min:3.0, max:10.0, base:6.0, unit:{ru:"–≥", en:"g"}, note:{ru:"–ª–æ–º—Ç–∏–∫–∏ —Å–≤–µ–∂–µ–≥–æ –∏–ª–∏ —Å—É—à—ë–Ω—ã–π", en:"fresh slices or dried"}},
    ginseng:    {min:0.5, max:1.5, base:1.0, unit:{ru:"–≥", en:"g"}, note:{ru:"–Ω–µ –ø–æ–∑–¥–Ω–æ –≤–µ—á–µ—Ä–æ–º", en:"not late evening"}},
  };

  function buildHerbBlendFromItems(items){
    // items: [{tea: HERB.*, count:number|null}]
    const top = (items||[]).slice(0,5).filter(x=>x && x.tea && x.tea.key);
    if(top.length===0) return null;

    const weights = top.map(x=>Math.max(1, Number(x.count||1)));
    const raws = top.map((x,i)=>{
      const d = HERB_DOSE[x.tea.key] || {min:1, max:4, base:2};
      return d.base * weights[i];
    });
    const target = 18; // grams per 1 liter (rough, for a ‚Äúcollection‚Äù / blend)
    const sumRaw = raws.reduce((a,b)=>a+b,0) || 1;
    const scale = target / sumRaw;

    const parts = top.map((x,i)=>{
      const d = HERB_DOSE[x.tea.key] || {min:1, max:4, base:2, unit:{ru:"–≥",en:"g"}, note:{ru:"",en:""}};
      let g = raws[i]*scale;
      g = Math.max(d.min, Math.min(d.max, g));
      g = Math.round(g*10)/10;
      return { herb:x.tea, grams:g, note:d.note };
    });

    const total = parts.reduce((a,p)=>a+p.grams,0);
    return { parts, total: Math.round(total*10)/10 };
  }

  function renderHerbBlendCard(items){
    const blend = buildHerbBlendFromItems(items);
    if(!blend) return null;

    const title = (lang==="ru") ? "–°–±–æ—Ä —Ç—Ä–∞–≤ –Ω–∞ 1 –ª–∏—Ç—Ä" : "Herbal blend for 1 liter";
    const hint  = (lang==="ru") ? "–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–º–µ—â–∞—Ç—å ¬±20% –ø–æ–¥ –≤–∫—É—Å –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å." : "You can shift ratios ¬±20% for taste and tolerance.";
    const brew  = (lang==="ru") ? "–ó–∞–ª–µ–π 95‚Äì100¬∞C, –Ω–∞—Å—Ç–æ—è—Ç—å 10‚Äì15 –º–∏–Ω (—à–∏–ø–æ–≤–Ω–∏–∫ ‚Äî –¥–æ–ª—å—à–µ / —Ç–µ—Ä–º–æ—Å)." : "Pour 95‚Äì100¬∞C, steep 10‚Äì15 min (rosehip longer / thermos).";

    const li = document.createElement("li");
    li.className = "teaCard blendCard";
    li.innerHTML = `
      <div class="teaCardInner">
        <div class="teaInfo">
          <div class="teaTop">
            <div class="teaName">${escapeHtml(title)}</div>
          </div>
          <div class="muted">${escapeHtml(brew)}</div>
          <div class="muted" style="margin-top:6px">${escapeHtml(hint)}</div>
          <div class="blendGrid" style="margin-top:10px; display:grid; gap:6px;">
            ${blend.parts.map(p=>`
              <div class="blendRow" style="display:flex; justify-content:space-between; gap:10px;">
                <div>${escapeHtml(teaName(p.herb))}</div>
                <div class="muted">${p.grams} ${(lang==="ru")?"–≥":"g"}</div>
              </div>
            `).join("")}
            <div class="blendRow" style="display:flex; justify-content:space-between; gap:10px; margin-top:6px; padding-top:6px; border-top:1px dashed var(--border);">
              <div class="muted">${escapeHtml((lang==="ru")?"–ò—Ç–æ–≥–æ":"Total")}</div>
              <div class="muted">${blend.total} ${(lang==="ru")?"–≥":"g"}</div>
            </div>
          </div>
        </div>
      </div>
    `;
    return li;
  }
const TEA_IMG = {
    green: "https://commons.wikimedia.org/wiki/Special:FilePath/Longjing_tea_leaves.jpg",
    lightOolong: "https://commons.wikimedia.org/wiki/Special:FilePath/Tieguanyin2.jpg",
    darkOolong: "https://commons.wikimedia.org/wiki/Special:FilePath/Da_Hong_Pao_Oolong_tea_leaf.jpg",
    yancha: "https://commons.wikimedia.org/wiki/Special:FilePath/Da_Hong_Pao_Oolong_tea_leaf.jpg",
    hongCha: "https://commons.wikimedia.org/wiki/Special:FilePath/Yunnan_Black_SFTGFOP_(1).JPG",
    white: "https://commons.wikimedia.org/wiki/Special:FilePath/Bai_Mu_Dan_Tea_Leaves.JPG",
    agedWhite: "https://commons.wikimedia.org/wiki/Special:FilePath/Shou_Mei_tea.JPG",
    shu: "https://commons.wikimedia.org/wiki/Special:FilePath/%22Da_Yi_Gong_Tuo%22_Pu-erh_shou_cha,_2010.jpg",
    sheng: "https://commons.wikimedia.org/wiki/Special:FilePath/Raw_Pu_erh.jpg",
    fuZhuan: "https://commons.wikimedia.org/wiki/Special:FilePath/Brick_tea_4897.jpg",
    liuBao: "https://commons.wikimedia.org/wiki/Special:FilePath/%E9%BB%91%E8%8C%B6%E5%85%AD%E5%A0%A1%E9%87%91%E8%8A%B1%E5%86%99%E7%9C%9F_Liu_Bao.jpg",
    chaTou: "https://commons.wikimedia.org/wiki/Special:FilePath/110601_204646.jpg"
  };

  // Tea classification fields
  const TEA_CLASS = {
    green:{
      ferment:{ru:"–ù–µ —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", en:"Unfermented"},
      process:{ru:"–§–∏–∫—Å–∞—Ü–∏—è/–ø—Ä–æ–∂–∞—Ä–∫–∞, —Å–∫—Ä—É—Ç–∫–∞, —Å—É—à–∫–∞", en:"Kill-green, shaping, drying"},
      material:{ru:"–†–∞–Ω–Ω–∏–π —Å–±–æ—Ä (–≤–µ—Å–Ω–∞), –Ω–µ–∂–Ω—ã–µ –ª–∏—Å—Ç—å—è/–ø–æ—á–∫–∏", en:"Early spring pick, tender leaves/buds"},
      region:{ru:"–ö–∏—Ç–∞–π, –ß–∂—ç—Ü–∑—è–Ω (–•–∞–Ω—á–∂–æ—É/–°–∏—Ö—É)", en:"China, Zhejiang (Hangzhou/West Lake)"},
      profile:{ru:"–û—Ä–µ—Ö–∏, –∑–µ–ª–µ–Ω—å, —Å–ª–∞–¥–æ—Å—Ç—å, —Å–≤–µ–∂–µ—Å—Ç—å", en:"Nutty, grassy, sweet-fresh"},
      texture:{ru:"–õ—ë–≥–∫–∏–π, —á–∏—Å—Ç—ã–π –Ω–∞—Å—Ç–æ–π", en:"Light, clean liquor"},
      effect:{ru:"–Ø—Å–Ω–æ—Å—Ç—å, –±–æ–¥—Ä–æ—Å—Ç—å (–∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏)", en:"Clarity, energy (careful if anxious)"},
      aging:{ru:"–ü–∏—Ç—å —Å–≤–µ–∂–∏–º", en:"Best fresh"},
      format:{ru:"–õ–∏—Å—Ç–æ–≤–æ–π", en:"Loose leaf"},
      storage:{ru:"–ì–µ—Ä–º–µ—Ç–∏—á–Ω–æ, –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ, –±–µ–∑ —Å–≤–µ—Ç–∞/–∑–∞–ø–∞—Ö–æ–≤", en:"Airtight, cool, away from light/odors"},
    },
    lightOolong:{
      ferment:{ru:"–ß–∞—Å—Ç–∏—á–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (–ª—ë–≥–∫–∞—è)", en:"Partly oxidized (light)"},
      process:{ru:"–í—Å—Ç—Ä—è—Å–∫–∞/–æ–∫–∏—Å–ª–µ–Ω–∏–µ, —Ñ–∏–∫—Å–∞—Ü–∏—è, —Å–∫—Ä—É—Ç–∫–∞", en:"Bruising/oxidation, kill-green, rolling"},
      material:{ru:"–õ–∏—Å—Ç —Å—Ä–µ–¥–Ω–µ–π –Ω–µ–∂–Ω–æ—Å—Ç–∏, —Å–µ–∑–æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä—Ç–∏–∏", en:"Mid-tender leaves, season varies"},
      region:{ru:"–ö–∏—Ç–∞–π, –§—É—Ü–∑—è–Ω—å (–ê–Ω—å—Å–∏)", en:"China, Fujian (Anxi)"},
      profile:{ru:"–¶–≤–µ—Ç—ã, —Å–ª–∏–≤–æ—á–Ω–æ—Å—Ç—å, ¬´–≤–æ–∑–≤—Ä–∞—Ç–Ω–∞—è —Å–ª–∞–¥–æ—Å—Ç—å¬ª", en:"Floral, creamy, lingering sweetness"},
      texture:{ru:"–®—ë–ª–∫–æ–≤–∏—Å—Ç—ã–π –Ω–∞—Å—Ç–æ–π", en:"Silky liquor"},
      effect:{ru:"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å", en:"Mood lift, light composure"},
      aging:{ru:"–û–±—ã—á–Ω–æ —Å–≤–µ–∂–∏–π (–∏–Ω–æ–≥–¥–∞ –ª—ë–≥–∫–∞—è –≤—ã–¥–µ—Ä–∂–∫–∞)", en:"Usually fresh (sometimes lightly aged)"},
      format:{ru:"–°–∫—Ä—É—Ç–∫–∞ —à–∞—Ä–∏–∫–∞–º–∏", en:"Rolled balls"},
      storage:{ru:"–ì–µ—Ä–º–µ—Ç–∏—á–Ω–æ, —Å—É—Ö–æ; –±–µ—Ä–µ—á—å –∞—Ä–æ–º–∞—Ç", en:"Airtight, dry; protect aroma"},
    },
    darkOolong:{
      ferment:{ru:"–ß–∞—Å—Ç–∏—á–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–∏–ª—å–Ω–µ–µ) + –æ–±–∂–∞—Ä–∫–∞", en:"Partly oxidized (deeper) + roast"},
      process:{ru:"–û–∫–∏—Å–ª–µ–Ω–∏–µ, —Ñ–∏–∫—Å–∞—Ü–∏—è, –æ–±–∂–∞—Ä–∫–∞", en:"Oxidation, kill-green, roasting"},
      material:{ru:"–õ–∏—Å—Ç –∑—Ä–µ–ª–µ–µ, –≥–æ—Ä–Ω—ã–π —Ç–µ—Ä—Ä—É–∞—Ä", en:"More mature leaves, mountain terroir"},
      region:{ru:"–ö–∏—Ç–∞–π, –§—É—Ü–∑—è–Ω—å (–£–∏—à–∞–Ω—å)", en:"China, Fujian (Wuyi)"},
      profile:{ru:"–ö–∞–º–µ–Ω—å/–º–∏–Ω–µ—Ä–∞–ª—ã, –∂–∞—Ä–µ–Ω—ã–µ –Ω–æ—Ç—ã, –∫–∞–∫–∞–æ", en:"Mineral/rocky, roast, cocoa"},
      texture:{ru:"–ü–ª–æ—Ç–Ω—ã–π –Ω–∞—Å—Ç–æ–π", en:"Dense liquor"},
      effect:{ru:"–ì–ª—É–±–æ–∫–∏–π —Ñ–æ–∫—É—Å, ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å¬ª", en:"Deep focus, collected feel"},
      aging:{ru:"–ß–∞—Å—Ç–æ —É–º–µ—Å—Ç–Ω–∞ –≤—ã–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏", en:"Often benefits from resting/aging after roast"},
      format:{ru:"–õ–∏—Å—Ç–æ–≤–æ–π", en:"Loose leaf"},
      storage:{ru:"–°—É—Ö–æ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ; –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏ –¥–∞—Ç—å ¬´–æ—Ç–ª–µ–∂–∞—Ç—å—Å—è¬ª", en:"Dry, airtight; rest after roast"},
    },
    yancha:null, // below: will alias to darkOolong
    hongCha:{
      ferment:{ru:"–ü–æ–ª–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–∫–∏—Å–ª–µ–Ω–∏–µ)", en:"Fully oxidized"},
      process:{ru:"–ó–∞–≤—è–ª–∏–≤–∞–Ω–∏–µ, —Å–∫—Ä—É—Ç–∫–∞, –æ–∫–∏—Å–ª–µ–Ω–∏–µ, —Å—É—à–∫–∞", en:"Wither, roll, oxidize, dry"},
      material:{ru:"–õ–∏—Å—Ç/–ø–æ—á–∫–∞, —á–∞—Å—Ç–æ –≤–µ—Å–Ω–∞/–ª–µ—Ç–æ", en:"Leaves/buds, often spring/summer"},
      region:{ru:"–ö–∏—Ç–∞–π (–Æ–Ω—å–Ω–∞–Ω—å –∏ –¥—Ä.)", en:"China (Yunnan etc.)"},
      profile:{ru:"–ú—ë–¥, –∫–∞—Ä–∞–º–µ–ª—å, —Ö–ª–µ–±, –∫–∞–∫–∞–æ", en:"Honey, caramel, bread, cocoa"},
      texture:{ru:"–û–∫—Ä—É–≥–ª—ã–π, —Ç—ë–ø–ª—ã–π –Ω–∞—Å—Ç–æ–π", en:"Round, warm liquor"},
      effect:{ru:"–¢—ë–ø–ª–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å", en:"Warm energy and focus"},
      aging:{ru:"–ß–∞—â–µ —Å–≤–µ–∂–∏–π/—Å–µ–∑–æ–Ω–Ω—ã–π", en:"Usually fresh/seasonal"},
      format:{ru:"–õ–∏—Å—Ç–æ–≤–æ–π", en:"Loose leaf"},
      storage:{ru:"–°—É—Ö–æ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, airtight, odor-free"},
    },
    white:{
      ferment:{ru:"–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è", en:"Minimal oxidation"},
      process:{ru:"–ó–∞–≤—è–ª–∏–≤–∞–Ω–∏–µ –∏ —Å—É—à–∫–∞", en:"Wither and dry"},
      material:{ru:"–ü–æ—á–∫–∏ –∏ –º–æ–ª–æ–¥—ã–µ –ª–∏—Å—Ç—å—è (–≤–µ—Å–Ω–∞)", en:"Buds and young leaves (spring)"},
      region:{ru:"–ö–∏—Ç–∞–π, –§—É—Ü–∑—è–Ω—å (–§—É–¥–∏–Ω)", en:"China, Fujian (Fuding)"},
      profile:{ru:"–¶–≤–µ—Ç—ã, –º—ë–¥, —Å–≤–µ–∂–∏–µ —Ç—Ä–∞–≤—ã", en:"Floral, honeyed, fresh herbs"},
      texture:{ru:"–õ—ë–≥–∫–∏–π –Ω–∞—Å—Ç–æ–π", en:"Light liquor"},
      effect:{ru:"–ú—è–≥–∫–∞—è —è—Å–Ω–æ—Å—Ç—å, –ª—ë–≥–∫–æ—Å—Ç—å", en:"Gentle clarity, lightness"},
      aging:{ru:"–ú–æ–∂–Ω–æ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å (–Ω–æ —á–∞—Å—Ç–æ –ø—å—é—Ç —Å–≤–µ–∂–∏–º)", en:"Can age (often enjoyed fresh)"},
      format:{ru:"–õ–∏—Å—Ç–æ–≤–æ–π", en:"Loose leaf"},
      storage:{ru:"–°—É—Ö–æ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ; –¥–ª—è –≤—ã–¥–µ—Ä–∂–∫–∏ ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è", en:"Dry, airtight; stable conditions if aging"},
    },
    agedWhite:{
      ferment:{ru:"–ë–µ–ª—ã–π —á–∞–π —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–¥–µ—Ä–∂–∫–æ–π", en:"White tea with natural aging"},
      process:{ru:"–ó–∞–≤—è–ª–∏–≤–∞–Ω–∏–µ/—Å—É—à–∫–∞ + –≤—ã–¥–µ—Ä–∂–∫–∞", en:"Wither/dry + aging"},
      material:{ru:"–ß–∞—â–µ —à–æ—É –º—ç–π/–±–∞–π –º—É –¥–∞–Ω—å (–ª–∏—Å—Ç—å—è –∫—Ä—É–ø–Ω–µ–µ)", en:"Often Shou Mei / Bai Mu Dan (larger leaf)"},
      region:{ru:"–ö–∏—Ç–∞–π, –§—É—Ü–∑—è–Ω—å", en:"China, Fujian"},
      profile:{ru:"–°—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –º—ë–¥, —Ç—ë–ø–ª—ã–µ —Ç—Ä–∞–≤—ã", en:"Dried fruit, honey, warm herbs"},
      texture:{ru:"–û–∫—Ä—É–≥–ª—ã–π, –º—è–≥–∫–∏–π –Ω–∞—Å—Ç–æ–π", en:"Round, gentle liquor"},
      effect:{ru:"–¢–∏—à–∏–Ω–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –º—è–≥–∫–æ–µ ¬´—É—Å–ø–æ–∫–æ–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã¬ª", en:"Quiet, recovery, gentle calm"},
      aging:{ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π", en:"Aged"},
      format:{ru:"–õ–∏—Å—Ç/–±—Ä–∏–∫–µ—Ç/–±–ª–∏–Ω (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä—Ç–∏–∏)", en:"Loose/brick/cake (varies)"},
      storage:{ru:"–°—É—Ö–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, stable, odor-free"},
    },
    shu:{
      ferment:{ru:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è (—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è)", en:"Post-fermented (accelerated)"},
      process:{ru:"–í–æ–¥—É–π, –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ (–∏–Ω–æ–≥–¥–∞), —Å—É—à–∫–∞", en:"Wo dui, (often) compression, drying"},
      material:{ru:"–Æ–Ω—å–Ω–∞–Ω—å—Å–∫–∏–π –∫—Ä—É–ø–Ω–æ–ª–∏—Å—Ç–æ–≤–æ–π (assamica), —Ä–∞–∑–Ω—ã–π —Å–±–æ—Ä", en:"Yunnan large-leaf (assamica), varied picking"},
      region:{ru:"–ö–∏—Ç–∞–π, –Æ–Ω—å–Ω–∞–Ω—å", en:"China, Yunnan"},
      profile:{ru:"–î—Ä–µ–≤–µ—Å–Ω–æ—Å—Ç—å, –æ—Ä–µ—Ö–∏, —à–æ–∫–æ–ª–∞–¥, –∑–µ–º–ª—è", en:"Woody, nutty, cocoa, earthy"},
      texture:{ru:"–ü–ª–æ—Ç–Ω—ã–π, –±–∞—Ä—Ö–∞—Ç–Ω—ã–π –Ω–∞—Å—Ç–æ–π", en:"Thick, velvety liquor"},
      effect:{ru:"–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ, —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω, ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å¬ª", en:"Grounding, steady baseline, composed feel"},
      aging:{ru:"–ß–∞—Å—Ç–æ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –æ—Ç –≤—ã–¥–µ—Ä–∂–∫–∏", en:"Often benefits from aging"},
      format:{ru:"–ë–ª–∏–Ω/—Ç–æ—á–∞/–∫–∏—Ä–ø–∏—á/—Ä–∞—Å—Å—ã–ø–Ω–æ–π", en:"Cake/tuo/brick/loose"},
      storage:{ru:"–°—É—Ö–æ, –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–µ–º–æ, –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, ventilated, away from strong odors"},
    },
    sheng:{
      ferment:{ru:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è (–≤—ã–¥–µ—Ä–∂–∫–∞)", en:"Naturally aged (post-fermentation over time)"},
      process:{ru:"–§–∏–∫—Å–∞—Ü–∏—è, —Å—É—à–∫–∞; –¥–∞–ª–µ–µ ‚Äî –≤—ã–¥–µ—Ä–∂–∫–∞", en:"Kill-green, drying; then aging"},
      material:{ru:"–Æ–Ω—å–Ω–∞–Ω—å—Å–∫–∏–π –∫—Ä—É–ø–Ω–æ–ª–∏—Å—Ç–æ–≤–æ–π (assamica)", en:"Yunnan large-leaf (assamica)"},
      region:{ru:"–ö–∏—Ç–∞–π, –Æ–Ω—å–Ω–∞–Ω—å (—Ä–∞–∑–Ω—ã–µ –≥–æ—Ä—ã)", en:"China, Yunnan (various mountains)"},
      profile:{ru:"–¢—Ä–∞–≤—ã/—Ñ—Ä—É–∫—Ç—ã, —è—Ä–∫–æ—Å—Ç—å, –∏–Ω–æ–≥–¥–∞ ¬´–æ—Å—Ç—Ä–∏–Ω–∫–∞¬ª", en:"Herbal/fruity, bright, sometimes sharp"},
      texture:{ru:"–û—Ç –ª—ë–≥–∫–æ–≥–æ –¥–æ –ø–ª–æ—Ç–Ω–æ–≥–æ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É)", en:"Light to dense (by age)"},
      effect:{ru:"–ß–∏—Å—Ç–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å (–¥–æ–∑–∏—Ä–æ–≤–∫–∞ –≤–∞–∂–Ω–∞)", en:"Clean energy and focus (dose matters)"},
      aging:{ru:"–ß–∞—Å—Ç–æ —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞", en:"Strongly age-dependent"},
      format:{ru:"–ë–ª–∏–Ω/—Ç–æ—á–∞/–∫–∏—Ä–ø–∏—á", en:"Cake/tuo/brick"},
      storage:{ru:"–°—Ç–∞–±–∏–ª—å–Ω–æ, —Å—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤; –¥–ª—è –≤—ã–¥–µ—Ä–∂–∫–∏ ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è", en:"Stable, dry, odor-free; careful conditions for aging"},
    },
    fuZhuan:{
      ferment:{ru:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—ç–π —á–∞", en:"Post-fermented hei cha"},
      process:{ru:"–ö–∏—Ä–ø–∏—á–Ω–æ–µ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ, —Å–æ–∑—Ä–µ–≤–∞–Ω–∏–µ", en:"Brick pressing, maturation"},
      material:{ru:"–õ–∏—Å—Ç —Å—Ä–µ–¥–Ω–µ–π –≥—Ä—É–±–æ—Å—Ç–∏", en:"Medium-coarse leaf"},
      region:{ru:"–ö–∏—Ç–∞–π (–•—É–Ω–∞–Ω—å/–®—ç–Ω—å—Å–∏ ‚Äî —Å—Ç–∏–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è)", en:"China (Hunan/Shaanxi styles vary)"},
      profile:{ru:"–•–ª–µ–±–Ω–æ—Å—Ç—å, –æ—Ä–µ—Ö–∏, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, —Ç—ë–ø–ª—ã–µ –Ω–æ—Ç—ã", en:"Bready, nutty, dried fruit, warm notes"},
      texture:{ru:"–†–æ–≤–Ω—ã–π, –º—è–≥–∫–∏–π –Ω–∞—Å—Ç–æ–π", en:"Even, soft liquor"},
      effect:{ru:"–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–Ω", en:"Stability, calm baseline"},
      aging:{ru:"–•–æ—Ä–æ—à–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –≤—ã–¥–µ—Ä–∂–∫—É", en:"Often ages well"},
      format:{ru:"–ö–∏—Ä–ø–∏—á/–ø–ª–∏—Ç–∫–∞", en:"Brick"},
      storage:{ru:"–°—É—Ö–æ, –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, ventilated, odor-free"},
    },
    liuBao:{
      ferment:{ru:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—ç–π —á–∞", en:"Post-fermented hei cha"},
      process:{ru:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è/—Å–æ–∑—Ä–µ–≤–∞–Ω–∏–µ, –∏–Ω–æ–≥–¥–∞ –∫–æ—Ä–∑–∏–Ω—ã", en:"Traditional fermentation/maturation, often basket storage"},
      material:{ru:"–õ–∏—Å—Ç —Å—Ä–µ–¥–Ω–µ–π –≥—Ä—É–±–æ—Å—Ç–∏", en:"Medium-coarse leaf"},
      region:{ru:"–ö–∏—Ç–∞–π, –ì—É–∞–Ω—Å–∏ (–£—á–∂–æ—É/–¶–∞–Ω—ä—É)", en:"China, Guangxi (Wuzhou/Cangwu)"},
      profile:{ru:"–¢—ë–ø–ª—ã–π –ª–µ—Å, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –∫–∞–º—Ñ–æ—Ä–∞ (–≤ –≤—ã–¥–µ—Ä–∂–∫–µ)", en:"Warm woody, dried fruit, camphor (aged)"},
      texture:{ru:"–†–æ–≤–Ω—ã–π –Ω–∞—Å—Ç–æ–π", en:"Even liquor"},
      effect:{ru:"–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –µ–¥—ã, ¬´—Å–æ–±—Ä–∞—Ç—å –≥–æ–ª–æ–≤—É¬ª", en:"Post-meal stability, steady focus"},
      aging:{ru:"–ß–∞—Å—Ç–æ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –æ—Ç –≤—ã–¥–µ—Ä–∂–∫–∏", en:"Often benefits from aging"},
      format:{ru:"–†–∞—Å—Å—ã–ø–Ω–æ–π/–∫–∏—Ä–ø–∏—á/–∫–æ—Ä–∑–∏–Ω—ã", en:"Loose/brick/basket"},
      storage:{ru:"–°—É—Ö–æ, —á–∏—Å—Ç–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, clean, odor-free"},
    },
    chaTou:{
      ferment:{ru:"–ü–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—ç—Ä (–ø–ª–æ—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)", en:"Post-fermented pu-erh nuggets"},
      process:{ru:"–§—Ä–∞–≥–º–µ–Ω—Ç—ã/¬´–∫–∞–º—É—à–∫–∏¬ª, –º–Ω–æ–≥–æ –ø—Ä–æ–ª–∏–≤–æ–≤", en:"Nuggets, many infusions"},
      material:{ru:"–Æ–Ω—å–Ω–∞–Ω—å—Å–∫–∏–π –∫—Ä—É–ø–Ω–æ–ª–∏—Å—Ç–æ–≤–æ–π", en:"Yunnan large-leaf"},
      region:{ru:"–ö–∏—Ç–∞–π, –Æ–Ω—å–Ω–∞–Ω—å", en:"China, Yunnan"},
      profile:{ru:"–û—Ä–µ—Ö–∏, –∫–∞–∫–∞–æ, —Ç—ë–ø–ª–∞—è –¥—Ä–µ–≤–µ—Å–Ω–æ—Å—Ç—å", en:"Nutty, cocoa, warm wood"},
      texture:{ru:"–ü–ª–æ—Ç–Ω—ã–π –∏ –º—è–≥–∫–∏–π –Ω–∞—Å—Ç–æ–π", en:"Thick, gentle liquor"},
      effect:{ru:"–ú—è–≥–∫–æ–µ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", en:"Gentle calm and steadiness"},
      aging:{ru:"–ß–∞—Å—Ç–æ —É–∂–µ ¬´–æ–∫—Ä—É–≥–ª—ë–Ω¬ª –ø–æ –≤–∫—É—Å—É", en:"Often already rounded"},
      format:{ru:"¬´–ö–∞–º—É—à–∫–∏¬ª", en:"Nuggets"},
      storage:{ru:"–°—É—Ö–æ, –±–µ–∑ –∑–∞–ø–∞—Ö–æ–≤", en:"Dry, odor-free"},
    }
  };
  TEA_CLASS.yancha = TEA_CLASS.darkOolong;

  // IMPORTANT: Short, ‚Äúsafe‚Äù descriptions
  const TEA_META = {
    shu: {
      firstMention:{ ru:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´—à—É¬ª –æ—Ñ–æ—Ä–º–∏–ª–∞—Å—å –≤ –∫–æ–Ω—Ü–µ XX –≤–µ–∫–∞ (—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è).", en:"Shu formed as a distinct category in the late 20th century (accelerated fermentation)." },
      geography:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π (–ø—É—ç—Ä–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã).", en:"Yunnan, China (pu-erh regions)." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~800‚Äì2000 –º (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—ã—Ä—å—è).", en:"Often ~800‚Äì2000 m depending on leaf origin." },
      facts:{ ru:["–ö—Ä–µ–ø–∫–∞—è –∑–∞–≤–∞—Ä–∫–∞ –º–æ–∂–µ—Ç –∑–∞–º–µ—Ç–Ω–æ –±–æ–¥—Ä–∏—Ç—å.","–ü—Ä–æ—Ñ–∏–ª—å —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ ¬´–∑–∞–∑–µ–º–ª—è—é—â–∏–π¬ª.","–ù–æ—Ç—ã: –¥—Ä–µ–≤–µ—Å–Ω–æ-–æ—Ä–µ—Ö–æ–≤—ã–µ, —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ, –∑–µ–º–ª–∏—Å—Ç—ã–µ."],
             en:["Brewed strong it can be quite energizing.","Often described as grounding.","Notes: woody/nutty, cocoa-like, earthy."] }
    },
    chaTou: {
      firstMention:{ ru:"¬´–ß–∞ —Ç–æ—É¬ª ‚Äî –ø–ª–æ—Ç–Ω—ã–µ ¬´–∫–∞–º—É—à–∫–∏¬ª –∏–∑ –ø—É—ç—Ä–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞.", en:"Cha tou are dense pu-erh ‚Äúnuggets‚Äù." },
      geography:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π.", en:"Yunnan, China." },
      altitude:{ ru:"–ö–∞–∫ –∏ —É –ø—É—ç—Ä–∞: —á–∞—Å—Ç–æ ~800‚Äì2000 –º.", en:"Similar to pu-erh: often ~800‚Äì2000 m." },
      facts:{ ru:["–î–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ø—Ä–æ–ª–∏–≤–æ–≤.","–£–¥–æ–±–Ω–æ –≤ –¥–æ—Ä–æ–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.","–ú—è–≥—á–µ, –µ—Å–ª–∏ –Ω–µ –∑–∞–≤—ã—à–∞—Ç—å –¥–æ–∑–∏—Ä–æ–≤–∫—É."],
             en:["Handles many infusions.","Travel-friendly.","Gentler when not overdosed."] }
    },
    liuBao: {
      firstMention:{ ru:"–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ö—ç–π —á–∞ –∏–∑ –ì—É–∞–Ω—Å–∏.", en:"A historically known Guangxi hei cha." },
      geography:{ ru:"–ì—É–∞–Ω—Å–∏, –ö–∏—Ç–∞–π (–£—á–∂–æ—É/–¶–∞–Ω—ä—É).", en:"Guangxi, China (Wuzhou/Cangwu)." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~200‚Äì1200 –º.", en:"Often ~200‚Äì1200 m." },
      facts:{ ru:["–õ—é–±—è—Ç –ø–æ—Å–ª–µ –µ–¥—ã.","–í—ã–¥–µ—Ä–∂–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É.","–ú–æ–∂–µ—Ç –ø—Ä–æ—è–≤–ª—è—Ç—å—Å—è –∫–∞–º—Ñ–æ—Ä–Ω–æ—Å—Ç—å/—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã."],
             en:["Often enjoyed after food.","Aging can add depth.","May show camphor/dried-fruit notes."] }
    },
    fuZhuan: {
      firstMention:{ ru:"–§—É –ß–∂—É–∞–Ω—å ‚Äî —Ç—Ä–∞–¥–∏—Ü–∏—è –∫–∏—Ä–ø–∏—á–Ω—ã—Ö —Ö—ç–π —á–∞.", en:"Fu Zhuan is a traditional brick-style hei cha." },
      geography:{ ru:"–•—É–Ω–∞–Ω—å/–®—ç–Ω—å—Å–∏ (—Å—Ç–∏–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è).", en:"Hunan/Shaanxi (styles vary)." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~300‚Äì1500 –º.", en:"Often ~300‚Äì1500 m." },
      facts:{ ru:["–ß–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –æ—á–µ–Ω—å —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω.","–•–æ—Ä–æ—à–æ –∏–¥—ë—Ç –ª—ë–≥–∫–æ–π –∫—Ä–µ–ø–æ—Å—Ç—å—é.","–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π."],
             en:["Often feels very even.","Nice brewed lightly.","Traditional features vary by batch."] }
    },
    agedWhite: {
      firstMention:{ ru:"–í—ã–¥–µ—Ä–∂–∏–≤–∞–Ω–∏–µ –±–µ–ª–æ–≥–æ —á–∞—è —Å—Ç–∞–ª–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è.", en:"Aging white tea became especially popular in recent decades." },
      geography:{ ru:"–§—É—Ü–∑—è–Ω—å, –ö–∏—Ç–∞–π.", en:"Fujian, China." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~200‚Äì1200 –º.", en:"Often ~200‚Äì1200 m." },
      facts:{ ru:["–° –≤–æ–∑—Ä–∞—Å—Ç–æ–º —Å–º–µ—â–∞–µ—Ç—Å—è –≤ –º—ë–¥/—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã/—Ç—ë–ø–ª—ã–µ —Ç—Ä–∞–≤—ã.","–ú–Ω–æ–≥–∏–µ –ª—é–±—è—Ç –≤–µ—á–µ—Ä–æ–º, –µ—Å–ª–∏ –Ω–µ –∫—Ä–µ–ø–∫–æ.","–í–∫—É—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–∫—Ä—É–≥–ª–µ–µ."],
             en:["With age shifts toward honey/dried fruit/warm herbs.","Often enjoyed in the evening if light.","Taste becomes rounder."] }
    },
    white: {
      firstMention:{ ru:"–ë–µ–ª—ã–µ —á–∞–∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ —Å–≤—è–∑—ã–≤–∞—é—Ç —Å –§—É—Ü–∑—è–Ω–æ–º.", en:"White teas are strongly associated with Fujian." },
      geography:{ ru:"–§—É—Ü–∑—è–Ω—å, –ö–∏—Ç–∞–π.", en:"Fujian, China." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~200‚Äì1200 –º.", en:"Often ~200‚Äì1200 m." },
      facts:{ ru:["–õ–µ–≥–∫–æ ¬´–ø–µ—Ä–µ–∫–∞–ª–∏—Ç—å¬ª ‚Äî –ª—É—á—à–µ —É–º–µ—Ä–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞.","–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤–æ–¥–µ.","–ë–∞–π –ú—É –î–∞–Ω—å –ø–ª–æ—Ç–Ω–µ–µ, —á–µ–º ¬´–ò–Ω—å –ß–∂—ç–Ω—å¬ª."],
             en:["Easy to overheat‚Äîuse moderate temps.","Sensitive to water.","Bai Mu Dan is fuller than Silver Needle."] }
    },
    hongCha: {
      firstMention:{ ru:"–ö—Ä–∞—Å–Ω—ã–µ —á–∞–∏ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–ª–∏—Å—å —Å —Ä–æ—Å—Ç–æ–º —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–æ—Å—Ç–∞–≤–æ–∫.", en:"Red/black teas grew alongside trade expansion." },
      geography:{ ru:"–ö–∏—Ç–∞–π (–º–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π).", en:"China (many regional styles)." },
      altitude:{ ru:"–û—á–µ–Ω—å –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ: ~200‚Äì2000 –º.", en:"Very variable: ~200‚Äì2000 m." },
      facts:{ ru:["¬´–¢—ë–ø–ª–∞—è –±–æ–¥—Ä–æ—Å—Ç—å¬ª –±–µ–∑ —Ä–µ–∑–∫–æ–π –Ω–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç–∏ (—á–∞—Å—Ç–æ).","–ù–æ—Ç—ã: –∫–∞—Ä–∞–º–µ–ª—å/—Ö–ª–µ–±/–∫–∞–∫–∞–æ/—Å–ø–µ—Ü–∏–∏.","–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã –∑–∞–º–µ—Ç–Ω–æ –º–µ–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å."],
             en:["Often ‚Äòwarm energy‚Äô without sharp jitteriness.","Notes: caramel/bread/cocoa/spice.","Water temperature changes profile a lot."] }
    },
    green: {
      firstMention:{ ru:"–ó–µ–ª—ë–Ω—ã–π —á–∞–π ‚Äî –æ—á–µ–Ω—å –¥—Ä–µ–≤–Ω—è—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è.", en:"Green tea is a very old category." },
      geography:{ ru:"–ö–∏—Ç–∞–π (–ß–∂—ç—Ü–∑—è–Ω –∏ –¥—Ä.).", en:"China (Zhejiang etc.)." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~200‚Äì1500 –º.", en:"Often ~200‚Äì1500 m." },
      facts:{ ru:["–°–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–≤–µ–∂–µ—Å—Ç–∏.","–ü–µ—Ä–µ–¥–µ—Ä–∂–∫–∞ –¥–∞—ë—Ç –≥–æ—Ä–µ—á—å.","–£—Ç—Ä–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –∞–∫—Ç–∏–≤–∏—Ä—É—é—â–∏–º."],
             en:["Freshness matters a lot.","Oversteeping turns bitter.","Can be strongly activating in the morning."] }
    },
    lightOolong: {
      firstMention:{ ru:"–°–≤–µ—Ç–ª—ã–µ —É–ª—É–Ω—ã —à–∏—Ä–æ–∫–æ –∏–∑–≤–µ—Å—Ç–Ω—ã –≤ XIX‚ÄìXX –≤–≤.", en:"Light oolongs became widely known in the 19th‚Äì20th centuries." },
      geography:{ ru:"–§—É—Ü–∑—è–Ω—å (–ê–Ω—å—Å–∏) / –¢–∞–π–≤–∞–Ω—å (–≤ —Ü–µ–ª–æ–º).", en:"Fujian (Anxi) / Taiwan (broadly)." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~300‚Äì1800 –º.", en:"Often ~300‚Äì1800 m." },
      facts:{ ru:["–¶–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç –∏ ¬´–≤–æ–∑–≤—Ä–∞—Ç–Ω–∞—è —Å–ª–∞–¥–æ—Å—Ç—å¬ª.","–°–∏–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ –ø—Ä–æ–ª–∏–≤–∞–º.","–ö–æ–º—Ñ–æ—Ä—Ç–µ–Ω –¥–ª—è –¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è."],
             en:["Floral with lingering sweetness.","Evolves across infusions.","Comfortable for daytime socializing."] }
    },
    darkOolong: {
      firstMention:{ ru:"–£–∏—à–∞–Ω—å—Å–∫–∏–µ —É–ª—É–Ω—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏—Å—å —Ç—Ä–∞–¥–∏—Ü–∏–µ–π –≤–µ–∫–∞–º–∏.", en:"Wuyi oolongs evolved over centuries." },
      geography:{ ru:"–§—É—Ü–∑—è–Ω—å, –£–∏—à–∞–Ω—å.", en:"Fujian, Wuyi." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~300‚Äì1200 –º.", en:"Often ~300‚Äì1200 m." },
      facts:{ ru:["–û–±–∂–∞—Ä–∫–∞ –∑–∞–¥–∞—ë—Ç ¬´–≥–ª—É–±–∏–Ω—É¬ª.","–õ—é–±–∏—Ç –∫–∏–ø—è—Ç–æ–∫ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã.","–í –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä –ª—É—á—à–µ —Å–Ω–∏–∂–∞—Ç—å –¥–æ–∑—É."],
             en:["Roast sets depth.","Likes boiling water and short infusions.","Reduce dose late in the day."] }
    },
    sheng: {
      firstMention:{ ru:"–®—ç–Ω –ø—É—ç—Ä ‚Äî —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –ø—É—ç—Ä–∞; –≤—ã–¥–µ—Ä–∂–∫–∞ —Å–∏–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å.", en:"Sheng is the traditional pu-erh form; aging changes it a lot." },
      geography:{ ru:"–Æ–Ω—å–Ω–∞–Ω—å, –ö–∏—Ç–∞–π.", en:"Yunnan, China." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~800‚Äì2200 –º.", en:"Often ~800‚Äì2200 m." },
      facts:{ ru:["–ü—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –≤–∞–∂–Ω–∞ –¥–æ–∑–∏—Ä–æ–≤–∫–∞.","–í—ã–¥–µ—Ä–∂–∫–∞ —Å–º—è–≥—á–∞–µ—Ç —É–≥–ª—ã.","–ü–µ—Ä–≤—ã–µ –ø—Ä–æ–ª–∏–≤—ã ‚Äî —Å–∞–º—ã–µ —è—Ä–∫–∏–µ."],
             en:["Dose matters if anxious.","Aging rounds edges.","Early infusions are the brightest."] }
    },
    yancha: {
      firstMention:{ ru:"¬´–Ø–Ω—å—á–∞¬ª ‚Äî ¬´—É—Ç—ë—Å–Ω—ã–µ —á–∞–∏¬ª –£–∏; —á–∞—Å—Ç–æ –æ–ø–∏—Å—ã–≤–∞—é—Ç ¬´–º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ—Å—Ç—å¬ª.", en:"Yancha are Wuyi rock teas, often described as mineral." },
      geography:{ ru:"–§—É—Ü–∑—è–Ω—å, –£–∏—à–∞–Ω—å.", en:"Fujian, Wuyi." },
      altitude:{ ru:"–ß–∞—Å—Ç–æ ~300‚Äì1200 –º.", en:"Often ~300‚Äì1200 m." },
      facts:{ ru:["–°–∏–ª—å–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤–æ–¥–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–ª–∏–≤–∞.","–ú–Ω–æ–≥–∏–º –¥–∞—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω–Ω–æ–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.","–ß–∞—Å—Ç–æ –ª—é–±—è—Ç –∑–∞ –≥–ª—É–±–∏–Ω—É –ø–æ—Å–ª–µ–≤–∫—É—Å–∏—è."],
             en:["Sensitive to water and timing.","Often linked to collected attentiveness.","Loved for deep aftertaste."] }
    }
  };

  // Tea details: description + pills (states it "gives" and "recommended when")
  const TEA_DETAILS = {
    shu: { desc:{ru:"–ü–ª–æ—Ç–Ω—ã–π —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—ç—Ä: —á–∞—Å—Ç–æ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ä–æ–≤–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç¬ª –∏ –º—è–≥–∫–∞—è —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –±–æ–¥—Ä–∏—Ç—å, –µ—Å–ª–∏ –∑–∞–≤–∞—Ä–∏—Ç—å –∫—Ä–µ–ø–∫–æ.", en:"A fully fermented pu-erh that often feels like a steady base with calm composure. Can be energizing if brewed strong."}, gives:["good5","good9","good13","good16"], when:["bad1","bad2","bad9","bad10","bad12"] },
    chaTou:{ desc:{ru:"–ü—É—ç—Ä–Ω—ã–µ ¬´–∫–∞–º—É—à–∫–∏¬ª: –æ–±—ã—á–Ω–æ –º—è–≥—á–µ –ø–æ –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, –¥–æ–ª–≥–æ –¥–µ—Ä–∂–∏—Ç —Ä–æ–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –•–æ—Ä–æ—à –¥–ª—è —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –≤–µ—á–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–µ –∫—Ä–µ–ø–∏—Ç—å).", en:"Pu-erh nuggets: often gentler and long-lasting. Great for evening (brew light)."}, gives:["good3","good9","good15","good19","good20"], when:["bad4","bad12","bad13","bad20"] },
    liuBao:{ desc:{ru:"–•—ç–π —á–∞ –∏–∑ –ì—É–∞–Ω—Å–∏: —Ç—ë–ø–ª—ã–π, —É—Å—Ç–æ–π—á–∏–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –ø–æ—Å–ª–µ –µ–¥—ã –∏ –¥–ª—è ¬´—Å–æ–±—Ä–∞—Ç—å –≥–æ–ª–æ–≤—É –±–µ–∑ —Ä—ã–≤–∫–∞¬ª.", en:"Hei cha from Guangxi: warm, steady. Often chosen after food and for stable focus."}, gives:["good5","good7","good9","good16"], when:["bad1","bad2","bad9","bad17","bad10"] },
    fuZhuan:{ desc:{ru:"–•—ç–π —á–∞ –∫–∏—Ä–ø–∏—á: —Ä–æ–≤–Ω–æ–µ, –º—è–≥–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–Ω –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.", en:"Brick-style hei cha for a smooth, steady background and long stability."}, gives:["good5","good7","good16","good18"], when:["bad9","bad17","bad2","bad1"] },
    agedWhite:{ desc:{ru:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –±–µ–ª—ã–π: –º—è–≥–∫–æ —Å–Ω–∏–∂–∞–µ—Ç —Å—É–µ—Ç—É, —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ —Ç—ë–ø–ª–∞—è —Ç–∏—à–∏–Ω–∞ –±–µ–∑ —Ç—è–∂–µ—Å—Ç–∏.", en:"Aged white: often reduces mental noise and feels gently quiet without heaviness."}, gives:["good3","good12","good15","good19","good20"], when:["bad3","bad4","bad11","bad12","bad20"] },
    white:{ desc:{ru:"–ë–µ–ª—ã–π (–ë–∞–π –ú—É –î–∞–Ω—å): –¥–µ–ª–∏–∫–∞—Ç–Ω—ã–π, —á–∞—Å—Ç–æ –¥–∞—ë—Ç –º—è–≥–∫—É—é —è—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è.", en:"White tea (Bai Mu Dan): delicate, often a gentle lift and clarity without pressure."}, gives:["good10","good2","good7","good4"], when:["bad11","bad18","bad19"] },
    hongCha:{ desc:{ru:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π: ¬´—Ç—ë–ø–ª–∞—è –±–æ–¥—Ä–æ—Å—Ç—å¬ª –∏ —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ —Ä–µ–∑–∫–æ–≥–æ —Å–∫–∞—á–∫–∞.", en:"Black tea (hong cha): warm energy and composed focus without a sharp spike."}, gives:["good4","good11","good13","good1"], when:["bad7","bad14","bad15","bad16","bad10"] },
    green:{ desc:{ru:"–ó–µ–ª—ë–Ω—ã–π: —è—Ä–∫–∞—è —è—Å–Ω–æ—Å—Ç—å –∏ –±–æ–¥—Ä–æ—Å—Ç—å. –•–æ—Ä–æ—à —É—Ç—Ä–æ–º, –Ω–æ –ø—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∞–∫—Ç–∏–≤–Ω—ã–º.", en:"Green tea: bright clarity and energy. Great in the morning; can be too activating if anxious."}, gives:["good2","good12","good8","good4"], when:["bad5","bad6","bad7","bad15"] },
    lightOolong:{ desc:{ru:"–°–≤–µ—Ç–ª—ã–π —É–ª—É–Ω: —É–ª—É—á—à–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –¥–∞—ë—Ç –ª—ë–≥–∫—É—é —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å. –ö–æ–º—Ñ–æ—Ä—Ç–µ–Ω –¥–ª—è –¥–Ω–µ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.", en:"Light oolong: mood lift and light composure‚Äîcomfortable for daytime work."}, gives:["good6","good7","good13","good4"], when:["bad6","bad18","bad8","bad15"] },
    darkOolong:{ desc:{ru:"–¢—ë–º–Ω—ã–π —É–ª—É–Ω: –≥–ª—É–±–∏–Ω–∞ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è, ¬´–ø–ª–æ—Ç–Ω—ã–π¬ª —Ñ–æ–∫—É—Å. –í–µ—á–µ—Ä–æ–º ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å –∫—Ä–µ–ø–æ—Å—Ç—å—é.", en:"Dark oolong: depth and concentration‚Äîdense focus. Be careful late evening (strength matters)."}, gives:["good1","good8","good14","good11"], when:["bad8","bad14","bad15","bad2"] },
    sheng:{ desc:{ru:"–®—ç–Ω –ø—É—ç—Ä: —á–∏—Å—Ç–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ —Ñ–æ–∫—É—Å, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å ¬´–æ—Å—Ç—Ä—ã–º¬ª –¥–ª—è —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö. –õ—É—á—à–µ –¥–æ 14:00.", en:"Sheng pu-erh: clean energy and focus, can feel sharp if anxious. Best before 2pm."}, gives:["good2","good1","good4","good14"], when:["bad5","bad6","bad7","bad16"] },
    yancha:{ desc:{ru:"–Ø–Ω—å—á–∞: —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –∏ –≥–ª—É–±–æ–∫–∞—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ ¬´–≤–∫–ª—é—á–∏—Ç—å –º–æ–∑–≥¬ª –∏ –¥–µ—Ä–∂–∞—Ç—å –ª–∏–Ω–∏—é.", en:"Yancha: composed focus and deep attentiveness‚Äîoften chosen for sustained ‚Äúbrain on‚Äù work."}, gives:["good1","good8","good13","good14"], when:["bad8","bad14","bad2","bad16"] }
  };

  // =========================
  // State texts (20 + 20)
  // =========================
  const STATE_TEXT = {
    bad1:{ru:"–§–∏–∑–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å",en:"Physical fatigue"},
    bad2:{ru:"–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å",en:"Mental overload"},
    bad3:{ru:"–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",en:"Irritability"},
    bad4:{ru:"–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å",en:"Anxiety"},
    bad5:{ru:"–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å —É—Ç—Ä–æ–º",en:"Morning sleepiness"},
    bad6:{ru:"–¢—É–º–∞–Ω –≤ –≥–æ–ª–æ–≤–µ",en:"Brain fog"},
    bad7:{ru:"–í—è–ª–æ—Å—Ç—å –∏ –∏–Ω–µ—Ä—Ç–Ω–æ—Å—Ç—å",en:"Sluggishness"},
    bad8:{ru:"–†–∞—Å—Ñ–æ–∫—É—Å",en:"Lack of focus"},
    bad9:{ru:"–ü–µ—Ä–µ–µ–¥–∞–Ω–∏–µ / —Ç—è–∂–µ—Å—Ç—å",en:"Overeating / heaviness"},
    bad10:{ru:"–•–æ–ª–æ–¥ –≤ —Ç–µ–ª–µ",en:"Feeling cold"},
    bad11:{ru:"–ü–µ—Ä–µ–≥—Ä–µ–≤ / ‚Äú–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∂–∞—Ä‚Äù",en:"Overheated / ‚Äúinner heat‚Äù"},
    bad12:{ru:"–°—É–µ—Ç–∞ –≤ –≥–æ–ª–æ–≤–µ",en:"Mind racing"},
    bad13:{ru:"–ù–µ—Ä–≤–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",en:"Nervous tension"},
    bad14:{ru:"–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è",en:"Procrastination"},
    bad15:{ru:"–ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω—ã–π —Å–ø–∞–¥",en:"Afternoon slump"},
    bad16:{ru:"–ù–∏–∑–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è",en:"Low motivation"},
    bad17:{ru:"–†–∞–∑–¥—É—Ç—ã–π –∂–∏–≤–æ—Ç",en:"Bloating"},
    bad18:{ru:"–ü–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",en:"Low mood"},
    bad19:{ru:"–£—Å—Ç–∞–ª–æ—Å—Ç—å –≥–ª–∞–∑/—ç–∫—Ä–∞–Ω—ã",en:"Eye strain (screens)"},
    bad20:{ru:"–ë–µ—Å—Å–æ–Ω–Ω–∞—è –≥–æ–ª–æ–≤–∞ –≤–µ—á–µ—Ä–æ–º",en:"Restless head at night"},

    good1:{ru:"–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω–æ—Å—Ç—å",en:"Concentration"},
    good2:{ru:"–Ø—Å–Ω–æ—Å—Ç—å",en:"Clarity"},
    good3:{ru:"–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ",en:"Calm"},
    good4:{ru:"–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å",en:"Gentle energy"},
    good5:{ru:"–¢—ë–ø–ª–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",en:"Warm steadiness"},
    good6:{ru:"–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫",en:"Creative flow"},
    good7:{ru:"–†–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",en:"Even mood"},
    good8:{ru:"–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",en:"Attentiveness"},
    good9:{ru:"–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ",en:"Grounding"},
    good10:{ru:"–õ—ë–≥–∫–æ—Å—Ç—å",en:"Lightness"},
    good11:{ru:"–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è",en:"Warm energy"},
    good12:{ru:"–ß–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞",en:"Clear head"},
    good13:{ru:"–°–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞",en:"Composed (no stress)"},
    good14:{ru:"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",en:"Confidence"},
    good15:{ru:"–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å",en:"Meditative mood"},
    good16:{ru:"–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å (—Å–ø–æ–∫–æ–π–Ω–∞—è)",en:"Steady endurance"},
    good17:{ru:"–ö–æ–º–º—É–Ω–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å",en:"Sociability"},
    good18:{ru:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",en:"Recovery"},
    good19:{ru:"–¢–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏",en:"Inner quiet"},
    good20:{ru:"–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–æ —Å–Ω—É",en:"Ready for sleep"},
  };
  function TState(id, lang){ return (STATE_TEXT[id] && STATE_TEXT[id][lang]) ? STATE_TEXT[id][lang] : id; }

  // =========================
  // Recommendations mapping
  // =========================
  const badStates = [
    {id:"bad1",  teas:[TEA.shu, TEA.liuBao, TEA.hongCha, TEA.agedWhite]},
    {id:"bad2",  teas:[TEA.shu, TEA.agedWhite, TEA.liuBao, TEA.darkOolong]},
    {id:"bad3",  teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"bad4",  teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"bad5",  teas:[TEA.green, TEA.sheng, TEA.lightOolong, TEA.hongCha]},
    {id:"bad6",  teas:[TEA.green, TEA.lightOolong, TEA.sheng, TEA.hongCha]},
    {id:"bad7",  teas:[TEA.hongCha, TEA.green, TEA.darkOolong, TEA.sheng]},
    {id:"bad8",  teas:[TEA.darkOolong, TEA.hongCha, TEA.shu, TEA.yancha]},
    {id:"bad9",  teas:[TEA.liuBao, TEA.fuZhuan, TEA.shu, TEA.darkOolong]},
    {id:"bad10", teas:[TEA.hongCha, TEA.shu, TEA.darkOolong, TEA.liuBao]},
    {id:"bad11", teas:[TEA.white, TEA.agedWhite, TEA.green, TEA.lightOolong]},
    {id:"bad12", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"bad13", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"bad14", teas:[TEA.hongCha, TEA.darkOolong, TEA.green, TEA.sheng]},
    {id:"bad15", teas:[TEA.darkOolong, TEA.hongCha, TEA.shu, TEA.liuBao]},
    {id:"bad16", teas:[TEA.hongCha, TEA.yancha, TEA.sheng, TEA.lightOolong]},
    {id:"bad17", teas:[TEA.liuBao, TEA.fuZhuan, TEA.shu, TEA.darkOolong]},
    {id:"bad18", teas:[TEA.lightOolong, TEA.hongCha, TEA.green, TEA.white]},
    {id:"bad19", teas:[TEA.agedWhite, TEA.white, TEA.liuBao, TEA.shu]},
    {id:"bad20", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
  ];
  const goodStates = [
    {id:"good1",  teas:[TEA.yancha, TEA.darkOolong, TEA.hongCha, TEA.shu]},
    {id:"good2",  teas:[TEA.green, TEA.sheng, TEA.lightOolong, TEA.white]},
    {id:"good3",  teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"good4",  teas:[TEA.hongCha, TEA.lightOolong, TEA.green, TEA.sheng]},
    {id:"good5",  teas:[TEA.shu, TEA.liuBao, TEA.fuZhuan, TEA.hongCha]},
    {id:"good6",  teas:[TEA.lightOolong, TEA.sheng, TEA.green, TEA.hongCha]},
    {id:"good7",  teas:[TEA.agedWhite, TEA.hongCha, TEA.liuBao, TEA.lightOolong]},
    {id:"good8",  teas:[TEA.darkOolong, TEA.yancha, TEA.hongCha, TEA.shu]},
    {id:"good9",  teas:[TEA.chaTou, TEA.shu, TEA.liuBao, TEA.fuZhuan]},
    {id:"good10", teas:[TEA.white, TEA.green, TEA.lightOolong, TEA.agedWhite]},
    {id:"good11", teas:[TEA.hongCha, TEA.darkOolong, TEA.shu, TEA.liuBao]},
    {id:"good12", teas:[TEA.green, TEA.sheng, TEA.white, TEA.lightOolong]},
    {id:"good13", teas:[TEA.hongCha, TEA.darkOolong, TEA.shu, TEA.agedWhite]},
    {id:"good14", teas:[TEA.yancha, TEA.darkOolong, TEA.hongCha, TEA.sheng]},
    {id:"good15", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.white]},
    {id:"good16", teas:[TEA.shu, TEA.liuBao, TEA.fuZhuan, TEA.hongCha]},
    {id:"good17", teas:[TEA.lightOolong, TEA.hongCha, TEA.green, TEA.white]},
    {id:"good18", teas:[TEA.agedWhite, TEA.chaTou, TEA.liuBao, TEA.shu]},
    {id:"good19", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
    {id:"good20", teas:[TEA.chaTou, TEA.agedWhite, TEA.liuBao, TEA.shu]},
  ];

  // Domain-specific state ‚Üí product mapping for Herbs
  const herbBadStates = [
    {id:"bad1",  teas:[HERB.ginseng, HERB.ginger, HERB.rosehip, HERB.sage]},
    {id:"bad2",  teas:[HERB.sage, HERB.ginseng, HERB.rosehip, HERB.mint]},
    {id:"bad3",  teas:[HERB.lemonBalm, HERB.chamomile, HERB.motherwort, HERB.mint]},
    {id:"bad4",  teas:[HERB.motherwort, HERB.lemonBalm, HERB.chamomile, HERB.mint]},
    {id:"bad5",  teas:[HERB.mint, HERB.sage, HERB.rosehip, HERB.ginger]},
    {id:"bad6",  teas:[HERB.rosehip, HERB.ginger, HERB.mint, HERB.sage]},
    {id:"bad7",  teas:[HERB.ginger, HERB.ginseng, HERB.rosehip, HERB.mint]},
    {id:"bad8",  teas:[HERB.rosehip, HERB.mint, HERB.sage, HERB.lemonBalm]},
    {id:"bad9",  teas:[HERB.mint, HERB.sage, HERB.lemonBalm, HERB.rosehip]},
    {id:"bad10", teas:[HERB.sage, HERB.mint, HERB.ginseng, HERB.rosehip]},
    {id:"bad11", teas:[HERB.lemonBalm, HERB.chamomile, HERB.mint, HERB.rosehip]},
    {id:"bad12", teas:[HERB.chamomile, HERB.lemonBalm, HERB.motherwort, HERB.mint]},
    {id:"bad13", teas:[HERB.rosehip, HERB.lemonBalm, HERB.chamomile, HERB.mint]},
    {id:"bad14", teas:[HERB.ginger, HERB.rosehip, HERB.ginseng, HERB.mint]},
    {id:"bad15", teas:[HERB.ginger, HERB.rosehip, HERB.mint, HERB.sage]},
    {id:"bad16", teas:[HERB.ginger, HERB.ginseng, HERB.rosehip, HERB.sage]},
    {id:"bad17", teas:[HERB.mint, HERB.lemonBalm, HERB.chamomile, HERB.rosehip]},
    {id:"bad18", teas:[HERB.mint, HERB.lemonBalm, HERB.chamomile, HERB.rosehip]},
    {id:"bad19", teas:[HERB.mint, HERB.lemonBalm, HERB.chamomile, HERB.rosehip]},
    {id:"bad20", teas:[HERB.chamomile, HERB.lemonBalm, HERB.motherwort, HERB.mint]},
  ];

  const herbGoodStates = [
    {id:"good1",  teas:[HERB.ginseng, HERB.ginger, HERB.sage, HERB.rosehip]},
    {id:"good2",  teas:[HERB.mint, HERB.sage, HERB.rosehip, HERB.ginger]},
    {id:"good3",  teas:[HERB.lemonBalm, HERB.chamomile, HERB.motherwort, HERB.mint]},
    {id:"good4",  teas:[HERB.ginger, HERB.rosehip, HERB.sage, HERB.ginseng]},
    {id:"good5",  teas:[HERB.rosehip, HERB.mint, HERB.sage, HERB.lemonBalm]},
    {id:"good6",  teas:[HERB.rosehip, HERB.ginger, HERB.mint, HERB.sage]},
    {id:"good7",  teas:[HERB.rosehip, HERB.mint, HERB.lemonBalm, HERB.sage]},
    {id:"good8",  teas:[HERB.rosehip, HERB.mint, HERB.sage, HERB.ginger]},
    {id:"good9",  teas:[HERB.sage, HERB.mint, HERB.rosehip, HERB.ginseng]},
    {id:"good10", teas:[HERB.mint, HERB.sage, HERB.rosehip, HERB.ginger]},
    {id:"good11", teas:[HERB.ginseng, HERB.ginger, HERB.rosehip, HERB.sage]},
    {id:"good12", teas:[HERB.lemonBalm, HERB.chamomile, HERB.motherwort, HERB.mint]},
    {id:"good13", teas:[HERB.ginseng, HERB.ginger, HERB.sage, HERB.rosehip]},
    {id:"good14", teas:[HERB.rosehip, HERB.mint, HERB.sage, HERB.ginger]},
    {id:"good15", teas:[HERB.lemonBalm, HERB.chamomile, HERB.motherwort, HERB.mint]},
    {id:"good16", teas:[HERB.rosehip, HERB.ginseng, HERB.ginger, HERB.sage]},
    {id:"good17", teas:[HERB.mint, HERB.rosehip, HERB.sage, HERB.ginger]},
    {id:"good18", teas:[HERB.rosehip, HERB.lemonBalm, HERB.chamomile, HERB.mint]},
    {id:"good19", teas:[HERB.lemonBalm, HERB.chamomile, HERB.motherwort, HERB.mint]},
    {id:"good20", teas:[HERB.chamomile, HERB.lemonBalm, HERB.motherwort, HERB.mint]},
  ];

  function getBadStates(){ return (domain==="herbs") ? herbBadStates : badStates; }
  function getGoodStates(){ return (domain==="herbs") ? herbGoodStates : goodStates; }

  function getCatalog(){ return (domain==="herbs") ? HERB : TEA; }
  function getDetails(){ return (domain==="herbs") ? HERB_DETAILS : TEA_DETAILS; }
  function getImgMap(){ return (domain==="herbs") ? HERB_IMG : TEA_IMG; }
  function getMeta(){ return (domain==="herbs") ? HERB_META : TEA_META; }
  function getClassMap(){ return (domain==="herbs") ? HERB_CLASS : TEA_CLASS; }
  function getBadById(){ return Object.fromEntries(getBadStates().map(s=>[s.id, s])); }
  function getGoodById(){ return Object.fromEntries(getGoodStates().map(s=>[s.id, s])); }

  // =========================
  // ‚ÄúAI‚Äù keyword matcher (local)
  // =========================
  const KEYWORDS = {
    bad: {
      bad1:  ["—É—Å—Ç–∞–ª", "—É—Å—Ç–∞–ª–æ—Å—Ç—å", "–≤—ã–º–æ—Ç", "—Ä–∞–∑–±–∏—Ç", "fatigue", "tired", "exhaust"],
      bad2:  ["–ø–µ—Ä–µ–≥—Ä—É–∑", "–ø–µ—Ä–µ–≥—Ä—É–∂", "—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ", "–º–Ω–æ–≥–æ –∑–∞–¥–∞—á", "overload", "overwhelmed"],
      bad3:  ["—Ä–∞–∑–¥—Ä–∞–∂", "–∑–ª—é—Å—å", "–±–µ—Å–∏—Ç", "irritab", "annoy", "angry"],
      bad4:  ["—Ç—Ä–µ–≤–æ–≥", "—Ç—Ä–µ–≤–æ–∂–Ω–æ", "–ø–∞–Ω–∏–∫", "anxiety", "anxious", "panic"],
      bad5:  ["—Å–æ–Ω–ª–∏–≤", "–∫–ª–æ–Ω–∏—Ç", "–Ω–µ –ø—Ä–æ—Å–Ω—É–ª", "sleepy", "drowsy", "morning"],
      bad6:  ["—Ç—É–º–∞–Ω", "–≤–∞—Ç–Ω–∞—è", "–Ω–µ —Å–æ–æ–±—Ä–∞–∂", "brain fog", "foggy", "cloudy head"],
      bad7:  ["–≤—è–ª", "–∏–Ω–µ—Ä—Ç", "–ª–µ–Ω", "sluggish", "lazy", "no energy"],
      bad8:  ["—Ä–∞—Å—Ñ–æ–∫—É—Å", "–Ω–µ –º–æ–≥—É —Å–æ—Å—Ä–µ–¥", "—Ä–∞–∑–±—Ä–æ—Å", "distract", "no focus"],
      bad9:  ["—Ç—è–∂–µ—Å—Ç—å", "–ø–µ—Ä–µ–µ–ª", "–ø–ª–æ—Ç–Ω–æ –ø–æ–µ–ª", "overeat", "heavy stomach"],
      bad10: ["—Ö–æ–ª–æ–¥–Ω–æ", "–∑—è–±–∫–æ", "–º–µ—Ä–∑–Ω—É", "cold", "chilly"],
      bad11: ["–∂–∞—Ä", "–ø–µ—Ä–µ–≥—Ä–µ–≤", "–≥–æ—Ä—è—á–æ", "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∂–∞—Ä", "hot", "overheated"],
      bad12: ["—Å—É–µ—Ç–∞", "–º—ã—Å–ª–∏ —Å–∫–∞—á—É—Ç", "–≥–æ–Ω—è–µ—Ç –º—ã—Å–ª–∏", "mind racing", "racing thoughts"],
      bad13: ["–Ω–∞–ø—Ä—è–∂", "–Ω–µ—Ä–≤—ã", "—Å—Ç—Ä–µ—Å—Å", "tension", "nervous", "stressed"],
      bad14: ["–ø—Ä–æ–∫—Ä–∞—Å—Ç", "–æ—Ç–∫–ª–∞–¥—ã", "–Ω–µ –º–æ–≥—É –Ω–∞—á–∞—Ç—å", "procrast", "delay"],
      bad15: ["–ø–æ—Å–ª–µ –æ–±–µ–¥–∞", "–ø–æ—Å–ª–µ–æ–±–µ–¥", "—Å–ø–∞–¥", "afternoon slump", "after lunch"],
      bad16: ["–Ω–µ—Ç –º–æ—Ç–∏–≤–∞", "–∞–ø–∞—Ç–∏—è", "–Ω–µ —Ö–æ—á—É", "low motivation", "no motivation"],
      bad17: ["–≤–∑–¥—É—Ç", "–∂–∏–≤–æ—Ç", "–≥–∞–∑", "bloat", "bloating"],
      bad18: ["–ø–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–≥—Ä—É—Å—Ç—å", "—É–Ω—ã–Ω–∏–µ", "low mood", "sad"],
      bad19: ["–≥–ª–∞–∑–∞", "—ç–∫—Ä–∞–Ω—ã", "–º–æ–Ω–∏—Ç–æ—Ä", "eye strain", "screen"],
      bad20: ["–Ω–µ —É—Å–Ω—É—Ç—å", "–±–µ—Å—Å–æ–Ω", "–≥–æ–ª–æ–≤–∞ –Ω–µ –≤—ã–∫–ª—é—á", "insomnia", "cant sleep", "restless night"],
    },
    good: {
      good1:  ["—Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á", "—Ñ–æ–∫—É—Å", "concentration", "focus"],
      good2:  ["—è—Å–Ω–æ—Å—Ç—å", "—á–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞", "clarity", "clear"],
      good3:  ["—Å–ø–æ–∫–æ–π", "calm", "relax"],
      good4:  ["–±–æ–¥—Ä", "—ç–Ω–µ—Ä–≥", "gentle energy", "energized"],
      good5:  ["—É—Å—Ç–æ–π—á–∏–≤", "—Ä–æ–≤–Ω–æ", "steady", "grounded warm"],
      good6:  ["—Ç–≤–æ—Ä", "–∫—Ä–µ–∞—Ç–∏–≤", "flow", "creative"],
      good7:  ["—Ä–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–æ–≤–Ω–æ", "even mood", "balanced mood"],
      good8:  ["–≤–Ω–∏–º–∞—Ç–µ–ª—å", "–æ—Å–æ–∑–Ω–∞–Ω", "attentive", "mindful"],
      good9:  ["–∑–∞–∑–µ–º–ª", "ground", "grounding"],
      good10: ["–ª—ë–≥–∫–æ—Å—Ç—å", "–ª–µ–≥–∫–æ", "lightness", "light"],
      good11: ["—Ç—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è", "—Ç–µ–ø–ª–æ", "warm energy", "warmth"],
      good12: ["clear head", "—Å–æ–±—Ä–∞–Ω", "–±–µ–∑ —Ç—É–º–∞–Ω–∞"],
      good13: ["–±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞", "—Å–ø–æ–∫–æ–π–Ω—ã–π —Ñ–æ–∫—É—Å", "composed", "no stress"],
      good14: ["—É–≤–µ—Ä–µ–Ω", "confidence", "confident"],
      good15: ["–º–µ–¥–∏—Ç–∞—Ç–∏–≤", "—Ç–∏—à–∏–Ω–∞", "meditative", "zen"],
      good16: ["–≤—ã–Ω–æ—Å–ª–∏–≤", "–¥–æ–ª–≥–æ", "endurance", "stamina"],
      good17: ["–æ–±—â–∏—Ç–µ–ª", "–∫–æ–º–º—É–Ω–∏–∫–∞", "sociable", "social"],
      good18: ["–≤–æ—Å—Å—Ç–∞–Ω–æ–≤", "recovery", "recover"],
      good19: ["–≤–Ω—É—Ç—Ä–∏ —Ç–∏—Ö–æ", "—Ç–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏", "inner quiet", "quiet inside"],
      good20: ["–∫–æ —Å–Ω—É", "–∑–∞—Å–Ω—É—Ç—å", "ready for sleep", "sleep ready"],
    }
  };

  function scoreText(text, words){
    const t = text.toLowerCase();
    let s = 0;
    const hits = [];
    for(const w of words){
      if(t.includes(w.toLowerCase())){
        s += 1;
        hits.push(w);
      }
    }
    return {score:s, hits};
  }

  function analyzeFreeText(text){
    const t = (text || "").trim();
    const result = { bad: [], good: [] };
    if(!t) return result;

    const badScored = [];
    for(const id in KEYWORDS.bad){
      const r = scoreText(t, KEYWORDS.bad[id]);
      if(r.score > 0) badScored.push({id, score:r.score, hits:r.hits});
    }
    badScored.sort((a,b)=> b.score - a.score);

    const goodScored = [];
    for(const id in KEYWORDS.good){
      const r = scoreText(t, KEYWORDS.good[id]);
      if(r.score > 0) goodScored.push({id, score:r.score, hits:r.hits});
    }
    goodScored.sort((a,b)=> b.score - a.score);

    result.bad = badScored.slice(0,5);
    result.good = goodScored.slice(0,5);
    return result;
  }

  // =========================
  // Ozon link helper
  // =========================
  function ozonSearchUrl(q){
    return `https://www.ozon.ru/search/?text=${encodeURIComponent(q)}`;
  }

  // =========================
  // DOM
  // =========================
  const badCloud  = document.getElementById("badCloud");
  const goodCloud = document.getElementById("goodCloud");

  const rightCard = document.getElementById("rightCard");

  const cardTitle = document.getElementById("cardTitle");
  const cardChip  = document.getElementById("cardChip");
  const cardDesc  = document.getElementById("cardDesc");
  const teaList   = document.getElementById("teaList");

  const reasoningBox = document.getElementById("reasoningBox");
  const reasoningText = document.getElementById("reasoningText");
  const hideWhyBtn = document.getElementById("hideWhyBtn");

  const multiBlocks       = document.getElementById("multiBlocks");
  const selectedBadChips  = document.getElementById("selectedBadChips");
  const selectedGoodChips = document.getElementById("selectedGoodChips");

  const multiToggle = document.getElementById("multiToggle");
  const counterText = document.getElementById("counterText");

  const clearBadBtn  = document.getElementById("clearBadBtn");
  const clearGoodBtn = document.getElementById("clearGoodBtn");
  const clearAllBtn  = document.getElementById("clearAllBtn");

  const limitModal     = document.getElementById("limitModal");
  const closeLimitBtn  = document.getElementById("closeLimitBtn");

  const proModal = document.getElementById("proModal");
  const proModalNo = document.getElementById("proModalNo");
  const proModalYes = document.getElementById("proModalYes");
  const proModalCloseX = document.getElementById("proModalCloseX");
  const proModalBody = document.getElementById("uiProModalBody");
  const proModalActions = document.getElementById("proModalActions");

  const aboutLink = document.getElementById("aboutLink");
  const aboutModal = document.getElementById("aboutModal");
  const aboutCloseBtn = document.getElementById("aboutCloseBtn");

  const domainSelect = document.getElementById("domainSelect");
  const uiDomainLabel = document.getElementById("uiDomainLabel");

  
  const classifierSelect = document.getElementById("classifierSelect");
  const uiClassifierLabel = document.getElementById("uiClassifierLabel");
  const soonModal = document.getElementById("soonModal");
  const closeSoonBtn = document.getElementById("closeSoonBtn");
  const uiSoonTitle = document.getElementById("uiSoonTitle");
  const uiSoonBody = document.getElementById("uiSoonBody");

  const langSelect = document.getElementById("langSelect");
  const langFlag   = document.getElementById("langFlag");
  const themeBtn   = document.getElementById("themeBtn");

  const nlpInput = document.getElementById("nlpInput");
  const nlpBtn   = document.getElementById("nlpBtn");

  // mobile stepper
  const mStepTitle = document.getElementById("mStepTitle");
  const mStepHint  = document.getElementById("mStepHint");
  const mBackBtn   = document.getElementById("mBackBtn");
  const mNextBtn   = document.getElementById("mNextBtn");

  // tooltip
  const tip = document.getElementById("tip");

  // tea modal
  const teaModal = document.getElementById("teaModal");
  const teaModalCard = document.getElementById("teaModalCard");
  const teaModalBodyEl = document.getElementById("teaModalBody");
  const teaModalCloseBtn = document.getElementById("teaModalCloseBtn");
  const teaModalTitle = document.getElementById("teaModalTitle");
  const teaModalDesc = document.getElementById("teaModalDesc");
  const teaModalTag = document.getElementById("teaModalTag");
  const teaModalTagLine = document.getElementById("teaModalTagLine");
  const teaModalGivesMini = document.getElementById("teaModalGivesMini");
  const teaModalWhenMini = document.getElementById("teaModalWhenMini");

  const teaModalImg = document.getElementById("teaModalImg");
  const teaMoreBtn = document.getElementById("teaMoreBtn");
  let openTeaId = null;


  const teaModalOriginTitle = document.getElementById("teaModalOriginTitle");
  const teaModalOrigin = document.getElementById("teaModalOrigin");
  const teaModalFactsTitle = document.getElementById("teaModalFactsTitle");
  const teaModalFacts = document.getElementById("teaModalFacts");
  const teaModalGivesTitle = document.getElementById("teaModalGivesTitle");
  const teaModalWhenTitle = document.getElementById("teaModalWhenTitle");
  const teaModalBrewTitle = document.getElementById("teaModalBrewTitle");
  const teaModalGives = document.getElementById("teaModalGives");
  const teaModalWhen = document.getElementById("teaModalWhen");
  const teaModalBrew = document.getElementById("teaModalBrew");

  const teaModalClassTitle = document.getElementById("teaModalClassTitle");
  const teaModalClassGrid  = document.getElementById("teaModalClassGrid");

  // =========================
  // App state
  // =========================
  let lang = "ru";
  let domain = "tea";
  let classifier = "states";
  let multiMode = false;
  const selectedBad  = new Set();
  const selectedGood = new Set();
  let lastReasoning = "";
  let pendingEnablePro = false;

  // mobile step
  let mstep = 1;

  // =========================
  // Modals
  // =========================
  // We keep an `.open` class in sync with display state (needed for mobile tap/scroll behaviour).
  function openModal(el){
    el.style.display = "flex";
    el.classList.add("open");
    document.body.style.overflow = "hidden";
  }
  function closeModal(el){
    el.style.display = "none";
    el.classList.remove("open");
    document.body.style.overflow = "";
  }

  function openSoon(title, body){
    if(uiSoonTitle) uiSoonTitle.textContent = title || (UI[lang].soonTitle || "–°–∫–æ—Ä–æ");
    if(uiSoonBody) uiSoonBody.textContent = body || (UI[lang].soonBody || "");
    openModal(soonModal);
  }

  if(closeSoonBtn){
    closeSoonBtn.addEventListener("click", ()=> closeModal(soonModal));
  }
  if(soonModal){
    soonModal.addEventListener("click", (e)=>{ if(e.target === soonModal) closeModal(soonModal); });
  }


  closeLimitBtn.addEventListener("click", ()=>closeModal(limitModal));
  limitModal.addEventListener("click", (e)=>{ if(e.target === limitModal) closeModal(limitModal); });

  proModalCloseX.addEventListener("click", ()=>{ pendingEnablePro = false; closeModal(proModal); resetProModalContent(); });
  proModal.addEventListener("click", (e)=>{ if(e.target === proModal) { pendingEnablePro = false; closeModal(proModal); resetProModalContent(); } });

  
  // Tea modal helpers (reset state between openings and improve mobile behavior)
  function resetTeaModalState(){
    teaModalBodyEl.classList.remove("expanded");
    teaMoreBtn.textContent = UI[lang].more;
    teaMoreBtn.style.display = "";
    teaModal.querySelectorAll("details.accord[open]").forEach(d => { d.open = false; });
    teaModalBodyEl.scrollTop = 0;
  }

  function closeTeaModal(){
    closeModal(teaModal);
    openTeaId = null;
    resetTeaModalState();
  }

  function updateTeaMoreVisibility(){
    const txt = (teaModalDesc.textContent || "").trim();
    const shouldShow = txt.length > 150; // heuristic: short descriptions don't need expansion
    if(!shouldShow){
      teaMoreBtn.style.display = "none";
      teaModalBodyEl.classList.add("expanded"); // ensure no clamping is applied
    }else{
      teaMoreBtn.style.display = "inline-flex";
      teaModalBodyEl.classList.remove("expanded");
    }
    teaMoreBtn.textContent = UI[lang].more;
  }

  teaModalCloseBtn.addEventListener("click", closeTeaModal);
  teaModal.addEventListener("click", (e)=>{
    if (e.target === teaModal) closeTeaModal();
  });

  // Mobile: tap closes tea card only if there was no scroll/drag gesture
  (function(){
    const isMobile = ()=> window.matchMedia("(max-width: 640px)").matches;

    let startX = 0, startY = 0, startScroll = 0;
    let moved = false;
    let active = false;

    const isInteractive = (el)=> !!el.closest("button,a,input,select,textarea,summary,details");

    function getPoint(e){
      return (e.touches && e.touches[0]) ? e.touches[0] : e;
    }

    function onStart(e){
      if (!isMobile()) return;
      if (!teaModal.classList.contains("open")) return;

      const p = getPoint(e);
      startX = p.clientX;
      startY = p.clientY;
      startScroll = teaModalBodyEl.scrollTop;
      moved = false;
      active = true;
    }

    function onMove(e){
      if (!active) return;
      const p = getPoint(e);
      const dx = Math.abs(p.clientX - startX);
      const dy = Math.abs(p.clientY - startY);
      if (dx > 8 || dy > 8) moved = true;
    }

    function onEnd(e){
      if (!active) return;
      active = false;

      if (!isMobile()) return;
      if (!teaModal.classList.contains("open")) return;

      if (isInteractive(e.target)) return;

      const scrolled = Math.abs(teaModalBodyEl.scrollTop - startScroll) > 2;
      if (!moved && !scrolled){
        closeTeaModal();
      }
    }

    teaModalCard.addEventListener("touchstart", onStart, { passive: true });
    teaModalCard.addEventListener("touchmove", onMove, { passive: true });
    teaModalCard.addEventListener("touchend", onEnd);

    teaModalCard.addEventListener("pointerdown", onStart, { passive: true });
    teaModalCard.addEventListener("pointermove", onMove, { passive: true });
    teaModalCard.addEventListener("pointerup", onEnd);
  })();

// About modal
  aboutLink.addEventListener("click", ()=> openModal(aboutModal));
  aboutCloseBtn.addEventListener("click", ()=> closeModal(aboutModal));
  aboutModal.addEventListener("click", (e)=>{ if(e.target === aboutModal) closeModal(aboutModal); });

  // =========================
  // Helpers
  // =========================
  function teaName(tea){ return tea.name[lang] || tea.name.en || tea.name.ru; }
  function teaTag(tea){ return tea.tag[lang] || tea.tag.en || tea.tag.ru; }
  function teaBrew(tea){ return tea.brew[lang] || tea.brew.en || tea.brew.ru; }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }


  // Responsive helper
  function isMobile(){
    return window.matchMedia && window.matchMedia("(max-width: 980px)").matches;
  }


  function updateCounter(){
    counterText.textContent = UI[lang].counter(selectedBad.size, selectedGood.size);
  }

  function resetSingleView(){
    document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
    cardTitle.textContent = UI[lang].cardIdleTitle;
    cardDesc.textContent = UI[lang].cardDesc;
    teaList.innerHTML = "";
    // Herbs in PRO: show blend card (collection) for 1 liter
    if(domain==="herbs" && context && context.mode==="pro"){
      const blendCard = renderHerbBlendCard(items);
      if(blendCard) teaList.appendChild(blendCard);
    }
    hideReasoning();
  }

  function showReasoning(text){
    if(!text || !text.trim()){
      hideReasoning();
      return;
    }
    lastReasoning = text;
    reasoningText.innerHTML = text;
    reasoningBox.style.display = "block";
    hideWhyBtn.textContent = UI[lang].hide;
    document.getElementById("uiWhy").textContent = UI[lang].why;
  }
  function hideReasoning(){ reasoningBox.style.display = "none"; }
  hideWhyBtn.addEventListener("click", ()=> hideReasoning());

  // =========================
  // Tooltips: why tea affects state (tea-specific but generated)
  // =========================
  const TEA_TONE = {
    green:{ru:"—è—Ä–∫–∏–π –∏ —Å–≤–µ–∂–∏–π", en:"bright and fresh"},
    lightOolong:{ru:"—Ü–≤–µ—Ç–æ—á–Ω—ã–π –∏ –ª—ë–≥–∫–∏–π", en:"floral and light"},
    darkOolong:{ru:"–æ–±–∂–∞—Ä–µ–Ω–Ω—ã–π –∏ –≥–ª—É–±–æ–∫–∏–π", en:"roasted and deep"},
    yancha:{ru:"–º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π –∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–π", en:"mineral and collected"},
    hongCha:{ru:"—Ç—ë–ø–ª—ã–π –∏ –æ–∫—Ä—É–≥–ª—ã–π", en:"warm and rounded"},
    white:{ru:"–¥–µ–ª–∏–∫–∞—Ç–Ω—ã–π –∏ —á–∏—Å—Ç—ã–π", en:"delicate and clean"},
    agedWhite:{ru:"–º—è–≥–∫–∏–π –∏ —Å–ø–æ–∫–æ–π–Ω—ã–π", en:"soft and calming"},
    shu:{ru:"–ø–ª–æ—Ç–Ω—ã–π –∏ —Ä–æ–≤–Ω—ã–π", en:"thick and steady"},
    sheng:{ru:"—è—Ä–∫–∏–π –∏ –±–æ–¥—Ä—è—â–∏–π", en:"bright and energizing"},
    fuZhuan:{ru:"—Ä–æ–≤–Ω—ã–π –∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π", en:"even and long"},
    liuBao:{ru:"—Ç—ë–ø–ª—ã–π –∏ —É—Å—Ç–æ–π—á–∏–≤—ã–π", en:"warm and steady"},
    chaTou:{ru:"–º—è–≥–∫–∏–π –∏ –¥–æ–ª–≥–∏–π", en:"gentle and long"},
  };

  const STATE_REASON = {
    bad4:{ru:"—É–º–µ–Ω—å—à–∞–µ—Ç —Ä–µ–∑–∫—É—é —Å—Ç–∏–º—É–ª—è—Ü–∏—é –∏ –ø–æ–º–æ–≥–∞–µ—Ç ¬´—É—Å–ø–æ–∫–æ–∏—Ç—å –≥–æ–ª–æ–≤—É¬ª", en:"reduces sharp stimulation and helps calm the mind"},
    bad12:{ru:"—Å–Ω–∏–∂–∞–µ—Ç ¬´—Å–∫–∞—á–∫—É¬ª –º—ã—Å–ª–µ–π –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω", en:"reduces racing thoughts and adds an even baseline"},
    bad8:{ru:"—Å–æ–±–∏—Ä–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –ø–æ–º–æ–≥–∞–µ—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ª–∏–Ω–∏—é", en:"collects attention and helps sustain focus"},
    bad15:{ru:"–≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑ –ø–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω–æ–≥–æ —Å–ø–∞–¥–∞ –º—è–≥–∫–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π", en:"lifts an afternoon slump with gentle energy"},
    bad9:{ru:"–¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –µ–¥—ã –∏ ¬´—Å–æ–±–∏—Ä–∞–µ—Ç¬ª —Ç—è–∂–µ—Å—Ç—å", en:"feels comfortable after food and helps with heaviness"},
    bad10:{ru:"–¥–∞—ë—Ç —Ç—ë–ø–ª—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ ¬´—Å–æ–≥—Ä–µ–≤–∞–µ—Ç¬ª", en:"has a warm profile and can feel warming"},
    bad6:{ru:"–ø—Ä–æ—è—Å–Ω—è–µ—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´—Ç—É–º–∞–Ω–∞¬ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —è—Å–Ω–æ—Å—Ç—å", en:"clears the feeling of brain fog"},
    bad18:{ru:"–ø–æ–¥–Ω–∏–º–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω—É—Å –º—è–≥–∫–æ, –±–µ–∑ —Ä—ã–≤–∫–∞", en:"lifts mood gently without a spike"},
    bad20:{ru:"–ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω–∏–∑–∏—Ç—å ¬´—à—É–º¬ª –≤–µ—á–µ—Ä–æ–º, –µ—Å–ª–∏ –∑–∞–≤–∞—Ä–∏–≤–∞—Ç—å –ª–µ–≥–∫–æ", en:"can reduce evening mental noise if brewed lightly"},
    good1:{ru:"–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é", en:"supports concentration"},
    good2:{ru:"—É—Å–∏–ª–∏–≤–∞–µ—Ç —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—É—é —è—Å–Ω–æ—Å—Ç—å", en:"boosts perceived clarity"},
    good3:{ru:"–¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è", en:"brings a calm feel"},
    good4:{ru:"–¥–∞—ë—Ç –º—è–≥–∫—É—é –±–æ–¥—Ä–æ—Å—Ç—å –±–µ–∑ —Ä–µ–∑–∫–æ—Å—Ç–∏", en:"gives gentle energy"},
    good7:{ru:"–≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", en:"evens mood"},
    good9:{ru:"–¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´–∑–∞–∑–µ–º–ª–µ–Ω–∏—è¬ª", en:"gives a grounding feel"},
    good13:{ru:"–¥–∞—ë—Ç —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞", en:"gives composure without extra stress"},
    good20:{ru:"–ø–æ–º–æ–≥–∞–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–Ω–∞ –ø—Ä–∏ –ª—ë–≥–∫–æ–π –∫—Ä–µ–ø–æ—Å—Ç–∏", en:"helps transition toward sleep when brewed light"},
    good12:{ru:"–¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´—á–∏—Å—Ç–æ–π –≥–æ–ª–æ–≤—ã¬ª", en:"gives a clear-head feel"},
    good8:{ru:"—É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å", en:"boosts attentiveness"},
    good14:{ru:"–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω—É—é —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å", en:"supports confident composure"},
    good15:{ru:"—Å–æ–∑–¥–∞—ë—Ç –±–æ–ª–µ–µ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω", en:"creates a more meditative baseline"},
    good5:{ru:"–¥–∞—ë—Ç —Ç—ë–ø–ª—É—é —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", en:"gives warm steadiness"},
    good16:{ru:"–¥–∞—ë—Ç —Å–ø–æ–∫–æ–π–Ω—É—é –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", en:"gives steady endurance"},
    good18:{ru:"–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –º—è–≥–∫—É—é —Ä–∞–∑–≥—Ä—É–∑–∫—É", en:"supports recovery and gentle unloading"},
    good6:{ru:"—Ä–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤ –∏ –ª—ë–≥–∫–æ—Å—Ç—å –º—ã—Å–ª–∏", en:"unlocks creative flow"},
    good11:{ru:"–¥–∞—ë—Ç —Ç—ë–ø–ª—É—é —ç–Ω–µ—Ä–≥–∏—é", en:"gives warm energy"},
    good10:{ru:"–¥–∞—ë—Ç –ª—ë–≥–∫–æ—Å—Ç—å", en:"gives lightness"},
    bad1:{ru:"–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–æ–≤–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é", en:"supports recovery and steady energy"},
    bad2:{ru:"—Å–Ω–∏–∂–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∞ –∑–∞ —Å—á—ë—Ç –±–æ–ª–µ–µ —Ä–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è", en:"reduces overload via a steadier profile"},
    bad13:{ru:"—Å–Ω–∏–º–∞–µ—Ç –Ω–µ—Ä–≤–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏ ¬´—Å–æ–±–∏—Ä–∞–µ—Ç¬ª –¥—ã—Ö–∞–Ω–∏–µ", en:"eases nervous tension and steadies you"},
    bad17:{ru:"—á–∞—Å—Ç–æ –æ—â—É—â–∞–µ—Ç—Å—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –ø–æ—Å–ª–µ –µ–¥—ã –∏ –ø—Ä–∏ —Ç—è–∂–µ—Å—Ç–∏", en:"often feels better after meals and heaviness"},
    bad7:{ru:"–¥–∞—ë—Ç —ç–Ω–µ—Ä–≥–∏—é –∏ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã–π—Ç–∏ –∏–∑ –∏–Ω–µ—Ä—Ç–Ω–æ—Å—Ç–∏", en:"adds energy to counter sluggishness"},
    bad14:{ru:"–¥–∞—ë—Ç —Å—Ç–∞—Ä—Ç –∏ ¬´–≤–∫–ª—é—á–µ–Ω–∏–µ¬ª –±–µ–∑ —Ä—ã–≤–∫–∞", en:"helps start and switch on"},
    bad16:{ru:"–¥–∞—ë—Ç –∏–º–ø—É–ª—å—Å –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –º—è–≥–∫–æ", en:"gives a gentle motivation push"},
    bad3:{ru:"—Å–Ω–∏–∂–∞–µ—Ç —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –±–æ–ª–µ–µ –º—è–≥–∫–æ–≥–æ —Ñ–æ–Ω–∞", en:"may reduce irritability via a softer baseline"},
    bad11:{ru:"–æ—â—É—â–∞–µ—Ç—Å—è –ª–µ–≥—á–µ –∏ ¬´—Ö–æ–ª–æ–¥–Ω–µ–µ¬ª –ø–æ –ø—Ä–æ—Ñ–∏–ª—é", en:"often feels lighter/cooler in profile"},
    bad5:{ru:"–±–æ–¥—Ä–∏—Ç –∏ –ø—Ä–æ—è—Å–Ω—è–µ—Ç —É—Ç—Ä–æ–º", en:"energizes and clarifies in the morning"},
    bad19:{ru:"–¥–∞—ë—Ç –º—è–≥–∫—É—é —Ä–∞–∑–≥—Ä—É–∑–∫—É ¬´–≥–æ–ª–æ–≤—ã¬ª –ø–æ—Å–ª–µ —ç–∫—Ä–∞–Ω–æ–≤", en:"gives gentle head relief after screens"},
  };

  function teaWhy(teaKey, stateId, role){
    const tea = getCatalog()[teaKey];
    const tname = tea ? teaName(tea) : teaKey;
    const tone = TEA_TONE[teaKey]?.[lang] || TEA_TONE[teaKey]?.en || "";
    const stateName = TState(stateId, lang);
    const reason = STATE_REASON[stateId]?.[lang] || STATE_REASON[stateId]?.en || (lang==="ru" ? "—á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ç–∞–∫ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ" : "often feels that way subjectively");

    const verb = (role === "reduce")
      ? (lang==="ru" ? "–ø–æ–º–æ–≥–∞–µ—Ç —É–±—Ä–∞—Ç—å" : "may reduce")
      : (lang==="ru" ? "–ø–æ–º–æ–≥–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å" : "may evoke");

    if(lang==="ru"){
      return {
        title: `${tname} ‚Üí ${stateName}`,
        text: `–≠—Ç–æ—Ç —Å–æ—Ä—Ç –æ–±—ã—á–Ω–æ ${tone}. –ü–æ—ç—Ç–æ–º—É –æ–Ω ${verb} ¬´${stateName}¬ª: ${reason}.`
      };
    }
    return {
      title: `${tname} ‚Üí ${stateName}`,
      text: `This tea is usually ${tone}. So it ${verb} ‚Äú${stateName}‚Äù: ${reason}.`
    };
  }

  function showTipFor(el, clientX, clientY){
    const teaKey = el.dataset.teaKey;
    const stateId = el.dataset.stateId;
    const role = el.dataset.role; // reduce | evoke
    if(!teaKey || !stateId || !role) return;

    const w = teaWhy(teaKey, stateId, role);
    tip.innerHTML = `<div class="t1">${escapeHtml(w.title)}</div><div class="t2">${escapeHtml(w.text)}</div>`;
    tip.classList.add("show");
    tip.setAttribute("aria-hidden","false");

    const pad = 12;
    const rect = tip.getBoundingClientRect();
    const x = Math.min(window.innerWidth - rect.width - pad, Math.max(pad, clientX + 12));
    const y = Math.min(window.innerHeight - rect.height - pad, Math.max(pad, clientY + 12));
    tip.style.left = x + "px";
    tip.style.top  = y + "px";
  }
  function hideTip(){
    tip.classList.remove("show");
    tip.setAttribute("aria-hidden","true");
  }

  // Hover/focus tooltips (desktop)
  document.addEventListener("mousemove", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(!el) return;
    showTipFor(el, e.clientX, e.clientY);
  });
  document.addEventListener("mouseover", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(!el) hideTip();
  });
  document.addEventListener("mouseout", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(el) hideTip();
  });
  document.addEventListener("focusin", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(!el) return;
    const r = el.getBoundingClientRect();
    showTipFor(el, r.left + r.width/2, r.top);
  });
  document.addEventListener("focusout", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(el) hideTip();
  });

  // Tap tooltips (mobile): tap pill toggles tooltip; second tap hides
  let lastTapEl = null;
  document.addEventListener("click", (e)=>{
    const el = e.target.closest && e.target.closest("[data-tip='1']");
    if(!isMobile()){
      // on desktop, clicks elsewhere close tip
      if(!el) hideTip();
      return;
    }
    if(!el){
      hideTip();
      lastTapEl = null;
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    if(lastTapEl === el && tip.classList.contains("show")){
      hideTip();
      lastTapEl = null;
      return;
    }
    lastTapEl = el;
    const r = el.getBoundingClientRect();
    showTipFor(el, r.left + r.width/2, r.top + r.height/2);
  }, {capture:true});

  // =========================
  // Pills render helpers
  // =========================
  function renderPillsWithTea(target, ids, kind, teaKey, role){
    target.innerHTML = "";
    if(!ids || !ids.length){
      const s = document.createElement("span");
      s.className = "muted";
      s.textContent = "‚Äî";
      target.appendChild(s);
      return;
    }
    ids.forEach(id=>{
      const p = document.createElement("span");
      p.className = `pillState ${kind}`;
      p.textContent = TState(id, lang);
      // tooltip data
      p.dataset.tip = "1";
      p.dataset.teaKey = teaKey;
      p.dataset.stateId = id;
      p.dataset.role = role; // reduce|evoke
      p.tabIndex = 0;
      target.appendChild(p);
    });
  }

  function renderMiniPillsWithTea(target, ids, kind, teaKey, role){
    if(!target) return;
    renderPillsWithTea(target, (ids||[]).slice(0,3), kind, teaKey, role);
    target.querySelectorAll(".pillState").forEach(p=>p.classList.add("mini"));
  }



  function renderSelectedChips(){
    selectedBadChips.innerHTML = "";
    if(selectedBad.size === 0){
      const t = document.createElement("span");
      t.className = "muted";
      t.textContent = "‚Äî";
      selectedBadChips.appendChild(t);
    } else {
      [...selectedBad].forEach(id=>{
        const s = document.createElement("span");
        s.className = "stateChip bad";
        s.textContent = TState(id, lang);
        selectedBadChips.appendChild(s);
      });
    }

    selectedGoodChips.innerHTML = "";
    if(selectedGood.size === 0){
      const t = document.createElement("span");
      t.className = "muted";
      t.textContent = "‚Äî";
      selectedGoodChips.appendChild(t);
    } else {
      [...selectedGood].forEach(id=>{
        const s = document.createElement("span");
        s.className = "stateChip good";
        s.textContent = TState(id, lang);
        selectedGoodChips.appendChild(s);
      });
    }
  }

  function aggregateTeas(states){
    const score = new Map();
    states.forEach(st=>{
      st.teas.slice(0,4).forEach(t=>{
        const cur = score.get(t.key);
        if(cur) cur.count += 1;
        else score.set(t.key, {tea: t, count: 1});
      });
    });
    return [...score.values()].sort((a,b)=> (b.count - a.count) || teaName(a.tea).localeCompare(teaName(b.tea)));
  }

  async function renderTeaList(items, context){
    // context: {mode:"single"|"pro", focusStateId?:string, focusType?: "bad"|"good"}
    teaList.innerHTML = "";
    // Herbs in PRO: show blend card (collection) for 1 liter
    if(domain==="herbs" && context && context.mode==="pro"){
      const blendCard = renderHerbBlendCard(items);
      if(blendCard) teaList.appendChild(blendCard);
    }
    for(const it of items){
      const tea = it.tea;
      const count = it.count;
      const url = ozonSearchUrl(tea.q);
      const det = (getDetails()[tea.key] || {gives:[], when:[]});

      // Determine which pills to show in the right block "–ø–æ–¥–±–æ—Ä"
      let matchedBad = [];
      let matchedGood = [];

      if(multiMode){
        matchedBad = det.when.filter(x => selectedBad.has(x));
        matchedGood = det.gives.filter(x => selectedGood.has(x));
      } else if(context && context.mode === "single" && context.focusStateId){
        if(context.focusType === "bad"){
          matchedBad = det.when.includes(context.focusStateId) ? [context.focusStateId] : [];
        } else {
          matchedGood = det.gives.includes(context.focusStateId) ? [context.focusStateId] : [];
        }
      }

      // Limit pills to keep cards compact on mobile
      function limitPills(arr, max=3){
        const a = arr.slice(0, max);
        const rest = arr.length - a.length;
        return {a, rest};
      }
      const mb = limitPills(matchedBad, isMobile()?2:3);
      const mg = limitPills(matchedGood, isMobile()?2:3);

      const li = document.createElement("li");
      // Make the whole row clickable (not only the title) so cards reliably open everywhere.
      li.dataset.teaKey = tea.key;

      const thumbUrl = (getImgMap()[tea.key] || "");

      li.innerHTML = `
        <div class="listTop">
          ${thumbUrl ? `<img class="thumb" alt="" src="${thumbUrl}">` : ``}
          <div style="flex:1 1 auto; min-width:0;">
            <div class="k">
              <span>
                <button class="teaBtn" type="button" data-tea-key="${tea.key}">
                  ${escapeHtml(teaName(tea))}
                </button>
              </span>
              <span class="tag">${escapeHtml(teaTag(tea))}${count ? ` ‚Ä¢ ${count}` : ""}</span>
            </div>
            <div class="muted">${escapeHtml(teaBrew(tea))}</div>

            <div class="pillWrapSmall" data-pillwrap="1"></div>

            <div class="buyLine">
              <a class="buyLink" href="${url}" target="_blank" rel="noopener">${escapeHtml(UI[lang].buy)}</a>
            </div>
          </div>
        </div>
      `;
      teaList.appendChild(li);

      // render pills with tooltips (tea-specific)
      const wrap = li.querySelector('[data-pillwrap="1"]');
      wrap.innerHTML = "";

      function addPill(stateId, kind, role){
        const p = document.createElement("span");
        p.className = `pillState ${kind}`;
        p.textContent = TState(stateId, lang);
        p.dataset.tip = "1";
        p.dataset.teaKey = tea.key;
        p.dataset.stateId = stateId;
        p.dataset.role = role;
        p.tabIndex = 0;
        wrap.appendChild(p);
      }
      mb.a.forEach(id => addPill(id, "bad", "reduce"));
      if(mb.rest > 0){
        const more = document.createElement("span");
        more.className = "pillMore";
        more.textContent = `+${mb.rest}`;
        wrap.appendChild(more);
      }
      mg.a.forEach(id => addPill(id, "good", "evoke"));
      if(mg.rest > 0){
        const more = document.createElement("span");
        more.className = "pillMore";
        more.textContent = `+${mg.rest}`;
        wrap.appendChild(more);
      }

      // –í–ê–ñ–ù–û: –∫–ª–∏–∫–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —á–∞—è (–∫–Ω–æ–ø–∫–∞) –Ω–µ –¥–æ–ª–∂–Ω—ã –≤—Å–ø–ª—ã–≤–∞—Ç—å –¥–æ document,
      // –∏–Ω–∞—á–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è+–∑–∞–∫—Ä–æ–µ—Ç—Å—è —Å—Ä–∞–∑—É.
      li.querySelector(`button[data-tea-key="${tea.key}"]`)
        .addEventListener("click", (ev)=>{ ev.preventDefault(); ev.stopPropagation(); openTeaDetails(tea.key); });
    }
  }

  function highlightRightCard(){
    window.scrollTo({ top: 0, behavior: "smooth" });
    rightCard.classList.remove("flashGreen");
    void rightCard.offsetWidth;
    rightCard.classList.add("flashGreen");
    rightCard.classList.add("keepGreen");
  }

  // =========================
  // Render clouds
  // =========================
  function renderCloud(list, targetEl, type){
    targetEl.innerHTML = "";
    list.forEach(item=>{
      const btn = document.createElement("button");
      btn.className = `node ${type}`;
      btn.dataset.id = item.id;
      btn.dataset.type = type;
      btn.dataset.active = "false";
      btn.dataset.selected = "false";
      btn.innerHTML = `${escapeHtml(TState(item.id, lang))}<span class="checkdot"></span>`;
      btn.addEventListener("click", ()=> onStateClick(item, btn, type));
      targetEl.appendChild(btn);
    });
  }

  function renderMultiRecommendations(){
    if(selectedBad.size === 0 && selectedGood.size === 0){
      cardTitle.textContent = UI[lang].cardIdleTitle;
      cardDesc.textContent = UI[lang].cardDesc;
      teaList.innerHTML = "";
    // Herbs in PRO: show blend card (collection) for 1 liter
    if(domain==="herbs" && context && context.mode==="pro"){
      const blendCard = renderHerbBlendCard(items);
      if(blendCard) teaList.appendChild(blendCard);
    }
      if(lastReasoning) showReasoning(lastReasoning);
      return;
    }

    cardTitle.textContent = UI[lang].prompts.proTitle;
    cardDesc.textContent = (domain==="herbs") ? UI[lang].prompts.proDescHerbs : UI[lang].prompts.proDescTea;

    const bMap = getBadById();
    const gMap = getGoodById();
    const badSel  = [...selectedBad].map(id=>bMap[id]).filter(Boolean);
    const goodSel = [...selectedGood].map(id=>gMap[id]).filter(Boolean);

    const merged = aggregateTeas([...badSel, ...goodSel]).slice(0,12);
    void renderTeaList(merged, {mode:"pro"});

    if(lastReasoning) showReasoning(lastReasoning);
  }

  // =========================
  // Mode switching
  // =========================
  function setMode(nextMulti){
    multiMode = nextMulti;

    multiToggle.dataset.on = String(nextMulti);
    multiToggle.setAttribute("aria-checked", String(nextMulti));

    cardChip.textContent = nextMulti ? UI[lang].cardModePro : UI[lang].cardModeSingle;

    if(nextMulti){
      document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
      multiBlocks.style.display = "block";
      renderSelectedChips();
      renderMultiRecommendations();
    } else {
      selectedBad.clear();
      selectedGood.clear();
      document.querySelectorAll(".node").forEach(b=> b.dataset.selected = "false");
      multiBlocks.style.display = "none";
      resetSingleView();
      lastReasoning = "";
    }
    updateCounter();
  }

  function resetProModalContent(){
    proModalBody.textContent = UI[lang].proModalQuestion;
    proModalActions.innerHTML = `
      <button class="miniBtn" id="proModalNo" type="button">${UI[lang].proNo}</button>
      <button class="primaryBtn" id="proModalYes" type="button">${UI[lang].proYes}</button>
    `;
    // rebind
    proModalActions.querySelector("#proModalNo").addEventListener("click", ()=> proAnswer("no"));
    proModalActions.querySelector("#proModalYes").addEventListener("click", ()=> proAnswer("yes"));
  }

  function requestEnablePro(){
    pendingEnablePro = true;
    document.getElementById("uiProModalTitle").textContent = UI[lang].proModalTitle;
    resetProModalContent();
    openModal(proModal);
  }

  function proAnswer(which){
    // Enable PRO anyway (–ø—Ä–æ–¥—É–∫—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
    setMode(true);

    // Replace content with restored text
    proModalBody.textContent = (which === "no") ? UI[lang].proNoText : UI[lang].proYesText;
    proModalActions.innerHTML = `<button class="miniBtn" id="proModalOk" type="button">${UI[lang].ok}</button>`;
    proModalActions.querySelector("#proModalOk").addEventListener("click", ()=>{
      pendingEnablePro = false;
      closeModal(proModal);
      resetProModalContent();
      // In mobile wizard: jump to step 2 automatically
      if(isMobile() && mstep === 1) setMobileStep(2);
    });
  }

  function toggleModeWithModal(){
    if(!multiMode){
      requestEnablePro();
    } else {
      setMode(false);
    }
  }

  multiToggle.addEventListener("click", toggleModeWithModal);
  multiToggle.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      toggleModeWithModal();
    }
  });

  // =========================
  // Click handler
  // =========================
  function onStateClick(item, btn, type){
    if(!multiMode){
      document.querySelectorAll(".node").forEach(b=> b.dataset.active = "false");
      btn.dataset.active = "true";

      cardTitle.textContent = TState(item.id, lang);
      const p = UI[lang].prompts;
      cardDesc.textContent = (type === "bad") ? ((domain==="herbs")?p.badHerbs:p.badTea) : ((domain==="herbs")?p.goodHerbs:p.goodTea);

      const list = item.teas.slice(0,4).map(tea=>({tea, count:null}));
      void renderTeaList(list, {mode:"single", focusStateId:item.id, focusType:type});

      if(lastReasoning) showReasoning(lastReasoning);
      else hideReasoning();

      // mobile: if user taps a state, jump to step 4
      if(isMobile() && (mstep === 2 || mstep === 3)){
        setMobileStep(4);
      }
      return;
    }

    const set = (type === "bad") ? selectedBad : selectedGood;
    const isSelected = btn.dataset.selected === "true";

    if(isSelected){
      set.delete(item.id);
      btn.dataset.selected = "false";
    } else {
      if(set.size >= 5){
        openModal(limitModal);
        return;
      }
      set.add(item.id);
      btn.dataset.selected = "true";
    }

    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();

    // mobile: convenient flow
    if(isMobile()){
      if(mstep === 2 && selectedBad.size > 0) { /* keep */ }
      if(mstep === 3 && selectedGood.size > 0) { /* keep */ }
    }
  }

  // clear buttons
  clearBadBtn.addEventListener("click", ()=>{
    selectedBad.clear();
    document.querySelectorAll(".node.bad").forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  });
  clearGoodBtn.addEventListener("click", ()=>{
    selectedGood.clear();
    document.querySelectorAll(".node.good").forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  });
  clearAllBtn.addEventListener("click", ()=>{
    selectedBad.clear();
    selectedGood.clear();
    document.querySelectorAll(".node").forEach(b=> b.dataset.selected="false");
    renderSelectedChips();
    renderMultiRecommendations();
    updateCounter();
  });

  // =========================
  // Free-text ‚ÄúAI‚Äù button
  // =========================
  function clearSelectionsUI(){
    document.querySelectorAll(".node").forEach(b=>{
      b.dataset.selected = "false";
      b.dataset.active = "false";
    });
  }

  function selectState(id, type){
    const btn = document.querySelector(`.node.${type}[data-id="${id}"]`);
    if(btn) btn.dataset.selected = "true";
  }

  function buildReasoningText(inputText, analyzed){
    const esc = escapeHtml;
    const lines = [];

    lines.push(`<div><b>${lang==="ru" ? "–¢–≤–æ–π —Ç–µ–∫—Å—Ç:" : "Your text:"}</b> ${esc(inputText)}</div>`);

    if(analyzed.bad.length === 0 && analyzed.good.length === 0){
      lines.push(`<div style="margin-top:6px;">${esc(lang==="ru"
        ? "–ù–µ –Ω–∞—à—ë–ª —è–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –æ–ø–∏—Å–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ (—Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞, —Ç—É–º–∞–Ω –≤ –≥–æ–ª–æ–≤–µ, –ø–æ—Å–ª–µ –æ–±–µ–¥–∞, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ç.–¥.)."
        : "No strong keyword matches ‚Äî try being more specific (sleepy, anxious, brain fog, after lunch, irritated, etc.).")}</div>`);
      return lines.join("");
    }

    function fmtBlock(title, arr){
      if(arr.length === 0) return;
      lines.push(`<div style="margin-top:8px;"><b>${esc(title)}</b></div>`);
      lines.push(`<ul style="margin:6px 0 0; padding-left:18px;">` +
        arr.map(x=>{
          const name = esc(TState(x.id, lang));
          const hits = x.hits.slice(0,5).map(h=>`‚Äú${esc(h)}‚Äù`).join(", ");
          const score = x.score;
          const hitText = hits ? ` ‚Äî ${esc(lang==="ru" ? "–Ω–∞–π–¥–µ–Ω–æ" : "matched")}: ${hits}` : "";
          return `<li>${name} <span style="color:var(--muted);">(${score})${hitText}</span></li>`;
        }).join("") +
      `</ul>`);
    }

    fmtBlock(lang==="ru" ? "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—É–±—Ä–∞—Ç—å)" : "Detected states (reduce)", analyzed.bad);
    fmtBlock(lang==="ru" ? "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤—ã–∑–≤–∞—Ç—å)" : "Detected states (evoke)", analyzed.good);

    lines.push(`<div style="margin-top:8px; color:var(--muted); font-size:12px;">${
      esc(lang==="ru"
        ? "–õ–æ–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (—Å–ª–æ–≤–∞—Ä—å –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ)."
        : "Local keyword-based matcher (you can expand the dictionary in the code).")
    }</div>`);

    return lines.join("");
  }

  function ensureProOnForAI(){
    if(multiMode) return;
    setMode(true);
  }

  nlpBtn.addEventListener("click", ()=>{
    const text = (nlpInput.value || "").trim();
    if(!text) return;

    const analyzed = analyzeFreeText(text);

    ensureProOnForAI();
    selectedBad.clear();
    selectedGood.clear();
    clearSelectionsUI();

    analyzed.bad.forEach(x=> selectedBad.add(x.id));
    analyzed.good.forEach(x=> selectedGood.add(x.id));

    [...selectedBad].slice(0,5).forEach(id=>selectState(id, "bad"));
    [...selectedGood].slice(0,5).forEach(id=>selectState(id, "good"));

    renderSelectedChips();
    updateCounter();

    lastReasoning = buildReasoningText(text, analyzed);

    multiBlocks.style.display = "block";
    renderMultiRecommendations();
    showReasoning(lastReasoning);

    highlightRightCard();

    if(isMobile()) setMobileStep(4);
  });

  nlpInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      nlpBtn.click();
    }
  });

  // =========================
  // Tea modal (details + classification + tooltip pills)
  // =========================
  function openTeaDetails(teaKey){
    const tea = getCatalog()[teaKey];
    const det = getDetails()[teaKey];

    // Tap the same card again -> close
    if(teaModal.style.display === "flex" && openTeaId === teaKey){
      closeTeaModal();
      return;
    }
    openTeaId = teaKey;

    resetTeaModalState();
const meta = getMeta()[teaKey];
    const clsMap = getClassMap();
    const cls = (domain==="herbs") ? (clsMap.common) : (clsMap[teaKey] || clsMap.darkOolong);

    teaModalTitle.textContent = tea ? teaName(tea) : "Tea";
    teaModalTag.textContent = tea ? teaTag(tea) : "";
    teaModalTagLine.textContent = tea ? (lang==="ru" ? "–ö–æ—Ä–æ—Ç–∫–æ:" : "In short:") : "";
    teaModalDesc.textContent = det?.desc?.[lang] || det?.desc?.en || "";

    teaMoreBtn.textContent = UI[lang].more;
    teaModalBodyEl.classList.remove("expanded");

    const img = (getImgMap()[teaKey] || "");
    teaModalImg.src = img;
    teaModalImg.alt = tea ? teaName(tea) : "Tea";

    teaModalOriginTitle.textContent = UI[lang].teaModal.originTitle;
    teaModalFactsTitle.textContent  = UI[lang].teaModal.factsTitle;

    const originParts = [];
    if(meta?.firstMention?.[lang] || meta?.firstMention?.en) originParts.push(meta.firstMention[lang] || meta.firstMention.en);
    if(meta?.geography?.[lang] || meta?.geography?.en) originParts.push(meta.geography[lang] || meta.geography.en);
    if(meta?.altitude?.[lang] || meta?.altitude?.en) originParts.push(meta.altitude[lang] || meta.altitude.en);
    teaModalOrigin.textContent = originParts.join(" ");

    const factsArr = meta?.facts?.[lang] || meta?.facts?.en || [];
    teaModalFacts.innerHTML = factsArr.length
      ? `<ul style="margin:0; padding-left:18px;">${factsArr.map(f=>`<li>${escapeHtml(f)}</li>`).join("")}</ul>`
      : "‚Äî";

    teaModalGivesTitle.textContent = UI[lang].teaModal.givesTitle;
    teaModalWhenTitle.textContent  = UI[lang].teaModal.whenTitle;
    teaModalBrewTitle.textContent  = UI[lang].teaModal.brewTitle;
    teaModalClassTitle.textContent = UI[lang].teaModal.classTitle;

    renderPillsWithTea(teaModalGives, det?.gives || [], "good", teaKey, "evoke");
    renderPillsWithTea(teaModalWhen,  det?.when  || [], "bad",  teaKey, "reduce");

    renderMiniPillsWithTea(teaModalGivesMini, det?.gives || [], "good", teaKey, "evoke");
    renderMiniPillsWithTea(teaModalWhenMini,  det?.when  || [], "bad",  teaKey, "reduce");

    teaModalBrew.textContent = tea ? teaBrew(tea) : "";

    // classification grid
    const rows = [
      ["ferment", lang==="ru" ? "–°—Ç–µ–ø–µ–Ω—å —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏–∏" : "Fermentation"],
      ["process", lang==="ru" ? "–¢–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏" : "Processing"],
      ["material", lang==="ru" ? "–°—ã—Ä—å—ë –∏ —Å–±–æ—Ä" : "Material & harvest"],
      ["region", lang==="ru" ? "–†–µ–≥–∏–æ–Ω" : "Region"],
      ["profile", lang==="ru" ? "–í–∫—É—Å-–∞—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å" : "Flavor/aroma"],
      ["texture", lang==="ru" ? "–¢–µ–∫—Å—Ç—É—Ä–∞ –Ω–∞—Å—Ç–æ—è" : "Liquor texture"],
      ["effect", lang==="ru" ? "–≠—Ñ—Ñ–µ–∫—Ç" : "Effect"],
      ["aging", lang==="ru" ? "–°—Ç–µ–ø–µ–Ω—å –≤—ã–¥–µ—Ä–∂–∫–∏" : "Aging"],
      ["format", lang==="ru" ? "–§–æ—Ä–º–∞ –∏ —Ñ–æ—Ä–º–∞—Ç" : "Form/format"],
      ["storage", lang==="ru" ? "–•—Ä–∞–Ω–µ–Ω–∏–µ" : "Storage"],
    ];
    teaModalClassGrid.innerHTML = rows.map(([k, label])=>{
      const v = cls?.[k]?.[lang] || cls?.[k]?.en || "‚Äî";
      return `<div class="infoItem"><div class="infoK">${escapeHtml(label)}</div><div class="infoV">${escapeHtml(v)}</div></div>`;
    }).join("");

    teaModalIgnoreCloseUntil = (window.performance && performance.now ? performance.now() : Date.now()) + 350;
    openModal(teaModal);
    updateTeaMoreVisibility();
  }


  teaMoreBtn.addEventListener("click", ()=>{
    const expanded = teaModalBodyEl.classList.toggle("expanded");
    teaMoreBtn.textContent = expanded ? UI[lang].less : UI[lang].more;
  });

  // =========================
  // Mobile stepper logic
  // =========================
  function setMobileStep(next){
    mstep = Math.max(1, Math.min(4, next));
    document.body.setAttribute("data-mstep", String(mstep));
    const s = UI[lang].mobile.steps[mstep-1];
    mStepTitle.textContent = s.t;
    mStepHint.textContent = s.h;

    mBackBtn.disabled = (mstep === 1);
    mNextBtn.textContent = (mstep === 4) ? UI[lang].mobile.done : UI[lang].mobile.next;

    // small scroll-to-top for "screen change"
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function initMobileStepper(){
    if(!isMobile()) return;
    setMobileStep(mstep);
  }

  mBackBtn.addEventListener("click", ()=>{
    if(mstep > 1) setMobileStep(mstep - 1);
  });
  mNextBtn.addEventListener("click", ()=>{
    if(mstep < 4) setMobileStep(mstep + 1);
    else setMobileStep(1);
  });

  window.addEventListener("resize", ()=>{
    if(isMobile()){
      initMobileStepper();
    } else {
      document.body.removeAttribute("data-mstep");
      hideTip();
    }
  });

  // =========================
  // Language + theme
  // =========================
  function applyThemeButtonLabel(){
    const theme = document.documentElement.getAttribute("data-theme") || "light";
    themeBtn.textContent = (theme === "light") ? UI[lang].themeLight : UI[lang].themeDark;
  }

  function setTheme(next){
    document.documentElement.setAttribute("data-theme", next);
    localStorage.setItem("tea_states_theme", next);
    applyThemeButtonLabel();
  }

  themeBtn.addEventListener("click", ()=>{
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    setTheme(cur === "light" ? "dark" : "light");
  });

  function fillLangSelect(){
    langSelect.innerHTML = "";
    LANGS.forEach(l=>{
      const opt = document.createElement("option");
      opt.value = l.id;
      opt.textContent = l.label;
      langSelect.appendChild(opt);
    });
  }

  function applyUI(){
    const u = UI[lang];
    document.documentElement.lang = lang;

    document.getElementById("uiTitle").textContent = u.title;
    document.getElementById("uiSubtitle").textContent = u.subtitle;
    document.getElementById("uiLangLabel").textContent = u.langLabel;

    // Domain selector (future sections)
    const uiDomainLabelEl = document.getElementById("uiDomainLabel");
    if(uiDomainLabelEl) uiDomainLabelEl.textContent = u.domainLabel || "–†–∞–∑–¥–µ–ª";
    if(domainSelect){
      const keep = domainSelect.value || domain || "tea";
      domainSelect.innerHTML = "";
      (u.domains || []).forEach(d=>{
        const opt = document.createElement("option");
        opt.value = d.id;
        opt.textContent = d.label;
        domainSelect.appendChild(opt);
      });
      const exists = (u.domains||[]).some(d=>d.id===keep);
      domainSelect.value = exists ? keep : "tea";
    }

    // Classifier dropdown (future classifiers)
    if (uiClassifierLabel) uiClassifierLabel.textContent = u.classifierLabel || (lang==="ru" ? "–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä" : "Classifier");
    if (classifierSelect){
      classifierSelect.innerHTML = "";
      (u.classifiers||[]).forEach(c=>{
        const opt=document.createElement("option");
        opt.value=c.id;
        opt.textContent=c.label;
        classifierSelect.appendChild(opt);
      });
      const desired = classifier || "states";
      const exists = (u.classifiers||[]).some(c=>c.id===desired);
      classifierSelect.value = exists ? desired : "states";
    }

    // Mini labels in tea modal header
    const miniGivesLbl = document.getElementById("uiMiniGivesLabel");
    const miniRemovesLbl = document.getElementById("uiMiniRemovesLabel");
    if(miniGivesLbl) miniGivesLbl.textContent = u.miniGivesLabel || "–î–∞—ë—Ç:";
    if(miniRemovesLbl) miniRemovesLbl.textContent = u.miniRemovesLabel || "–£–±–∏—Ä–∞–µ—Ç:";

    // "Coming soon" modal text
    if(uiSoonTitle) uiSoonTitle.textContent = u.soonTitle || "–°–∫–æ—Ä–æ";
    if(uiSoonBody) uiSoonBody.textContent = u.soonBody || "";


    document.getElementById("uiBadTitle").textContent = u.badTitle;
    document.getElementById("uiBadHint").textContent = u.badHint;
    document.getElementById("uiBadPill").textContent = u.badPill;

    document.getElementById("uiGoodTitle").textContent = u.goodTitle;
    document.getElementById("uiGoodHint").textContent = u.goodHint;
    document.getElementById("uiGoodPill1").textContent = u.goodPill1;
    document.getElementById("uiGoodPill2").textContent = u.goodPill2;

    document.getElementById("uiAddedRemove").textContent = u.addedRemove;
    document.getElementById("uiAddedGet").textContent = u.addedGet;
    document.getElementById("uiTeaPick").textContent = u.teaPick;
    document.getElementById("uiMultiLine").textContent = u.multiLine;

    clearBadBtn.textContent = u.clear;
    clearGoodBtn.textContent = u.clear;
    clearAllBtn.textContent = u.resetAll;

    document.getElementById("uiBrewQuick").innerHTML = (domain==="herbs") ? u.brewQuickHerbs : u.brewQuickTea;

    document.getElementById("uiProTitle").textContent = u.proTitle;
    document.getElementById("uiFineprint").textContent = (domain==="herbs") ? u.fineprintHerbs : u.fineprintTea;
    aboutLink.textContent = u.about;

    document.getElementById("uiAboutTitle").textContent = u.aboutTitle;
    document.getElementById("uiAboutBody").textContent = u.aboutBody;

    document.getElementById("uiLimitTitle").textContent = u.limitTitle;
    document.getElementById("uiLimitBody").textContent = u.limitBody;
    closeLimitBtn.textContent = u.ok;

    document.getElementById("uiNlpTitle").textContent = u.nlpTitle;
    nlpInput.placeholder = u.nlpPlaceholder;
    nlpBtn.textContent = u.nlpBtn;
    document.getElementById("uiNlpNote").textContent = u.nlpNote;

    renderCloud(getBadStates(), badCloud, "bad");
    renderCloud(getGoodStates(), goodCloud, "good");

    if(multiMode){
      [...selectedBad].forEach(id=>selectState(id, "bad"));
      [...selectedGood].forEach(id=>selectState(id, "good"));
      renderSelectedChips();
      renderMultiRecommendations();
    } else {
      resetSingleView();
    }
    updateCounter();
    applyThemeButtonLabel();

    // mobile stepper texts
    mBackBtn.textContent = u.mobile.back;
    mNextBtn.textContent = u.mobile.next;
    initMobileStepper();

    if(lastReasoning){
      showReasoning(lastReasoning);
    }
  }

  function setLang(next){
    if(!UI[next]) return;
    lang = next;
    localStorage.setItem("tea_states_lang", lang);
    langSelect.value = lang;
    if(langFlag){ langFlag.textContent = (lang==="ru") ? "üá∑üá∫" : "üá¨üáß"; }
    applyUI();
  }
  langSelect.addEventListener("change", ()=> setLang(langSelect.value));

  // =========================
  // Domain (section) + classifier switchers
  // =========================
  function setDomain(next){
    const allowed = ["tea","herbs"]; // currently supported
    if(!allowed.includes(next)){
      // show soon, revert to tea
      openSoon(UI[lang].soonTitle || "–°–∫–æ—Ä–æ", UI[lang].soonBody || (lang==="ru" ? "–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ." : "This section is coming soon."));
      domain = "tea";
      localStorage.setItem("tea_states_domain", domain);
      if(domainSelect) domainSelect.value = domain;
      return;
    }
    domain = next;
    localStorage.setItem("tea_states_domain", domain);
    if(domainSelect) domainSelect.value = domain;
    // Reset selections when switching sections
    selectedBad.clear(); selectedGood.clear();
    clearSelectionsUI();
    multiBlocks.style.display = "none";
    lastReasoning = "";
    reasoningBox.style.display = "none";
    setMode(false);
    applyUI();
  }

  function setClassifier(next){
    // For now only "states" is implemented. Other classifiers are placeholders.
    const allowed = ["states","qualities","health","psychology"];
    if(!allowed.includes(next)) next = "states";

    if(next !== "states"){
      const title = (UI[lang] && (UI[lang].soonTitle || UI[lang].soonClassifierTitle)) || (lang==="ru" ? "–°–∫–æ—Ä–æ" : "Soon");
      const msg = (UI[lang] && (UI[lang].soonClassifierText || UI[lang].soonClassifier)) || (lang==="ru" ? "–≠—Ç–æ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ." : "This classifier is coming soon.");
      openSoon(title, msg);
      next = "states";
    }

    classifier = next;
    localStorage.setItem("tea_states_classifier", classifier);

    if (classifierSelect) classifierSelect.value = classifier;
  }

  if(typeof domainSelect !== "undefined" && domainSelect){
    domainSelect.addEventListener("change", ()=> setDomain(domainSelect.value));
  if (classifierSelect) classifierSelect.addEventListener("change", ()=> setClassifier(classifierSelect.value));
  }


  function detectLang(){
    const n = (navigator.language || navigator.userLanguage || "ru").toLowerCase();
    if(n.startsWith("ru")) return "ru";
    return "en";
  }

  // =========================
  // Init
  // =========================
  function init(){
  // Populate language options first
  fillLangSelect();

  const savedLang = localStorage.getItem("tea_states_lang");
  lang = savedLang || detectLang();
  langSelect.value = lang;

  // Domain (section) selector (future use)
  const savedDomain = localStorage.getItem("tea_states_domain") || "tea";
  const savedClassifier = localStorage.getItem("tea_states_classifier") || "states";
  classifier = savedClassifier;

  if(typeof domainSelect !== "undefined" && domainSelect){
    domainSelect.value = savedDomain;
    setDomain(savedDomain);

  }

  const savedTheme = localStorage.getItem("tea_states_theme");
  setTheme(savedTheme || "light");

  setMode(false);
  applyUI();
}

  init();

  // Extra: product card opening (robust delegation)
  // - Clicking on the title opens the card
  // - Clicking anywhere on the row opens the card (except the buy link)
  document.addEventListener("click", (e)=>{
    const target = e.target;
    // Don't hijack clicks on buy links
    if(target && target.closest && target.closest("a.buyLink")) return;

    const btn = target && target.closest && target.closest(".teaBtn");
    if(btn && btn.dataset && btn.dataset.teaKey){
      openTeaDetails(btn.dataset.teaKey);
      return;
    }

    const row = target && target.closest && target.closest("li[data-tea-key]");
    if(row && row.dataset && row.dataset.teaKey){
      openTeaDetails(row.dataset.teaKey);
      return;
    }
  });
</script>
</body>
</html>

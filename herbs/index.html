<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ü–æ–¥–±–æ—Ä: —á–∞–π / —Ç—Ä–∞–≤—ã ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏—è</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#121420; --text:#e9eaf0; --muted:#a8adbd;
      --line:rgba(255,255,255,.10);
      --accent:#7ddc7a; --accent2:#7ab7ff; --warn:#ffcc66;
      --pill:#1a1d2c;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --pad:16px;
      --w:980px;
      font-synthesis-weight:none;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --card:#ffffff; --text:#12131a; --muted:#5a6170; --line:rgba(0,0,0,.10); --pill:#f0f2f8; --shadow:0 14px 40px rgba(18,19,26,.12); }
    }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(125,220,122,.10), transparent 50%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(122,183,255,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{ max-width:var(--w); margin:0 auto; padding:22px 14px 44px; }
    .top{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    h1{ margin:0; font-size:24px; letter-spacing:.2px; }
    .crumb{ color:var(--muted); font-size:13px; margin-top:6px; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:22px;
      box-shadow:var(--shadow); padding:20px; }
    .stepper{ display:flex; gap:8px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
    .dot{ width:10px; height:10px; border-radius:99px; background:rgba(255,255,255,.18); border:1px solid var(--line); }
    @media (prefers-color-scheme: light){ .dot{ background:rgba(0,0,0,.10);} }
    .dot.on{ background:var(--accent); border-color:rgba(125,220,122,.35); }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .btn{ border:1px solid var(--line); background:transparent; color:var(--text);
      padding:12px 16px; border-radius:16px; cursor:pointer; font-weight:750; font-size:15px; }
    .btn.primary{ background:linear-gradient(180deg, rgba(125,220,122,.20), rgba(125,220,122,.08));
      border-color:rgba(125,220,122,.35); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .seg{ display:flex; gap:8px; flex-wrap:wrap; }
    .seg .opt{ border:1px solid var(--line); background:var(--pill); color:var(--text);
      padding:10px 12px; border-radius:999px; cursor:pointer; font-weight:650; }
    .seg .opt.on{ outline:2px solid rgba(125,220,122,.55); }
    
    /* Rich tiles */
    .tiles{ display:grid; grid-template-columns:1fr; gap:14px; margin-top:6px; }
    @media (min-width: 640px){ .tiles{ grid-template-columns:1fr 1fr; } }
    .tile{
      position:relative;
      border:1px solid var(--line);
      border-radius:24px;
      padding:18px 18px 16px;
      cursor:pointer;
      overflow:hidden;
      background:
        radial-gradient(700px 220px at 20% 0%, rgba(125,220,122,.22), transparent 55%),
        radial-gradient(560px 260px at 90% 30%, rgba(122,183,255,.22), transparent 58%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 12px 34px rgba(0,0,0,.28);
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      min-height:128px;
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    @media (prefers-color-scheme: light){
      .tile{
        background:
          radial-gradient(700px 220px at 20% 0%, rgba(125,220,122,.18), transparent 55%),
          radial-gradient(560px 260px at 90% 30%, rgba(122,183,255,.18), transparent 58%),
          linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,.00));
        box-shadow: 0 18px 44px rgba(18,19,26,.10);
      }
    }
    .tile:hover{ transform: translateY(-1px); box-shadow: 0 18px 46px rgba(0,0,0,.34); border-color: rgba(255,255,255,.18); }
    @media (prefers-color-scheme: light){ .tile:hover{ box-shadow: 0 22px 52px rgba(18,19,26,.14); border-color: rgba(0,0,0,.14);} }
    .tile:active{ transform: translateY(0); }
    .tile.on{ outline: 3px solid rgba(125,220,122,.55); border-color: rgba(125,220,122,.45); }
    .tileIcon{
      width:54px;height:54px;border-radius:18px;
      border:1px solid var(--line);
      display:flex;align-items:center;justify-content:center;
      font-size:26px;
      background: rgba(0,0,0,.12);
      flex:0 0 auto;
    }
    @media (prefers-color-scheme: light){ .tileIcon{ background: rgba(0,0,0,.04);} }
    .tileTitle{ font-size:18px; font-weight:800; letter-spacing:.2px; margin-top:2px; }
    .tileSub{ color:var(--muted); font-size:13px; line-height:1.45; margin-top:6px; }
    .tileBadges{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .badge{
      font-size:12px; font-weight:750;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
    }
    @media (prefers-color-scheme: light){ .badge{ background: rgba(0,0,0,.03);} }
    .badge.green{ border-color: rgba(125,220,122,.35); }
    .badge.blue{ border-color: rgba(122,183,255,.45); }

.hint{ color:var(--muted); font-size:13px; line-height:1.4; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; margin-top:12px; }
    .list{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .pill{ border:1px solid var(--line); background:var(--pill); color:var(--text);
      padding:10px 14px; border-radius:999px; cursor:pointer; user-select:none; font-weight:750; font-size:14px;
      transition: transform .08s ease, border-color .08s ease, background .08s ease; }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.20); }
    .pill.bad.on{ background:rgba(255,110,110,.14); border-color:rgba(255,110,110,.35); }
    .pill.good.on{ background:rgba(122,183,255,.18); border-color:rgba(122,183,255,.45); }
    .note{ border-left:3px solid rgba(122,183,255,.55); padding-left:10px; color:var(--muted); font-size:13px; margin-top:10px; }
    .results h2{ margin:0 0 8px 0; font-size:16px; }
    .item{ padding:14px 14px; border:1px solid var(--line); border-radius:14px; background:rgba(255,255,255,.03);
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between; }
    @media (prefers-color-scheme: light){ .item{ background:rgba(0,0,0,.03);} }
    .thumb{ width:56px; height:56px; border-radius:12px; border:1px solid var(--line); overflow:hidden; flex:0 0 auto; }
.thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
.item .leftcol{ min-width:0; }
    .item b{ display:block; }
    .item span{ color:var(--muted); font-size:13px; }
    .item .actions{ display:flex; gap:10px; align-items:center; flex-shrink:0; }
    .link{ color:var(--accent2); text-decoration:none; font-weight:650; }
    .link:hover{ text-decoration:underline; }
    .footer{ margin-top:12px; color:var(--muted); font-size:12px; }
    .err{ color:var(--warn); font-size:13px; margin-top:10px; display:none; }

    /* Modal */
    .modalOverlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:16px;
      background:rgba(0,0,0,.35); z-index:9999; }
    @media (prefers-color-scheme: light){ .modalOverlay{ background:rgba(0,0,0,.22);} }
    .modal{ width:min(760px, 100%); max-height:min(82vh, 820px); overflow:auto;
      background:var(--card); border:1px solid var(--line); border-radius:22px; box-shadow:var(--shadow);
      padding:16px; }
    .modalTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .x{ border:1px solid var(--line); background:transparent; color:var(--text); border-radius:12px; padding:8px 10px; cursor:pointer; font-weight:750; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .chip{ border:1px solid var(--line); background:var(--pill); padding:6px 10px; border-radius:999px; font-size:12px; font-weight:650; }
    .chip.bad{ border-color:rgba(255,110,110,.35); }
    .chip.good{ border-color:rgba(122,183,255,.45); }
    .small{ color:var(--muted); font-size:13px; line-height:1.5; margin-top:8px; }
    .two{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px; }
    @media (min-width: 720px){ .two{ grid-template-columns:1fr 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 id="title">–®–∞–≥ 1/4</h1>
        <div class="crumb" id="crumb">–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª</div>
      </div>
      <div class="stepper" aria-label="—à–∞–≥–∏">
        <div class="dot" id="d1"></div>
        <div class="dot" id="d2"></div>
        <div class="dot" id="d3"></div>
        <div class="dot" id="d4"></div>
      </div>
    </div>

    <div class="card grid" id="panel"></div>

    <div class="row" style="margin-top:12px; justify-content:flex-end;">
  <div style="display:flex; gap:10px; align-items:center;">
    <button class="btn" id="backBtn">–ù–∞–∑–∞–¥</button>
    <button class="btn primary" id="nextBtn">–î–∞–ª–µ–µ</button>
  </div>
</div>

    <div class="footer">
      –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–æ–≤–µ—Ç. –†–µ–∞–∫—Ü–∏–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã. –¢—Ä–∞–≤—ã/—á–∞–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏.
      –ü—Ä–∏ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏–∏, —Ç—Ä–µ–≤–æ–≥–µ/–ø–∞–Ω–∏–∫–µ, –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö —Å–Ω–∞ ‚Äî –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.
    </div>
  </div>

  <!-- Modal -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-label="–æ–ø–∏—Å–∞–Ω–∏–µ">
    <div class="modal">
      <div class="modalTop">
        <div>
          <b id="mTitle" style="font-size:16px;"></b>
          <div class="small" id="mMeta"></div>
        </div>
        <button class="x" id="mClose">‚úï</button>
      </div>
      <div class="two">
        <div>
          <div class="thumb" style="width:100%; height:180px; border-radius:16px; margin-bottom:10px;">
            <img id="mImg" src="" alt="" style="width:100%; height:100%; object-fit:cover; display:block;">
          </div>
          <div class="small"><b>–û–ø–∏—Å–∞–Ω–∏–µ</b></div>
          <div class="small" id="mDesc"></div>
        </div>
        <div>
          <div class="small"><b>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</b></div>
          <div class="small" id="mClass"></div>
        </div>
      </div>
      <div class="small" id="mBrewWrap" style="margin-top:10px;">
        <div class="small"><b>–ó–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</b></div>
        <div class="small" id="mBrew"></div>
      </div>

      <div class="small" style="margin-top:10px;"><b>–ß–∞—â–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞:</b></div>
      <div class="chips" id="mWhen"></div>

      <div class="small" style="margin-top:10px;">
        <a class="link" id="mBuy" target="_blank" rel="noopener">–ö—É–ø–∏—Ç—å –Ω–∞ Ozon</a>
      </div>
    </div>
  </div>

<script>
/** ---------- Data ---------- */
const STATES_BAD = [
  "–§–∏–∑–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å","–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å","–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å","–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å","–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
  "–ó–∞—Å—Ç–æ–π/–∞–ø–∞—Ç–∏—è","–•–æ–ª–æ–¥ –≤ —Ç–µ–ª–µ","–¢—è–∂–µ—Å—Ç—å –ø–æ—Å–ª–µ –µ–¥—ã","–ù–∏–∑–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è","–ì–æ–ª–æ–≤–Ω–∞—è —Ç—è–∂–µ—Å—Ç—å",
  "–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ","–í—è–ª–æ—Å—Ç—å —É—Ç—Ä–æ–º","–°–∫–∞—á–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ","–ü–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ","–ù–µ—Ä–≤–Ω–æ–µ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ",
  "–°—É—Ö–æ—Å—Ç—å –≤–æ —Ä—Ç—É","–ó—è–±–∫–æ—Å—Ç—å","–°–Ω–∏–∂–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏","–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∞–¥","–õ—ë–≥–∫–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å"
];
const STATES_GOOD = [
  "–Ø—Å–Ω–æ—Å—Ç—å","–°–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å","–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ","–†–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ","–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è",
  "–õ—ë–≥–∫–æ—Å—Ç—å","–§–æ–∫—É—Å","–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å","–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å","–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫",
  "–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ç–µ–ª–∞","–ß–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞","–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å","–¢–µ—Ä–ø–µ–Ω–∏–µ","–ë–µ—Ä–µ–∂–Ω–æ—Å—Ç—å –∫ —Å–µ–±–µ",
  "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–∏—à–∏–Ω–∞","–ë–∞–ª–∞–Ω—Å","–ß—É–≤—Å—Ç–≤–æ –æ–ø–æ—Ä—ã","–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø—É–ª—å—Å–æ–≤","–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
];

const TEAS = [
  {id:"shou", name:"–®—É –ø—É—ç—Ä (–º—è–≥–∫–∏–π)", meta:"–ü—É—ç—Ä ¬∑ —Ç—ë–º–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è",
   desc:"–ü–ª–æ—Ç–Ω—ã–π, –∑–µ–º–ª—è–Ω–∏—Å—Ç—ã–π –ø—Ä–æ—Ñ–∏–ª—å, –º—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–ø–ª–æ—Ç—ã¬ª.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"–ø–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π","–†–µ–≥–∏–æ–Ω":"–Æ–Ω—å–Ω–∞–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"–∑–µ–º–ª—è, –æ—Ä–µ—Ö, –∫–∞–∫–∞–æ","–¢–µ–∫—Å—Ç—É—Ä–∞":"–ø–ª–æ—Ç–Ω–∞—è","–≠—Ñ—Ñ–µ–∫—Ç":"—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Ç–µ–ø–ª–æ" },
   buyQuery:"—à—É –ø—É—ç—Ä" },
  {id:"shen", name:"–®—ç–Ω –ø—É—ç—Ä (—Å–≤–µ–∂–∏–π)", meta:"–ü—É—ç—Ä ¬∑ –∑–µ–ª—ë–Ω—ã–π —Ç–∏–ø",
   desc:"–ë–æ–ª–µ–µ —è—Ä–∫–∏–π –∏ ¬´–∑–≤–æ–Ω–∫–∏–π¬ª, –º–æ–∂–µ—Ç –∑–∞–º–µ—Ç–Ω–æ –±–æ–¥—Ä–∏—Ç—å. –•–æ—Ä–æ—à –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ–∫—É—Å–∞ (–µ—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–≤–æ–≥–∏).",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è/–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è","–†–µ–≥–∏–æ–Ω":"–Æ–Ω—å–Ω–∞–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"—Ç—Ä–∞–≤—ã, —Ñ—Ä—É–∫—Ç—ã","–¢–µ–∫—Å—Ç—É—Ä–∞":"—Å—Ä–µ–¥–Ω—è—è","–≠—Ñ—Ñ–µ–∫—Ç":"—è—Å–Ω–æ—Å—Ç—å, —Ç–æ–Ω—É—Å" },
   buyQuery:"—à—ç–Ω –ø—É—ç—Ä" },
  {id:"gy", name:"–ó–µ–ª—ë–Ω—ã–π —á–∞–π (–ª–æ–Ω—Ü–∑–∏–Ω –∏ —Ç.–ø.)", meta:"–ó–µ–ª—ë–Ω—ã–π ¬∑ –Ω–µ—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
   desc:"–õ—ë–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å –∏ ¬´—á–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞¬ª. –õ—É—á—à–µ –≤ –ø–µ—Ä–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ –¥–Ω—è –∏ –±–µ–∑ —Å–≤–µ—Ä—Ö–∫—Ä–µ–ø–∫–æ–π –∑–∞–≤–∞—Ä–∫–∏.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"0%","–ü—Ä–æ—Ñ–∏–ª—å":"–æ—Ä–µ—Ö, –∑–µ–ª–µ–Ω—å","–¢–µ–∫—Å—Ç—É—Ä–∞":"–ª—ë–≥–∫–∞—è","–≠—Ñ—Ñ–µ–∫—Ç":"—è—Å–Ω–æ—Å—Ç—å, —Ç–æ–Ω—É—Å" },
   buyQuery:"–∫–∏—Ç–∞–π—Å–∫–∏–π –∑–µ–ª—ë–Ω—ã–π —á–∞–π –ª—É–Ω—Ü–∑–∏–Ω" },
  {id:"wl", name:"–£–ª—É–Ω (—Ç–µ–≥—É–∞–Ω—å–∏–Ω—å/–¥–∞–Ω—å—Ü—É–Ω)", meta:"–£–ª—É–Ω ¬∑ —á–∞—Å—Ç–∏—á–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è",
   desc:"–ë–∞–ª–∞–Ω—Å –±–æ–¥—Ä–æ—Å—Ç–∏ –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –¥–ª—è —Ñ–æ–∫—É—Å–∞ –±–µ–∑ ¬´–ø–µ—Ä–µ–≥–æ–Ω–∞¬ª.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"20‚Äì60%","–†–µ–≥–∏–æ–Ω":"–§—É—Ü–∑—è–Ω—å/–ì—É–∞–Ω–¥—É–Ω","–ü—Ä–æ—Ñ–∏–ª—å":"—Ü–≤–µ—Ç—ã, —Ñ—Ä—É–∫—Ç—ã","–¢–µ–∫—Å—Ç—É—Ä–∞":"—à—ë–ª–∫","–≠—Ñ—Ñ–µ–∫—Ç":"–±–∞–ª–∞–Ω—Å, —Ñ–æ–∫—É—Å" },
   buyQuery:"—É–ª—É–Ω —Ç–µ–≥—É–∞–Ω—å–∏–Ω—å" },
  {id:"hb", name:"–•—ç–π—á–∞ (—Ñ—É-—á–∂—É–∞–Ω—å)", meta:"–¢—ë–º–Ω—ã–π —á–∞–π ¬∑ –ø–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è",
   desc:"–°–æ–≥—Ä–µ–≤–∞—é—â–µ–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ–µ –æ—â—É—â–µ–Ω–∏–µ. –í–∞–∂–Ω–æ –Ω–µ –∑–∞–≤–∞—Ä–∏–≤–∞—Ç—å —Å–ª–∏—à–∫–æ–º –∫—Ä–µ–ø–∫–æ.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"–ø–æ—Å—Ç-—Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π","–†–µ–≥–∏–æ–Ω":"–•—É–Ω–∞–Ω—å/–®—ç–Ω—å—Å–∏","–ü—Ä–æ—Ñ–∏–ª—å":"—Ö–ª–µ–±, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã","–¢–µ–∫—Å—Ç—É—Ä–∞":"–ø–ª–æ—Ç–Ω–∞—è","–≠—Ñ—Ñ–µ–∫—Ç":"—Ç–µ–ø–ª–æ, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å" },
   buyQuery:"—Ñ—É —á–∂—É–∞–Ω—å —Ö—ç–π—á–∞" },
  {id:"rd", name:"–ö—Ä–∞—Å–Ω—ã–π —á–∞–π (–¥–∏–∞–Ω—Ö—É–Ω)", meta:"–ö—Ä–∞—Å–Ω—ã–π ¬∑ –ø–æ–ª–Ω–∞—è —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è",
   desc:"–¢—ë–ø–ª—ã–π, —Å–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –ø—Ä–æ—Ñ–∏–ª—å, –º—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å. –•–æ—Ä–æ—à –¥–ª—è ¬´—Ä–æ–≤–Ω–æ–≥–æ —Ç–æ–Ω—É—Å–∞¬ª.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"–≤—ã—Å–æ–∫–∞—è","–†–µ–≥–∏–æ–Ω":"–Æ–Ω—å–Ω–∞–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"–º—ë–¥, –∫–∞—Ä–∞–º–µ–ª—å","–¢–µ–∫—Å—Ç—É—Ä–∞":"—Å—Ä–µ–¥–Ω—è—è","–≠—Ñ—Ñ–µ–∫—Ç":"–º—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å" },
   buyQuery:"–∫—Ä–∞—Å–Ω—ã–π —á–∞–π –¥–∏–∞–Ω—Ö—É–Ω" },
  {id:"wh", name:"–ë–µ–ª—ã–π —á–∞–π (—à–æ—É –º—ç–π)", meta:"–ë–µ–ª—ã–π ¬∑ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞",
   desc:"–ú—è–≥–∫–∏–π –∏ —Å–ø–æ–∫–æ–π–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –¥–ª—è ¬´—Å–Ω—è—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ¬ª.",
   cls:{ "–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è":"–Ω–∏–∑–∫–∞—è/–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è","–†–µ–≥–∏–æ–Ω":"–§—É—Ü–∑—è–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –º—ë–¥","–¢–µ–∫—Å—Ç—É—Ä–∞":"–ª—ë–≥–∫–∞—è","–≠—Ñ—Ñ–µ–∫—Ç":"–º—è–≥–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ" },
   buyQuery:"–±–µ–ª—ã–π —á–∞–π —à–æ—É –º—ç–π" },
];

const HERBS = [
  {id:"cham", name:"–†–æ–º–∞—à–∫–∞ –∞–ø—Ç–µ—á–Ω–∞—è", meta:"–¢—Ä–∞–≤–∞ ¬∑ –º—è–≥–∫–æ–µ —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–µ–µ",
   desc:"–ß–∞—â–µ –±–µ—Ä—É—Ç –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –∏ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è. –ü–æ–¥—Ö–æ–¥–∏—Ç –≤–µ—á–µ—Ä–æ–º –∏ –ø–æ—Å–ª–µ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö –¥–Ω–µ–π.",
   cls:{ "–§–æ—Ä–º–∞":"—Ü–≤–µ—Ç–∫–∏","–ü—Ä–æ—Ñ–∏–ª—å":"–º—è–≥–∫–∏–π —Ç—Ä–∞–≤—è–Ω–æ–π","–≠—Ñ—Ñ–µ–∫—Ç":"—É—Å–ø–æ–∫–æ–µ–Ω–∏–µ" },
   buyQuery:"—Ä–æ–º–∞—à–∫–∞ –∞–ø—Ç–µ—á–Ω–∞—è —á–∞–π" },
  {id:"mint", name:"–ú—è—Ç–∞", meta:"–¢—Ä–∞–≤–∞ ¬∑ –æ—Å–≤–µ–∂–∞—é—â–∞—è",
   desc:"–û—Å–≤–µ–∂–∞–µ—Ç –∏ ¬´–ø—Ä–æ—è—Å–Ω—è–µ—Ç –≥–æ–ª–æ–≤—É¬ª. –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–Ω–∏–∂–∞–µ—Ç —Ç—è–∂–µ—Å—Ç—å –ø–æ—Å–ª–µ –µ–¥—ã. –ú–æ–∂–µ—Ç –±–æ–¥—Ä–∏—Ç—å.",
   cls:{ "–§–æ—Ä–º–∞":"–ª–∏—Å—Ç—å—è","–ü—Ä–æ—Ñ–∏–ª—å":"–º–µ–Ω—Ç–æ–ª","–≠—Ñ—Ñ–µ–∫—Ç":"—Å–≤–µ–∂–µ—Å—Ç—å" },
   buyQuery:"–º—è—Ç–∞ —Å—É—à—ë–Ω–∞—è —á–∞–π" },
  {id:"mel", name:"–ú–µ–ª–∏—Å—Å–∞", meta:"–¢—Ä–∞–≤–∞ ¬∑ –º—è–≥–∫–æ–µ —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–µ–µ",
   desc:"–î–ª—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –∏ ¬´—Ä–æ–≤–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è¬ª. –ß–∞—Å—Ç–æ —Ö–æ—Ä–æ—à–æ –≤–µ—á–µ—Ä–æ–º.",
   cls:{ "–§–æ—Ä–º–∞":"–ª–∏—Å—Ç—å—è","–ü—Ä–æ—Ñ–∏–ª—å":"–ª–∏–º–æ–Ω–Ω—ã–π","–≠—Ñ—Ñ–µ–∫—Ç":"—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ" },
   buyQuery:"–º–µ–ª–∏—Å—Å–∞ —Å—É—à—ë–Ω–∞—è" },
  {id:"mthr", name:"–ü—É—Å—Ç—ã—Ä–Ω–∏–∫", meta:"–¢—Ä–∞–≤–∞ ¬∑ –¥–ª—è –Ω–µ—Ä–≤–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è",
   desc:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∏ –Ω–µ—Ä–≤–Ω–æ–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏. –í–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å.",
   cls:{ "–§–æ—Ä–º–∞":"—Ç—Ä–∞–≤–∞","–ü—Ä–æ—Ñ–∏–ª—å":"–≥–æ—Ä—å–∫–æ–≤–∞—Ç—ã–π","–≠—Ñ—Ñ–µ–∫—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è" },
   buyQuery:"–ø—É—Å—Ç—ã—Ä–Ω–∏–∫ —Ç—Ä–∞–≤–∞" },
  {id:"ging", name:"–ò–º–±–∏—Ä—å", meta:"–°–ø–µ—Ü–∏—è/–∫–æ—Ä–µ–Ω—å ¬∑ —Å–æ–≥—Ä–µ–≤–∞—é—â–µ–µ",
   desc:"–°–æ–≥—Ä–µ–≤–∞–µ—Ç –∏ –ø–æ–º–æ–≥–∞–µ—Ç ¬´—Ä–∞–∑–±—É–¥–∏—Ç—å—Å—è¬ª. –£ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–∂–µ—Ç —Ä–∞–∑–¥—Ä–∞–∂–∞—Ç—å –∂–µ–ª—É–¥–æ–∫ ‚Äî –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ.",
   cls:{ "–§–æ—Ä–º–∞":"–∫–æ—Ä–µ–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"–æ—Å—Ç—Ä—ã–π","–≠—Ñ—Ñ–µ–∫—Ç":"—Ç–µ–ø–ª–æ, —Ç–æ–Ω—É—Å" },
   buyQuery:"–∏–º–±–∏—Ä—å —Å—É—à—ë–Ω—ã–π –¥–ª—è —á–∞—è" },
  {id:"rose", name:"–®–∏–ø–æ–≤–Ω–∏–∫", meta:"–ü–ª–æ–¥—ã ¬∑ –º—è–≥–∫–∏–π —Ç–æ–Ω—É—Å",
   desc:"–õ—ë–≥–∫–∏–π —Ç–æ–Ω—É—Å –∏ –≤–∫—É—Å. –ß–∞—Å—Ç–æ –∑–∞–≤–∞—Ä–∏–≤–∞—é—Ç –≤ —Ç–µ—Ä–º–æ—Å–µ.",
   cls:{ "–§–æ—Ä–º–∞":"–ø–ª–æ–¥—ã","–ü—Ä–æ—Ñ–∏–ª—å":"–∫–∏—Å–ª–æ–≤–∞—Ç—ã–π","–≠—Ñ—Ñ–µ–∫—Ç":"–º—è–≥–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞" },
   buyQuery:"—à–∏–ø–æ–≤–Ω–∏–∫ —Å—É—à—ë–Ω—ã–π" },
  {id:"sage", name:"–®–∞–ª—Ñ–µ–π", meta:"–¢—Ä–∞–≤–∞ ¬∑ —Ç–µ—Ä–ø–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å",
   desc:"–¢–µ—Ä–ø–∫–∏–π –≤–∫—É—Å, —á–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç –¥–ª—è ¬´—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç–∏¬ª.",
   cls:{ "–§–æ—Ä–º–∞":"–ª–∏—Å—Ç—å—è","–ü—Ä–æ—Ñ–∏–ª—å":"—Ç–µ—Ä–ø–∫–∏–π","–≠—Ñ—Ñ–µ–∫—Ç":"—Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å" },
   buyQuery:"—à–∞–ª—Ñ–µ–π —Å—É—à—ë–Ω—ã–π" },
  {id:"gins", name:"–ñ–µ–Ω—å—à–µ–Ω—å (–º–∏–∫—Ä–æ-–¥–æ–∑–∞)", meta:"–ö–æ—Ä–µ–Ω—å ¬∑ —Å—Ç–∏–º—É–ª—è—Ü–∏—è (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ)",
   desc:"–í –º–∏–∫—Ä–æ–¥–æ–∑–∞—Ö –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–Ω—É—Å–∞ –∏ —Ñ–æ–∫—É—Å–∞. –ü—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ/–≥–∏–ø–µ—Ä—Ç–æ–Ω–∏–∏ ‚Äî –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ.",
   cls:{ "–§–æ—Ä–º–∞":"–∫–æ—Ä–µ–Ω—å","–ü—Ä–æ—Ñ–∏–ª—å":"–≥–æ—Ä—å–∫–æ–≤–∞—Ç—ã–π","–≠—Ñ—Ñ–µ–∫—Ç":"—Ç–æ–Ω—É—Å, —Ñ–æ–∫—É—Å" },
   buyQuery:"–∂–µ–Ω—å—à–µ–Ω—å –∫–æ—Ä–µ–Ω—å —á–∞–π" },
];

function m(entries){ return new Map(entries); }
const MAP = {
  tea_bad: m([
    ["–§–∏–∑–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å", ["shou","hb","rd"]],
    ["–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å", ["wh","wl","shou"]],
    ["–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å", ["gy","shen","wl"]],
    ["–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å", ["wh","wl","shou"]],
    ["–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", ["wh","shou","hb"]],
    ["–ó–∞—Å—Ç–æ–π/–∞–ø–∞—Ç–∏—è", ["shen","gy","rd"]],
    ["–•–æ–ª–æ–¥ –≤ —Ç–µ–ª–µ", ["shou","rd","hb"]],
    ["–¢—è–∂–µ—Å—Ç—å –ø–æ—Å–ª–µ –µ–¥—ã", ["hb","shou","wl"]],
    ["–ù–∏–∑–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è", ["gy","shen","wl"]],
    ["–ì–æ–ª–æ–≤–Ω–∞—è —Ç—è–∂–µ—Å—Ç—å", ["wh","wl","hb"]],
    ["–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ", ["wh","shou","wl"]],
    ["–í—è–ª–æ—Å—Ç—å —É—Ç—Ä–æ–º", ["gy","shen","rd"]],
    ["–°–∫–∞—á–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ", ["wl","wh","gy"]],
    ["–ü–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ", ["wh","shou","hb"]],
    ["–ù–µ—Ä–≤–Ω–æ–µ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ", ["wh","wl","shou"]],
    ["–°—É—Ö–æ—Å—Ç—å –≤–æ —Ä—Ç—É", ["wh","wl","gy"]],
    ["–ó—è–±–∫–æ—Å—Ç—å", ["rd","shou","hb"]],
    ["–°–Ω–∏–∂–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏", ["shen","gy","rd"]],
    ["–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∞–¥", ["rd","shou","wl"]],
    ["–õ—ë–≥–∫–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å", ["wh","wl","hb"]],
  ]),
  tea_good: m([
    ["–Ø—Å–Ω–æ—Å—Ç—å", ["gy","shen","wl"]],
    ["–°–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å", ["gy","wl","shen"]],
    ["–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ", ["wh","shou","wl"]],
    ["–†–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", ["wh","wl","shou"]],
    ["–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è", ["rd","shou","hb"]],
    ["–õ—ë–≥–∫–æ—Å—Ç—å", ["wl","wh","gy"]],
    ["–§–æ–∫—É—Å", ["gy","shen","wl"]],
    ["–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å", ["wl","gy","rd"]],
    ["–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", ["shou","hb","wh"]],
    ["–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫", ["wl","shen","rd"]],
    ["–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ç–µ–ª–∞", ["wh","shou","wl"]],
    ["–ß–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞", ["gy","wh","wl"]],
    ["–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", ["rd","shen","shou"]],
    ["–¢–µ—Ä–ø–µ–Ω–∏–µ", ["shou","hb","wh"]],
    ["–ë–µ—Ä–µ–∂–Ω–æ—Å—Ç—å –∫ —Å–µ–±–µ", ["wh","shou","wl"]],
    ["–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–∏—à–∏–Ω–∞", ["wh","shou","hb"]],
    ["–ë–∞–ª–∞–Ω—Å", ["wl","wh","shou"]],
    ["–ß—É–≤—Å—Ç–≤–æ –æ–ø–æ—Ä—ã", ["shou","hb","rd"]],
    ["–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø—É–ª—å—Å–æ–≤", ["wh","shou","wl"]],
    ["–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", ["gy","wl","shen"]],
  ]),
  herb_bad: m([
    ["–§–∏–∑–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å", ["gins","rose","ging"]],
    ["–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å", ["mel","mint","cham"]],
    ["–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å", ["ging","gins","sage"]],
    ["–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å", ["mel","mthr","cham"]],
    ["–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", ["mel","cham","mint"]],
    ["–ó–∞—Å—Ç–æ–π/–∞–ø–∞—Ç–∏—è", ["ging","sage","rose"]],
    ["–•–æ–ª–æ–¥ –≤ —Ç–µ–ª–µ", ["ging","sage","rose"]],
    ["–¢—è–∂–µ—Å—Ç—å –ø–æ—Å–ª–µ –µ–¥—ã", ["mint","ging","sage"]],
    ["–ù–∏–∑–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è", ["sage","gins","mint"]],
    ["–ì–æ–ª–æ–≤–Ω–∞—è —Ç—è–∂–µ—Å—Ç—å", ["mint","sage","mel"]],
    ["–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ", ["cham","mel","mthr"]],
    ["–í—è–ª–æ—Å—Ç—å —É—Ç—Ä–æ–º", ["ging","gins","sage"]],
    ["–°–∫–∞—á–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ", ["mel","mint","cham"]],
    ["–ü–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ", ["cham","mel","rose"]],
    ["–ù–µ—Ä–≤–Ω–æ–µ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ", ["mthr","mel","cham"]],
    ["–°—É—Ö–æ—Å—Ç—å –≤–æ —Ä—Ç—É", ["rose","mint","cham"]],
    ["–ó—è–±–∫–æ—Å—Ç—å", ["ging","sage","rose"]],
    ["–°–Ω–∏–∂–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏", ["ging","sage","gins"]],
    ["–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∞–¥", ["rose","mel","cham"]],
    ["–õ—ë–≥–∫–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å", ["mint","cham","sage"]],
  ]),
  herb_good: m([
    ["–Ø—Å–Ω–æ—Å—Ç—å", ["sage","mint","gins"]],
    ["–°–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç—å", ["sage","gins","mint"]],
    ["–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ", ["mel","cham","mthr"]],
    ["–†–æ–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", ["mel","cham","rose"]],
    ["–¢—ë–ø–ª–∞—è —ç–Ω–µ—Ä–≥–∏—è", ["ging","rose","sage"]],
    ["–õ—ë–≥–∫–æ—Å—Ç—å", ["mint","mel","cham"]],
    ["–§–æ–∫—É—Å", ["sage","gins","mint"]],
    ["–ú—è–≥–∫–∞—è –±–æ–¥—Ä–æ—Å—Ç—å", ["ging","sage","gins"]],
    ["–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", ["mthr","mel","cham"]],
    ["–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫", ["mint","sage","rose"]],
    ["–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ç–µ–ª–∞", ["cham","mel","mthr"]],
    ["–ß–∏—Å—Ç–∞—è –≥–æ–ª–æ–≤–∞", ["mint","sage","mel"]],
    ["–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", ["rose","gins","sage"]],
    ["–¢–µ—Ä–ø–µ–Ω–∏–µ", ["cham","mel","mthr"]],
    ["–ë–µ—Ä–µ–∂–Ω–æ—Å—Ç—å –∫ —Å–µ–±–µ", ["cham","mel","rose"]],
    ["–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–∏—à–∏–Ω–∞", ["mel","mthr","cham"]],
    ["–ë–∞–ª–∞–Ω—Å", ["mel","mint","cham"]],
    ["–ß—É–≤—Å—Ç–≤–æ –æ–ø–æ—Ä—ã", ["rose","mthr","mel"]],
    ["–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø—É–ª—å—Å–æ–≤", ["mthr","mel","cham"]],
    ["–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", ["sage","gins","ging"]],
  ]),
};

/** ---------- State ---------- */
let step = 1;
let domain = "tea";      // tea | herbs
const selBad = new Set();
const selGood = new Set();
const MAX_MULTI = 5;

/** ---------- Helpers ---------- */
const $ = (id)=>document.getElementById(id);
function setDots(){
  ["d1","d2","d3","d4"].forEach((id,i)=> $(id).classList.toggle("on", i < step));
}
function setHeader(){
  $("title").textContent = `–®–∞–≥ ${step}/4`;
  const domLabel = domain==="tea" ? "–ö–∏—Ç–∞–π—Å–∫–∏–π —á–∞–π" : "–¢—Ä–∞–≤—ã";
  if(step===1) $("crumb").textContent = "–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª";
  if(step===2) $("crumb").textContent = `${domLabel} ‚Üí –≤—ã–±–µ—Ä–∏ –¥–æ ${MAX_MULTI} —Å–æ—Å—Ç–æ—è–Ω–∏–π ¬´—É–±—Ä–∞—Ç—å¬ª`;
  if(step===3) $("crumb").textContent = `${domLabel} ‚Üí –≤—ã–±–µ—Ä–∏ –¥–æ ${MAX_MULTI} —Å–æ—Å—Ç–æ—è–Ω–∏–π ¬´–≤—ã–∑–≤–∞—Ç—å¬ª`;
  if(step===4) $("crumb").textContent = `${domLabel} ‚Üí –ø–æ–¥–±–æ—Ä`;
}
function clampSelections(set, max){
  while(set.size > max){
    const first = set.values().next().value;
    set.delete(first);
  }
}
function recommend(){
  const isTea = domain==="tea";
  const list = isTea ? TEAS : HERBS;
  const mBad = isTea ? MAP.tea_bad : MAP.herb_bad;
  const mGood = isTea ? MAP.tea_good : MAP.herb_good;

  const score = new Map();
  function add(ids){ ids.forEach(id=> score.set(id, (score.get(id)||0)+1)); }
  selBad.forEach(st => add(mBad.get(st) || []));
  selGood.forEach(st => add(mGood.get(st) || []));

  const items = [...score.entries()]
    .sort((a,b)=>b[1]-a[1])
    .map(([id,c])=>({ ...(list.find(x=>x.id===id)||{}), c }))
    .filter(x=>x.id);

  return {items, isTea};
}
function herbBlend(items){
  const total = 12;
  const top = items.slice(0,5);
  const sum = top.reduce((s,x)=>s+(x.c||1),0) || 1;
  return top.map(x=>{
    const g = Math.round((total*((x.c||1)/sum))*10)/10;
    return {name:x.name, grams: Math.max(0.5, g)};
  });
}
function ozonSearchUrl(q){
  return `https://www.ozon.ru/search/?text=${encodeURIComponent(q)}`;
}
function stateChipsForItem(itemId){
  const isTea = domain==="tea";
  const mBad = isTea ? MAP.tea_bad : MAP.herb_bad;
  const mGood = isTea ? MAP.tea_good : MAP.herb_good;

  const bad = [], good = [];
  for(const [st, ids] of mBad.entries()){ if(ids.includes(itemId)) bad.push(st); }
  for(const [st, ids] of mGood.entries()){ if(ids.includes(itemId)) good.push(st); }

  const pickedBad = bad.filter(s=>selBad.has(s));
  const pickedGood = good.filter(s=>selGood.has(s));
  const restBad = bad.filter(s=>!selBad.has(s));
  const restGood = good.filter(s=>!selGood.has(s));
  return { bad:[...pickedBad, ...restBad].slice(0,8), good:[...pickedGood, ...restGood].slice(0,8) };
}

/** ---------- Modal ---------- */
function openModal(item){
  $("mTitle").textContent = item.name || "";
  $("mMeta").textContent = item.meta || "";
  $("mDesc").textContent = item.desc || "‚Äî";

  // image
  const imgEl = document.getElementById("mImg");
  if(imgEl){
    imgEl.src = item.img || "";
    imgEl.style.display = item.img ? "block" : "none";
    imgEl.parentElement.style.display = item.img ? "block" : "none";
  }

  // brewing (only for teas)
  const brewWrap = document.getElementById("mBrewWrap");
  const brewEl = document.getElementById("mBrew");
  if(brewWrap && brewEl){
    if(item.brew){
      brewEl.textContent = item.brew;
      brewWrap.style.display = "block";
    }else{
      brewEl.textContent = "";
      brewWrap.style.display = "none";
    }
  }

  const cls = item.cls || {};
  $("mClass").innerHTML = Object.entries(cls).map(([k,v])=>`<div><b>${escapeHtml(k)}:</b> ${escapeHtml(v)}</div>`).join("") || "‚Äî";

  const chips = stateChipsForItem(item.id);
  const parts = [];
  if(chips.bad.length){
    parts.push(`<div class="small"><b>–£–±—Ä–∞—Ç—å</b></div>`);
    parts.push(chips.bad.map(s=>`<span class="chip bad">${escapeHtml(s)}</span>`).join(""));
  }
  if(chips.good.length){
    parts.push(`<div class="small" style="margin-top:6px;"><b>–í—ã–∑–≤–∞—Ç—å</b></div>`);
    parts.push(chips.good.map(s=>`<span class="chip good">${escapeHtml(s)}</span>`).join(""));
  }
  $("mWhen").innerHTML = parts.join("") || `<span class="small">‚Äî</span>`;

  $("mBuy").setAttribute("href", ozonSearchUrl(item.buyQuery || item.name || ""));
  $("modalOverlay").style.display = "flex";
}
function closeModal(){ $("modalOverlay").style.display = "none"; }
$("mClose").addEventListener("click", closeModal);
$("modalOverlay").addEventListener("click", (e)=>{ if(e.target === $("modalOverlay")) closeModal(); });
document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

/** ---------- UI Builders ---------- */
function buildStep1(){
  const p = $("panel");
  p.innerHTML = `    <div class="row" style="justify-content:flex-start;">
      <div style="display:flex; flex-direction:column; gap:10px; width:100%;">
        <div class="hint" style="font-size:14px;">–í—ã–±–µ—Ä–∏, —á—Ç–æ –ø–æ–¥–±–∏—Ä–∞—Ç—å. –î–∞–ª—å—à–µ ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è ¬´—É–±—Ä–∞—Ç—å¬ª –∏ ¬´–≤—ã–∑–≤–∞—Ç—å¬ª, –∑–∞—Ç–µ–º –≤—ã–≤–æ–¥.</div>

        <div class="tiles" role="tablist" aria-label="—Ä–∞–∑–¥–µ–ª">
          <div class="tile ${domain==="tea"?"on":""}" id="domTea" role="tab" aria-selected="${domain==="tea"?"true":"false"}">
            <div class="tileIcon">üçµ</div>
            <div style="min-width:0;">
              <div class="tileTitle">–ö–∏—Ç–∞–π—Å–∫–∏–π —á–∞–π</div>
              <div class="tileSub">–ü—É—ç—Ä—ã, —É–ª—É–Ω—ã, –∑–µ–ª—ë–Ω—ã–µ, –±–µ–ª—ã–µ –∏ –∫—Ä–∞—Å–Ω—ã–µ. –ü—Ä–æ–ª–∏–≤–æ–º –∏–ª–∏ –≤ —á–∞–π–Ω–∏–∫–µ ‚Äî –ø–æ–¥ —Ç–≤–æ–π —Ä–∏—Ç–º –¥–Ω—è.</div>
              <div class="tileBadges">
                <span class="badge green">—è—Å–Ω–æ—Å—Ç—å</span>
                <span class="badge blue">—Ñ–æ–∫—É—Å</span>
                <span class="badge green">—Ä–æ–≤–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è</span>
              </div>
            </div>
          </div>

          <div class="tile ${domain==="herbs"?"on":""}" id="domHerb" role="tab" aria-selected="${domain==="herbs"?"true":"false"}"
               style="background:
                radial-gradient(700px 220px at 18% 0%, rgba(125,220,122,.26), transparent 55%),
                radial-gradient(560px 260px at 90% 35%, rgba(255,204,102,.18), transparent 58%),
                linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));">
            <div class="tileIcon">üåø</div>
            <div style="min-width:0;">
              <div class="tileTitle">–¢—Ä–∞–≤—ã</div>
              <div class="tileSub">–°–±–æ—Ä—ã –∏ –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Ç—Ä–∞–≤—ã. –ú—è–≥–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è: —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, —Ç–µ–ø–ª–æ, –ª—ë–≥–∫–æ—Å—Ç—å.</div>
              <div class="tileBadges">
                <span class="badge green">–±–∞–ª–∞–Ω—Å</span>
                <span class="badge blue">—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</span>
                <span class="badge green">–∑–∞–∑–µ–º–ª–µ–Ω–∏–µ</span>
              </div>
            </div>
          </div>
        </div>

        <div class="hint" style="margin-top:2px;">–®–∞–≥ 2 –∏ 3: –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π (–¥–æ ${MAX_MULTI}). –ù–∏—á–µ–≥–æ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–∂–µ –º–æ–∂–Ω–æ.</div>
      </div>
    </div>
  `;
  $("domTea").onclick = ()=>{ domain="tea"; render(); };
  $("domHerb").onclick = ()=>{ domain="herbs"; render(); };
}
function buildStep2(){
  const p = $("panel");
  clampSelections(selBad, MAX_MULTI);
  const pills = STATES_BAD.map(s=> `<span class="pill bad ${selBad.has(s)?"on":""}" data-v="${escapeHtml(s)}">${escapeHtml(s)}</span>`).join("");
  p.innerHTML = `
    <div class="row">
      <div><b>–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–π—á–∞—Å (—É–±—Ä–∞—Ç—å)</b><div class="hint">–í—ã–±—Ä–∞–Ω–æ: ${selBad.size}/${MAX_MULTI}</div></div>
      
    </div>
    <div class="list" id="badList">${pills}</div>
    <div class="err" id="errBad">–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</div>
  `;
  $("badList").onclick = (e)=>{
    const el = e.target.closest(".pill"); if(!el) return;
    const v = unescapeHtml(el.getAttribute("data-v"));
    selBad.has(v) ? selBad.delete(v) : selBad.add(v);
    clampSelections(selBad, MAX_MULTI);
    render(false);
  };
}
function buildStep3(){
  const p = $("panel");
  clampSelections(selGood, MAX_MULTI);
  const pills = STATES_GOOD.map(s=> `<span class="pill good ${selGood.has(s)?"on":""}" data-v="${escapeHtml(s)}">${escapeHtml(s)}</span>`).join("");
  p.innerHTML = `
    <div class="row">
      <div><b>–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ—á—É (–≤—ã–∑–≤–∞—Ç—å)</b><div class="hint">–í—ã–±—Ä–∞–Ω–æ: ${selGood.size}/${MAX_MULTI}</div></div>
      
    </div>
    <div class="list" id="goodList">${pills}</div>
    <div class="err" id="errGood">–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</div>
  `;
  $("goodList").onclick = (e)=>{
    const el = e.target.closest(".pill"); if(!el) return;
    const v = unescapeHtml(el.getAttribute("data-v"));
    selGood.has(v) ? selGood.delete(v) : selGood.add(v);
    clampSelections(selGood, MAX_MULTI);
    render(false);
  };
}
function buildStep4(){
  const p = $("panel");
  const {items, isTea} = recommend();
  const domLabel = domain==="tea" ? "—á–∞–π" : "—Ç—Ä–∞–≤—ã";
  const pickedBad = [...selBad];
  const pickedGood = [...selGood];

  let extra = "";
  if(!isTea){
    const blend = herbBlend(items);
    if(blend.length){
      extra = `
        <div class="item" style="margin-top:10px;">
          <div class="leftcol">
            <b>üåø –°–±–æ—Ä –Ω–∞ 1 –ª–∏—Ç—Ä (–ø—Ä–∏–º–µ—Ä)</b>
            <span>${blend.map(x=>`${escapeHtml(x.name)} ‚Äî <b>${x.grams} –≥</b>`).join(" ‚Ä¢ ")}</span>
            <div class="hint" style="margin-top:6px;">–°—Ç–∞—Ä—Ç: 10‚Äì12 –≥/1–ª, –Ω–∞—Å—Ç–∞–∏–≤–∞–Ω–∏–µ 10‚Äì20 –º–∏–Ω. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ.</div>
          </div>
          <div class="actions">
            <a class="link" target="_blank" rel="noopener" href="${ozonSearchUrl("—Å–±–æ—Ä —Ç—Ä–∞–≤ –¥–ª—è —á–∞—è")}">–∫—É–ø–∏—Ç—å</a>
          </div>
        </div>
      `;
    }
  }

  const listHtml = items.length
    ? items.slice(0,10).map(x=>`
        <div class="item" data-open="${escapeHtml(x.id)}"><div class="thumb" data-open="${escapeHtml(x.id)}"><img src="${escapeHtml(x.img || "")}" alt=""/></div><div class="leftcol"><b style="cursor:pointer; text-decoration:underline; text-decoration-color:rgba(122,183,255,.35);" data-open="${escapeHtml(x.id)}">${escapeHtml(x.name)}</b>
            <span>–°–æ–≤–ø–∞–¥–µ–Ω–∏—è: ${x.c}</span>
          </div>
          <div class="actions">
            <a class="link" target="_blank" rel="noopener" href="${ozonSearchUrl(x.buyQuery || x.name)}">–∫—É–ø–∏—Ç—å</a>
          </div>
        </div>
      `).join("")
    : `<div class="hint">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–±–æ—Ä–∞ ‚Äî –≤–µ—Ä–Ω–∏—Å—å –∏ –≤—ã–±–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.</div>`;

  p.innerHTML = `
    <div class="results">
      <h2>–í—ã–≤–æ–¥</h2>
      <div class="row" style="justify-content:space-between;">
        <div style="flex:1; min-width:260px;">
          <div class="hint">–í—ã–±—Ä–∞–Ω–æ (—É–±—Ä–∞—Ç—å)</div>
          <div class="list">${pickedBad.length?pickedBad.map(s=>`<span class="pill bad on">${escapeHtml(s)}</span>`).join(""):`<span class="hint">‚Äî</span>`}</div>
        </div>
        <div style="flex:1; min-width:260px;">
          <div class="hint">–í—ã–±—Ä–∞–Ω–æ (–≤—ã–∑–≤–∞—Ç—å)</div>
          <div class="list">${pickedGood.length?pickedGood.map(s=>`<span class="pill good on">${escapeHtml(s)}</span>`).join(""):`<span class="hint">‚Äî</span>`}</div>
        </div>
      </div>
      <div class="note">–ù–∏–∂–µ ‚Äî ${domLabel}, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —ç—Ç—É –∫–æ–º–±–∏–Ω–∞—Ü–∏—é. –ù–∞–∂–º–∏ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ.</div>
      ${extra}
      <div style="display:grid; gap:10px; margin-top:10px;" id="resList">${listHtml}</div>
    </div>
  `;

  const list = domain==="tea" ? TEAS : HERBS;
  $("resList").addEventListener("click", (e)=>{
    const target = e.target.closest("[data-open]");
    if(!target) return;
    e.preventDefault();
    const openId = target.getAttribute("data-open");
    const item = list.find(x=>x.id===openId);
    if(item) openModal(item);
  });
}

/** ---------- Render ---------- */
function render(resetPanel=true){
  setDots(); setHeader();
  $("backBtn").disabled = (step===1);
  $("nextBtn").textContent = (step===4) ? "–°–Ω–∞—á–∞–ª–∞" : "–î–∞–ª–µ–µ";

  if(resetPanel){
    if(step===1) buildStep1();
    if(step===2) buildStep2();
    if(step===3) buildStep3();
    if(step===4) buildStep4();
  }else{
    if(step===2) buildStep2();
    if(step===3) buildStep3();
    if(step===4) buildStep4();
  }
}

/** ---------- Navigation ---------- */
$("backBtn").addEventListener("click", ()=>{ if(step>1){ step--; render(); } });
$("nextBtn").addEventListener("click", ()=>{
  if(step===1){ step=2; render(); return; }
  if(step===2){
    step=3; render(); return;
  }
  if(step===3){
    step=4; render(); return;
  }
  if(step===4){
    step=1; selBad.clear(); selGood.clear();
    render();
  }
});

/** ---------- Safe HTML helpers ---------- */
function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
}
function unescapeHtml(s){
  return String(s).replaceAll("&quot;",'"').replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&amp;","&");
}

/** ---------- Init ---------- */
render();
</script>
</body>
</html>
